---
title: ASP.NET çekirdek 2.0 için 2.1 geçirme
author: rick-anderson
description: Bu makalede bir ASP.NET Core 2.0 uygulama 2.1 için geçiş işleminin temel bilgiler yer almaktadır.
ms.author: riande
ms.date: 05/30/2018
uid: migration/20_21
ms.openlocfilehash: 8d27d916b04c12c17c0054de8392408f751b6990
ms.sourcegitcommit: 1faf2525902236428dae6a59e375519bafd5d6d7
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 06/28/2018
ms.locfileid: "37089899"
---
# <a name="migrate-from-aspnet-core-20-to-21"></a>ASP.NET çekirdek 2.0 için 2.1 geçirme

Tarafından [Rick Anderson](https://twitter.com/RickAndMSFT)

Bkz: [ASP.NET Core 2.1 yenilikler](xref:aspnetcore-2.1) ASP.NET Core 2.1'deki yeni özelliklerin genel bakış.

Bu makalede:

* Bir ASP.NET Core 2.0 uygulama 2.1 için geçiş işleminin temel bilgiler yer almaktadır.
* ASP.NET Core web uygulama şablonları değişiklikleri genel bir bakış sağlar.

2.1 değişikliklerin özetini almak için hızlı bir yolu şudur:

* WebApp1 adlı bir ASP.NET Core 2.0 web uygulaması oluşturun.
* WebApp1 bir kaynak denetim sistemi uygulayın.
* WebApp1 silin ve aynı yerde WebApp1 adlı bir ASP.NET Core 2.1 web uygulaması oluşturun.
* 2.1 sürümünde değişiklikleri gözden geçirin.

Bu makale, ASP.NET Core 2.1 geçişi hakkında genel bir bakış sağlar. Sürüm 2.1 geçirmek için gerekli tüm değişiklikleri tam bir listesi içermiyor. Bazı projeler projeye yapılan değişiklikler ve proje oluşturduğunuzda seçeneklere bağlı olarak daha fazla adımlar gerektirebilir.

## <a name="update-the-project-file-to-use-21-versions"></a>Güncelleştirme 2.1 sürümleri kullanmak için proje dosyası

Güncelleştirme *.csproj* proje dosyası:

* Değişiklik `<TargetFramework>netcoreapp2.0</TargetFramework>` 2.1 sürümüne olan `<TargetFramework>netcoreapp2.1</TargetFramework>`.
* Belirtilen "Microsoft.AspNetCore.All" paketi başvurusu versionless "Microsoft.AspNetCore.App" paketi başvurusu ile değiştir sürümü. "Microsoft.AspNetCore.All" kaldırıldı bağımlılıkları eklemeniz gerekebilir. Bkz: [Microsoft.AspNetCore.App için Microsoft.AspNetCore.All geçiş](xref:fundamentals/metapackage#migrate) ve [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app). .NET Framework atamak iseniz:

  * Meta paket başvuru yerine tek tek Paket başvurular ekleyin.
  * Her paket başvuru 2.1 güncelleştirin.
* Tüm başvurularını kaldırmanız `<DotNetCliToolReference>` "Microsoft.AspNetCore", "Microsoft.VisualStudio" ve "Microsoft.EntityFrameworkCore" paketler için öğeleri. Bu araçlar genel araçları tarafından değiştirilmiştir.

Aşağıdaki biçimlendirmede şablon üretilen 2.0 gösterir *.csproj* proje dosyası:

[!code-xml[Main](20_21/sample/WebApp20.csproj)]

Aşağıdaki biçimlendirmede şablon üretilen 2.1 gösterir *.csproj* proje dosyası:

[!code-xml[Main](20_21/sample/WebApp21.csproj)]

## <a name="rules-for-projects-targeting-the-shared-runtime"></a>Paylaşılan çalışma zamanı hedefleyen projeler için kurallar

ASP.NET Core aşağıdaki paylaşılan çalışma zamanları içerir:

* [Microsoft.AspNetCore.App](xref:fundamentals/metapackage-app)
* [Microsoft.AspNetCore.All](xref:fundamentals/metapackage)

Paylaşılan çalışma zamanı hedefleyen projeler için kuralları:

* Projeleri başvuran `Microsoft.AspNetCore.All` veya `Microsoft.AspNetCore.App` paketleri ayarlanmış gerekir projenin SDK `Microsoft.NET.Sdk.Web` proje dosyası üstündeki (`<Project Sdk="Microsoft.NET.Sdk.Web">`).
* Başvuran paketleri veya geçişli başvuru projeleri projeleri `Microsoft.AspNetCore.All` veya `Microsoft.AspNetCore.App`:
  * Projenin SDK ayarlamalısınız `Microsoft.NET.Sdk.Web` proje dosyası üstündeki (`<Project Sdk="Microsoft.NET.Sdk.Web">`).
  * Aynı paylaşılan çalışma zamanı paketi başvurmalıdır. LibraryA başvuruyorsa `Microsoft.AspNetCore.App`, LibraryA başvuran projeler de başvurmalıdır `Microsoft.AspNetCore.App`.
* Yürütülebilir projeleri (ile başlatılan uygulamaları içeren projeler `dotnet run` veya çalıştıran ve test projeleri uygulamalar için uygulamalar) için bir sürüm belirtmemelidir `Microsoft.AspNetCore.App`. SDK aracılığıyla dolaylı olarak sürümünü belirten `<PackageReference Include="Microsoft.AspNetCore.App" />`.
* Başvurulan projeleri (giriş noktası ve proje başvuruları olmayan projeleri `Microsoft.AspNetCore.All` veya `Microsoft.AspNetCore.App`) bir paket sürümü belirtmeniz gerekir.

## <a name="changes-to-take-advantage-of-the-new-code-based-idioms-that-are-recommended-in-aspnet-core-21"></a>ASP.NET Core 2.1 önerilen yeni kod tabanlı deyimleri yararlanmak için değişiklikler

### <a name="changes-to-main"></a>Ana yapılan değişiklikler

Aşağıdaki görüntüleri şablonlu için oluşturulan yapılan değişiklikleri göster *Program.cs* dosya.

![eski sürüm farklar](20_21/_static/main20.png)

Önceki resimde silme 2.0 sürümüyle kırmızı olarak gösterilir.

Aşağıdaki resimde 2.1 kodu gösterir. Yeşil kodda 2.0 sürümü değiştirilmiştir:

![Yeni sürüm farklar](20_21/_static/main21.png)

Aşağıdaki kod 2.1 sürümünü gösterir *Program.cs*:

[!code-csharp[Main](20_21/sample/Program.cs?name=snippet)]

Yeni `Main` çağrısı değiştirir `BuildWebHost` ile [CreateWebHostBuilder](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.createwebhostbuilder). [IWebHostBuilder](/dotnet/api/microsoft.aspnetcore.hosting.iwebhostbuilder) yeni desteklemek için eklenen [tümleştirme test altyapısını](xref:test/integration-tests).

### <a name="changes-to-startup"></a>Başlangıç için değişiklikler

Aşağıdaki kod oluşturulan 2.1 şablonunu kod değişiklikleri gösterir. Tüm değişiklikleri hariç kod yeni eklenen `UseBrowserLink` kaldırıldı:

[!code-csharp[Main](20_21/sample/Startup.cs?highlight=3,4,21-26,30,42,45,47)]

Önceki kod değişiklikleri ayrıntılı:

* [GDPR destek ASP.NET Core](xref:security/gdpr) için `CookiePolicyOptions` ve `UseCookiePolicy`.
* [HTTP katı Aktarım güvenlik protokolünü (HSTS)](xref:security/enforcing-ssl#http-strict-transport-security-protocol-hsts) için `UseHsts`.
* [HTTPS gerektiren](xref:security/enforcing-ssl#require-https) için `UseHttpsRedirection`.
* [SetCompatibilityVersion](xref:fundamentals/startup#setcompatibilityversion) için `SetCompatibilityVersion(CompatibilityVersion.Version_2_1)`.

## <a name="changes-to-authentication-code"></a>Kimlik doğrulama kodu yapılan değişiklikler

ASP.NET Core 2.1 sağlar [ASP.NET Core kimliği](xref:security/authentication/identity) olarak bir [Razor sınıf kitaplığı](xref:razor-pages/ui-class) (RCL).

2.1 varsayılan kimlik UI şu anda 2.0 sürümünün üzerine önemli yeni özellikler sağlamaz. Kimlik RCL paketiyle değiştirerek isteğe bağlıdır. Şablonu değiştirmek için yararları RCL sürüm koduyla dahil kimlik oluşturulan:

* Çok sayıda dosyaları dışında kaynak ağaç taşınır.
* Herhangi bir hata düzeltmeleri veya kimlik için yeni özellikler dahil edilen [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app). Güncelleştirilmiş kimliğini otomatik olarak almak zaman `Microsoft.AspNetCore.App` güncelleştirilir.

Önemsiz olmayan yaptıysanız, oluşturulan kimlik kodda şablona yapılan değişiklikler:

* Önceki avantajları dönüştürme yaslamak değil RCL sürümü.
* ASP.NET Core 2.0 kimlik kodunuzu tutabilirsiniz, tam olarak desteklenmektedir.

Kimlik 2.1 sunan uç ile `Identity` alanı. Örneğin, izleme tabloda 2.1 için 2. 0 değiştirmek kimlik uç noktaları örnekleri gösterilmektedir:

| 2.0 URL'Sİ         | 2.1 URL'Sİ |
| --------------- | ------------ |
| / Hesap/oturum açma  | / Kimlik/hesap/oturum açma |
| / Hesap/oturum kapatma | / Kimlik/hesap/oturum kapatma |
| / Hesap/Yönet | / Kimlik/hesap/Yönet |

Kimlik kullanıcı Arabirimi kimlik URL'leri dikkate 2.1 kimlik kitaplığı gerek olmadan kimliğini kullanarak koda sahip ve 2.0 Değiştir uygulamalara sahip `/Identity` URI'ler $a segement. Yeni işlemek için tek yönlü kimlik uç noktaları etmektir kümeden örneğin yeniden yönlendirmeleri `/Account/Login` için `/Identity/Account/Login`.

### <a name="update-identity-to-version-21"></a>Kimlik 2.1 sürümüne güncelleştirin

Kimlik için 2.1 güncelleştirmek aşağıdaki seçenekler kullanılabilir.

* Kimlik UI 2.0 kodunu herhangi bir değişiklik yapmadan kullanın. Kimlik UI 2.0 kodunu kullanarak tam olarak desteklenir. Bu, oluşturulan kimlik kod yapılan önemli değişiklikler olduğunda iyi bir yaklaşımdır.
* Varolan kimlik 2.0 kodunuzu silin ve [İskele kimlik](xref:security/authentication/scaffold-identity) projenize. Projenizi kullanacağı [ASP.NET Core kimliği](xref:security/authentication/identity) [Razor sınıf kitaplığı](xref:razor-pages/ui-class). Kod ve kullanıcı Arabirimi için herhangi bir değişiklik kimlik UI kodu oluşturabilir. Kod değişikliklerinizi yeni iskele kurulmuş UI kodu için geçerlidir.
* Varolan kimlik 2.0 kodunuzu silin ve [İskele kimlik](xref:security/authentication/scaffold-identity) seçeneğini projenize **tüm dosyaları geçersiz kılma**.

### <a name="replace-identity-20-ui-with-the-identity-21-razor-class-library"></a>2.0 kimliğini değiştirmek UI kimlik 2.1 Razor sınıf kitaplığı

Bu bölümde ASP.NET Core 2.0 oluşturulan şablon kimliği koduyla değiştirmek için gereken adımları özetler [ASP.NET Core kimliği](xref:security/authentication/identity) [Razor sınıf kitaplığı](xref:razor-pages/ui-class). Aşağıdaki adımları için bir Razor sayfalarının projesini olsa da bir MVC proje için benzer bir yaklaşımdır.

* Doğrulama [proje dosyası 2.1 sürümlerini kullanmak üzere güncelleştirilir](#update-the-project-file-to-use-21-versions)
* Aşağıdaki klasörler ve içerdikleri tüm dosyaları silin:
  * *Denetleyiciler*
  * *Sayfa/hesap /*
  * *Uzantıları*
* Projeyi oluşturun.
* [İskele kimlik](xref:security/authentication/scaffold-identity) projenize:
  * Çıkma projeleri seçin *_Layout.cshtml* dosya.
  * Seçin **+** simgesine sağ tarafında **veri bağlamı sınıfı**. Varsayılan adı kabul edin.
  * Seçin **Ekle** yeni bir veri bağlamı sınıfı oluşturmak için. Yeni bir veri bağlamı oluşturma için iskele için gereklidir. Sonraki bölümde yeni veri bağlamı kaldırın.

### <a name="update-after-scaffolding-identity"></a>Kimlik iskele sonra güncelleştirme

* Oluşturulan kimlik iskele kurucu silme `IdentityDbContext` derrived sınıfında *alanları/kimlik/Data/* klasörü.
* Silme *Areas/Identity/IdentityHostingStartup.cs*
* Güncelleştirme *_LoginPartial.cshtml* dosyası:
  * Taşıma *Pages/_LoginPartial.cshtml* için *Pages/Shared/_LoginPartial.cshtml*
  * Ekleme `asp-area="Identity"` form ve bağlayıcı bağlantılar için.
  * Güncelleştirme `<form />` öğesi `    <form asp-area="Identity" asp-page="/Account/Logout" asp-route-returnUrl="@Url.Page("/Index", new { area = "" })" method="post" id="logoutForm" class="navbar-right">`

  Aşağıdaki kod güncelleştirilmiş gösterir *_LoginPartial.cshtml* dosyası:

  [!code-cshtml[Main](20_21/sample/_LoginPartial.cshtml?highlight=8,11,22,23)]

Güncelleştirme `ConfigureServices` aşağıdaki kod ile:

[!code-csharp[Main](20_21/sample/Startup2.cs?name=snippet)]

## <a name="changes-to-razor-pages-projects-razor-files"></a>Razor sayfalarının projeleri Razor dosyaları değiştirir

### <a name="the-layout-file"></a>Düzen dosyası

* Taşıma *Pages/_Layout.cshtml* için *Pages/Shared/_Layout.cshtml*
* *Layout.cshtml* dosyası aşağıdaki değişiklikler vardır:

  * `<partial name="_CookieConsentPartial" />` eklenir. Daha fazla bilgi için bkz: [GDPR destek ASP.NET Core](xref:security/gdpr).
  * 2.2.0 jQuery değişikliklerden 3.3.1 için

### <a name="validationscriptspartialcshtml"></a>_ValidationScriptsPartial.cshtml

* *Pages/_ValidationScriptsPartial.cshtml* taşır *Pages/Shared/_ValidationScriptsPartial.cshtml*
* *JQuery.Validate/1.14.0* değişikliklerini *jquery.validate/1.17.0*

### <a name="new-files"></a>Yeni dosyalar

Aşağıdaki dosyalar eklenir:

* *Privacy.cshtml*
* *Privacy.cshtml.cs*

Bkz: [GDPR destek ASP.NET Core](xref:security/gdpr) yukarıdaki dosyaları hakkında bilgi için.

## <a name="changes-to-mvc-projects-razor-files"></a>MVC projeleri Razor dosyalardaki değişiklikler

### <a name="the-layout-file"></a>Düzen dosyası

*Layout.cshtml* dosyası aşağıdaki değişiklikler vardır:

* `<partial name="_CookieConsentPartial" />` eklenir.
* 2.2.0 jQuery değişikliklerden 3.3.1 için

### <a name="validationscriptspartialcshtml"></a>_ValidationScriptsPartial.cshtml

*JQuery.Validate/1.14.0* değişikliklerini *jquery.validate/1.17.0*

### <a name="new-files-and-action-methods"></a>Yeni dosya ve eylem yöntemleri

Aşağıdaki eklenir:

* *Views/Home/Privacy.cshtml*
* `Privacy` Eylem yöntemi, giriş denetleyiciye eklenir.

Bkz: [GDPR destek ASP.NET Core](xref:security/gdpr) yukarıdaki dosyaları hakkında bilgi için.

## <a name="additional-changes"></a>Ek değişiklikler

* [SetCompatibilityVersion](xref:fundamentals/startup#setcompatibilityversion)
* [Taşıyıcı Yapılandırması](xref:fundamentals/servers/kestrel#transport-configuration)
