---
title: gRPC hizmetlerinin sürümünü oluşturma
author: jamesnk
description: gRPC hizmetlerini nasıl sürümedebilirsiniz öğrenin.
monikerRange: '>= aspnetcore-3.0'
ms.author: jamesnk
ms.date: 01/09/2020
uid: grpc/versioning
ms.openlocfilehash: 9bd76009ba28a1abef25a98686afea6753d4a8f4
ms.sourcegitcommit: f7886fd2e219db9d7ce27b16c0dc5901e658d64e
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 04/06/2020
ms.locfileid: "78664117"
---
# <a name="versioning-grpc-services"></a><span data-ttu-id="05998-103">gRPC hizmetlerinin sürümünü oluşturma</span><span class="sxs-lookup"><span data-stu-id="05998-103">Versioning gRPC services</span></span>

<span data-ttu-id="05998-104">Yazar: [James Newton-King](https://twitter.com/jamesnk)</span><span class="sxs-lookup"><span data-stu-id="05998-104">By [James Newton-King](https://twitter.com/jamesnk)</span></span>

<span data-ttu-id="05998-105">Bir uygulamaya eklenen yeni özellikler, istemcilere sağlanan gRPC hizmetlerinin bazen beklenmedik ve kopan şekillerde değişmesini gerektirebilir.</span><span class="sxs-lookup"><span data-stu-id="05998-105">New features added to an app can require gRPC services provided to clients to change, sometimes in unexpected and breaking ways.</span></span> <span data-ttu-id="05998-106">gRPC hizmetleri değiştiğinde:</span><span class="sxs-lookup"><span data-stu-id="05998-106">When gRPC services change:</span></span>

* <span data-ttu-id="05998-107">Değişikliklerin istemcileri nasıl etkilediğine dikkat edilmelidir.</span><span class="sxs-lookup"><span data-stu-id="05998-107">Consideration should be given on how changes impact clients.</span></span>
* <span data-ttu-id="05998-108">Değişiklikleri desteklemek için bir sürüm stratejisi uygulanmalıdır.</span><span class="sxs-lookup"><span data-stu-id="05998-108">A versioning strategy to support changes should be implemented.</span></span>

## <a name="backwards-compatibility"></a><span data-ttu-id="05998-109">Geriye dönük uyumluluk</span><span class="sxs-lookup"><span data-stu-id="05998-109">Backwards compatibility</span></span>

<span data-ttu-id="05998-110">gRPC protokolü, zaman içinde değişen hizmetleri desteklemek üzere tasarlanmıştır.</span><span class="sxs-lookup"><span data-stu-id="05998-110">The gRPC protocol is designed to support services that change over time.</span></span> <span data-ttu-id="05998-111">Genellikle, gRPC hizmetleri ve yöntemleri eklemeler kırılmaz.</span><span class="sxs-lookup"><span data-stu-id="05998-111">Generally, additions to gRPC services and methods are non-breaking.</span></span> <span data-ttu-id="05998-112">Kırılmayan değişiklikler, varolan istemcilerin değişiklik olmadan çalışmaya devam etmesine olanak sağlar.</span><span class="sxs-lookup"><span data-stu-id="05998-112">Non-breaking changes allow existing clients to continue working without changes.</span></span> <span data-ttu-id="05998-113">gRPC hizmetlerinin değiştirilmesi veya silmesi değişiklikleri bozuyor.</span><span class="sxs-lookup"><span data-stu-id="05998-113">Changing or deleting gRPC services are breaking changes.</span></span> <span data-ttu-id="05998-114">gRPC hizmetlerinde değişiklikler kırıldığında, bu hizmeti kullanan istemcilerin güncelleştirilip yeniden dağıtılması gerekir.</span><span class="sxs-lookup"><span data-stu-id="05998-114">When gRPC services have breaking changes, clients using that service have to be updated and redeployed.</span></span>

<span data-ttu-id="05998-115">Bir hizmette kırılmayan değişiklikler yapmanın bir takım avantajları vardır:</span><span class="sxs-lookup"><span data-stu-id="05998-115">Making non-breaking changes to a service has a number of benefits:</span></span>

* <span data-ttu-id="05998-116">Varolan istemciler çalışmaya devam ediyor.</span><span class="sxs-lookup"><span data-stu-id="05998-116">Existing clients continue to run.</span></span>
* <span data-ttu-id="05998-117">İstemcileri değişiklikleri kırma ve güncelleştirme konusunda bilgilendirmek le ilgili çalışmayı önler.</span><span class="sxs-lookup"><span data-stu-id="05998-117">Avoids work involved with notifying clients of breaking changes, and updating them.</span></span>
* <span data-ttu-id="05998-118">Hizmetin yalnızca bir sürümünün belgelenmesi ve bakımı gerekir.</span><span class="sxs-lookup"><span data-stu-id="05998-118">Only one version of the service needs to be documented and maintained.</span></span>

### <a name="non-breaking-changes"></a><span data-ttu-id="05998-119">Kırılmayan değişiklikler</span><span class="sxs-lookup"><span data-stu-id="05998-119">Non-breaking changes</span></span>

<span data-ttu-id="05998-120">Bu değişiklikler, gRPC protokol düzeyinde ve .NET ikili düzeyinde kırılmaz.</span><span class="sxs-lookup"><span data-stu-id="05998-120">These changes are non-breaking at a gRPC protocol level and .NET binary level.</span></span>

* <span data-ttu-id="05998-121">**Yeni bir hizmet ekleme**</span><span class="sxs-lookup"><span data-stu-id="05998-121">**Adding a new service**</span></span>
* <span data-ttu-id="05998-122">**Hizmete yeni bir yöntem ekleme**</span><span class="sxs-lookup"><span data-stu-id="05998-122">**Adding a new method to a service**</span></span>
* <span data-ttu-id="05998-123">**İstek iletisine alan ekleme** - İstek iletisine eklenen alanlar ayarlanmadığında sunucudaki [varsayılan değerle](https://developers.google.com/protocol-buffers/docs/proto3#default) birlikte deserialize edilir.</span><span class="sxs-lookup"><span data-stu-id="05998-123">**Adding a field to a request message** - Fields added to a request message are deserialized with the [default value](https://developers.google.com/protocol-buffers/docs/proto3#default) on the server when not set.</span></span> <span data-ttu-id="05998-124">Kesintisiz bir değişiklik olmak için, yeni alan eski istemciler tarafından ayarlanmıyorsa hizmetin başarılı olması gerekir.</span><span class="sxs-lookup"><span data-stu-id="05998-124">To be a non-breaking change, the service must succeed when the new field isn't set by older clients.</span></span>
* <span data-ttu-id="05998-125">**Yanıt iletisine alan ekleme** - Yanıt iletisine eklenen alanlar iletinin [istemcideki bilinmeyen alanlar](https://developers.google.com/protocol-buffers/docs/proto3#unknowns) koleksiyonuna deserialolarak eklenir.</span><span class="sxs-lookup"><span data-stu-id="05998-125">**Adding a field to a response message** - Fields added to a response message are deserialized into the message's [unknown fields](https://developers.google.com/protocol-buffers/docs/proto3#unknowns) collection on the client.</span></span>
* <span data-ttu-id="05998-126">**Bir enum için bir değer ekleme** - Enums sayısal bir değer olarak serihale edilir.</span><span class="sxs-lookup"><span data-stu-id="05998-126">**Adding a value to an enum** - Enums are serialized as a numeric value.</span></span> <span data-ttu-id="05998-127">Yeni enum değerleri, enum adı olmadan istemci üzerinde enum değerine deserialize edilir.</span><span class="sxs-lookup"><span data-stu-id="05998-127">New enum values are deserialized on the client to the enum value without an enum name.</span></span> <span data-ttu-id="05998-128">Son dakika değişikliği olmak için, eski istemcilerin yeni enum değerini alırken doğru çalışması gerekir.</span><span class="sxs-lookup"><span data-stu-id="05998-128">To be a non-breaking change, older clients must run correctly when receiving the new enum value.</span></span>

### <a name="binary-breaking-changes"></a><span data-ttu-id="05998-129">İkili kırılma değişiklikleri</span><span class="sxs-lookup"><span data-stu-id="05998-129">Binary breaking changes</span></span>

<span data-ttu-id="05998-130">Aşağıdaki değişiklikler bir gRPC protokolü düzeyinde kırılmaz, ancak istemci nin en son *.proto* sözleşmesine veya istemci .NET derlemesine yükseltilmesi durumunda güncelleştirilmelidir.</span><span class="sxs-lookup"><span data-stu-id="05998-130">The following changes are non-breaking at a gRPC protocol level, but the client needs to be updated if it upgrades to the latest *.proto* contract or client .NET assembly.</span></span> <span data-ttu-id="05998-131">NuGet'e bir gRPC kitaplığı yayımlamayı planlıyorsanız ikili uyumluluk önemlidir.</span><span class="sxs-lookup"><span data-stu-id="05998-131">Binary compatibility is important if you plan to publish a gRPC library to NuGet.</span></span>

* <span data-ttu-id="05998-132">**Alan kaldırma** - Kaldırılan alandaki değerler iletinin [bilinmeyen alanlarına](https://developers.google.com/protocol-buffers/docs/proto3#unknowns)deserialize edilir.</span><span class="sxs-lookup"><span data-stu-id="05998-132">**Removing a field** - Values from a removed field are deserialized to a message's [unknown fields](https://developers.google.com/protocol-buffers/docs/proto3#unknowns).</span></span> <span data-ttu-id="05998-133">Bu bir gRPC protokolü değiştirme kırma değil, ancak istemci en son sözleşmeye yükseltmeleri gerekir güncelleştirilmelidir.</span><span class="sxs-lookup"><span data-stu-id="05998-133">This isn't a gRPC protocol breaking change, but the client needs to be updated if it upgrades to the latest contract.</span></span> <span data-ttu-id="05998-134">Kaldırılan alan numarasının gelecekte yanlışlıkla yeniden kullanılmamış olması önemlidir.</span><span class="sxs-lookup"><span data-stu-id="05998-134">It's important that a removed field number isn't accidentally reused in the future.</span></span> <span data-ttu-id="05998-135">Bunun gerçekleşmediğinden emin olmak için, Protobuf'un [ayrılmış](https://developers.google.com/protocol-buffers/docs/proto3#reserved) anahtar sözcük lerini kullanarak iletideki silinmiş alan numaralarını ve adlarını belirtin.</span><span class="sxs-lookup"><span data-stu-id="05998-135">To ensure this doesn't happen, specify deleted field numbers and names on the message using Protobuf's [reserved](https://developers.google.com/protocol-buffers/docs/proto3#reserved) keyword.</span></span>
* <span data-ttu-id="05998-136">**İletiyi yeniden adlandırma** - İleti adları genellikle ağda gönderilmez, bu nedenle bu bir gRPC protokolü bozma değişikliği değildir.</span><span class="sxs-lookup"><span data-stu-id="05998-136">**Renaming a message** - Message names aren't typically sent on the network, so this isn't a gRPC protocol breaking change.</span></span> <span data-ttu-id="05998-137">En son sözleşmeye yükseltilmesi durumunda istemcinin güncellenmesi gerekir.</span><span class="sxs-lookup"><span data-stu-id="05998-137">The client will need to be updated if it upgrades to the latest contract.</span></span> <span data-ttu-id="05998-138">İleti **adlarının** ağda gönderildiği durumlardan biri, ileti adı ileti türünü tanımlamak için kullanıldığında [Herhangi bir](https://developers.google.com/protocol-buffers/docs/proto3#any) alandaki durumdur.</span><span class="sxs-lookup"><span data-stu-id="05998-138">One situation where message names **are** sent on the network is with [Any](https://developers.google.com/protocol-buffers/docs/proto3#any) fields, when the message name is used to identify the message type.</span></span>
* <span data-ttu-id="05998-139">**csharp_namespace değiştirme** `csharp_namespace` - Değiştirme, oluşturulan .NET türlerinin ad alanını değiştirir.</span><span class="sxs-lookup"><span data-stu-id="05998-139">**Changing csharp_namespace** - Changing `csharp_namespace` will change the namespace of generated .NET types.</span></span> <span data-ttu-id="05998-140">Bu bir gRPC protokolü değiştirme kırma değil, ancak istemci en son sözleşmeye yükseltmeleri gerekir güncelleştirilmelidir.</span><span class="sxs-lookup"><span data-stu-id="05998-140">This isn't a gRPC protocol breaking change, but the client needs to be updated if it upgrades to the latest contract.</span></span>

### <a name="protocol-breaking-changes"></a><span data-ttu-id="05998-141">Protokol kesme değişiklikleri</span><span class="sxs-lookup"><span data-stu-id="05998-141">Protocol breaking changes</span></span>

<span data-ttu-id="05998-142">Aşağıdaki öğeler protokol ve ikili kesme değişiklikleridir:</span><span class="sxs-lookup"><span data-stu-id="05998-142">The following items are protocol and binary breaking changes:</span></span>

* <span data-ttu-id="05998-143">**Bir alanı yeniden adlandırma** - Protobuf içeriğinde alan adları yalnızca oluşturulan kodda kullanılır.</span><span class="sxs-lookup"><span data-stu-id="05998-143">**Renaming a field** - With Protobuf content, the field names are only used in generated code.</span></span> <span data-ttu-id="05998-144">Alan numarası ağdaki alanları tanımlamak için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="05998-144">The field number is used to identify fields on the network.</span></span> <span data-ttu-id="05998-145">Bir alanı yeniden adlandırmak, Protobuf için bir protokol bozan bir değişiklik değildir.</span><span class="sxs-lookup"><span data-stu-id="05998-145">Renaming a field isn't a protocol breaking change for Protobuf.</span></span> <span data-ttu-id="05998-146">Ancak, bir sunucu JSON içeriğini kullanıyorsa, bir alanı yeniden adlandırmak bir kesme değişikliğidir.</span><span class="sxs-lookup"><span data-stu-id="05998-146">However, if a server is using JSON content then renaming a field is a breaking change.</span></span>
* <span data-ttu-id="05998-147">**Alan veri türünü değiştirme** - Bir alanın veri türünü uyumsuz bir [türle](https://developers.google.com/protocol-buffers/docs/proto3#updating) değiştirmek, iletiyi deserializing yaparken hatalara neden olur.</span><span class="sxs-lookup"><span data-stu-id="05998-147">**Changing a field data type** - Changing a field's data type to an [incompatible type](https://developers.google.com/protocol-buffers/docs/proto3#updating) will cause errors when deserializing the message.</span></span> <span data-ttu-id="05998-148">Yeni veri türü uyumlu olsa bile, istemcinin en son sözleşmeye yükseltilmesi durumunda yeni türü desteklemek için güncelleştirilmiş olması gerekir.</span><span class="sxs-lookup"><span data-stu-id="05998-148">Even if the new data type is compatible, it's likely the client needs to be updated to support the new type if it upgrades to the latest contract.</span></span>
* <span data-ttu-id="05998-149">**Alan numarası değiştirme** - Protobuf yükleri ile alan numarası ağdaki alanları tanımlamak için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="05998-149">**Changing a field number** - With Protobuf payloads, the field number is used to identify fields on the network.</span></span>
* <span data-ttu-id="05998-150">**Bir paketi, hizmeti veya yöntemi yeniden adlandırma** - gRPC URL'yi oluşturmak için paket adını, hizmet adını ve yöntem adını kullanır.</span><span class="sxs-lookup"><span data-stu-id="05998-150">**Renaming a package, service or method** - gRPC uses the package name, service name, and method name to build the URL.</span></span> <span data-ttu-id="05998-151">İstemci sunucudan *UYGULANMAMIŞ* bir durum alır.</span><span class="sxs-lookup"><span data-stu-id="05998-151">The client gets an *UNIMPLEMENTED* status from the server.</span></span>
* <span data-ttu-id="05998-152">**Bir hizmeti veya yöntemi kaldırma** - İstemci kaldırılan yöntemi ararken sunucudan *UYGULANMAMIŞ* bir durum alır.</span><span class="sxs-lookup"><span data-stu-id="05998-152">**Removing a service or method** - The client gets an *UNIMPLEMENTED* status from the server when calling the removed method.</span></span>

### <a name="behavior-breaking-changes"></a><span data-ttu-id="05998-153">Davranış kesme değişiklikleri</span><span class="sxs-lookup"><span data-stu-id="05998-153">Behavior breaking changes</span></span>

<span data-ttu-id="05998-154">Kesintisiz değişiklik yaparken, eski istemcilerin yeni hizmet davranışıyla çalışmaya devam edip edemeyeceğini de göz önünde bulundurmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="05998-154">When making non-breaking changes, you must also consider whether older clients can continue working with the new service behavior.</span></span> <span data-ttu-id="05998-155">Örneğin, istek iletisine yeni bir alan ekleme:</span><span class="sxs-lookup"><span data-stu-id="05998-155">For example, adding a new field to a request message:</span></span>

* <span data-ttu-id="05998-156">Protokolü bozan bir değişiklik değil.</span><span class="sxs-lookup"><span data-stu-id="05998-156">Isn't a protocol breaking change.</span></span>
* <span data-ttu-id="05998-157">Yeni alan ayarlanmıyorsa sunucuda bir hata durumu döndürülme, eski istemciler için bir kırılma değişikliği yapar.</span><span class="sxs-lookup"><span data-stu-id="05998-157">Returning an error status on the server if the new field isn't set makes it a breaking change for old clients.</span></span>

<span data-ttu-id="05998-158">Davranış uyumluluğu uygulamaya özgü kodunuz tarafından belirlenir.</span><span class="sxs-lookup"><span data-stu-id="05998-158">Behavior compatibility is determined by your app-specific code.</span></span>

## <a name="version-number-services"></a><span data-ttu-id="05998-159">Sürüm numarası hizmetleri</span><span class="sxs-lookup"><span data-stu-id="05998-159">Version number services</span></span>

<span data-ttu-id="05998-160">Hizmetler geriye eski istemciler ile uyumlu kalmak için çaba göstermelidir.</span><span class="sxs-lookup"><span data-stu-id="05998-160">Services should strive to remain backwards compatible with old clients.</span></span> <span data-ttu-id="05998-161">Sonunda uygulamanızda yapılan değişiklikler, son dakika değişikliklerini gerektirebilir.</span><span class="sxs-lookup"><span data-stu-id="05998-161">Eventually changes to your app may require breaking changes.</span></span> <span data-ttu-id="05998-162">Eski istemcileri kırmak ve onları hizmetinizle birlikte güncelleştirilmeye zorlamak iyi bir kullanıcı deneyimi değildir.</span><span class="sxs-lookup"><span data-stu-id="05998-162">Breaking old clients and forcing them to be updated along with your service isn't a good user experience.</span></span> <span data-ttu-id="05998-163">Kesme değişiklikleri yaparken geriye doğru uyumluluğu korumanın bir yolu, bir hizmetin birden çok sürümü yayımlamaktır.</span><span class="sxs-lookup"><span data-stu-id="05998-163">A way to maintain backwards compatibility while making breaking changes is to publish multiple versions of a service.</span></span>

<span data-ttu-id="05998-164">gRPC, .NET ad alanı gibi çalışan isteğe bağlı bir [paket](https://developers.google.com/protocol-buffers/docs/proto3#packages) belirteçini destekler.</span><span class="sxs-lookup"><span data-stu-id="05998-164">gRPC supports an optional [package](https://developers.google.com/protocol-buffers/docs/proto3#packages) specifier, which functions much like a .NET namespace.</span></span> <span data-ttu-id="05998-165">Aslında, *.proto* dosyasında ayarlanmazise `package` `option csharp_namespace` oluşturulan .NET türleri için .NET ad alanı olarak kullanılır.</span><span class="sxs-lookup"><span data-stu-id="05998-165">In fact, the `package` will be used as the .NET namespace for generated .NET types if `option csharp_namespace` is not set in the *.proto* file.</span></span> <span data-ttu-id="05998-166">Paket, hizmetiniz ve iletileri için bir sürüm numarası belirtmek için kullanılabilir:</span><span class="sxs-lookup"><span data-stu-id="05998-166">The package can be used to specify a version number for your service and its messages:</span></span>

[!code-protobuf[](versioning/sample/greet.v1.proto?highlight=3)]

<span data-ttu-id="05998-167">Paket adı, bir hizmet adresini tanımlamak için servis adı ile birleştirilir.</span><span class="sxs-lookup"><span data-stu-id="05998-167">The package name is combined with the service name to identify a service address.</span></span> <span data-ttu-id="05998-168">Hizmet adresi, bir hizmetin birden çok sürümüne yan yana barındırılmasına izin verir:</span><span class="sxs-lookup"><span data-stu-id="05998-168">A service address allows multiple versions of a service to be hosted side-by-side:</span></span>

* `greet.v1.Greeter`
* `greet.v2.Greeter`

<span data-ttu-id="05998-169">Sürümlü hizmetin uygulamaları *Startup.cs*kayıtlıdır:</span><span class="sxs-lookup"><span data-stu-id="05998-169">Implementations of the versioned service are registered in *Startup.cs*:</span></span>

```csharp
app.UseEndpoints(endpoints =>
{
    // Implements greet.v1.Greeter
    endpoints.MapGrpcService<GreeterServiceV1>();

    // Implements greet.v2.Greeter
    endpoints.MapGrpcService<GreeterServiceV2>();
});
```

<span data-ttu-id="05998-170">Paket adına bir sürüm numarası da dahil olmak, değişiklikleri kırarak hizmetinizin *v2* sürümünü yayımlama fırsatı sunarken, *v1* sürümünü arayan eski istemcileri desteklemeye devam edin.</span><span class="sxs-lookup"><span data-stu-id="05998-170">Including a version number in the package name gives you the opportunity to publish a *v2* version of your service with breaking changes, while continuing to support older clients who call the *v1* version.</span></span> <span data-ttu-id="05998-171">İstemciler *v2* hizmetini kullanmak üzere güncelleştirildikten sonra, eski sürümü kaldırmayı seçebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="05998-171">Once clients have updated to use the *v2* service, you can choose to remove the old version.</span></span> <span data-ttu-id="05998-172">Bir hizmetin birden çok sürümü yayımlanmayı planlarken:</span><span class="sxs-lookup"><span data-stu-id="05998-172">When planning to publish multiple versions of a service:</span></span>

* <span data-ttu-id="05998-173">Makulse değişiklikleri bozmaktan kaçının.</span><span class="sxs-lookup"><span data-stu-id="05998-173">Avoid breaking changes if reasonable.</span></span>
* <span data-ttu-id="05998-174">Kesme değişiklikleri yapmadan sürüm numarasını güncelleştirin.</span><span class="sxs-lookup"><span data-stu-id="05998-174">Don't update the version number unless making breaking changes.</span></span>
* <span data-ttu-id="05998-175">Kesme değişiklikleri yaptığınızda sürüm numarasını güncelleştirin.</span><span class="sxs-lookup"><span data-stu-id="05998-175">Do update the version number when you make breaking changes.</span></span>

<span data-ttu-id="05998-176">Bir hizmetin birden çok sürümü yayımlanır.</span><span class="sxs-lookup"><span data-stu-id="05998-176">Publishing multiple versions of a service duplicates it.</span></span> <span data-ttu-id="05998-177">Yinelemeyi azaltmak için, iş mantığını hizmet uygulamalarından eski ve yeni uygulamalar tarafından yeniden kullanılabilecek merkezi bir konuma taşımayı düşünün:</span><span class="sxs-lookup"><span data-stu-id="05998-177">To reduce duplication, consider moving business logic from the service implementations to a centralized location that can be reused by the old and new implementations:</span></span>

[!code-csharp[](versioning/sample/GreeterServiceV1.cs?highlight=10,19)]

<span data-ttu-id="05998-178">Farklı paket adlarıyla oluşturulan hizmetler ve iletiler **farklıdır .NET türleridir.**</span><span class="sxs-lookup"><span data-stu-id="05998-178">Services and messages generated with different package names are **different .NET types**.</span></span> <span data-ttu-id="05998-179">İş mantığını merkezi bir konuma taşımak, iletileri yaygın türlere eşleme gerektirir.</span><span class="sxs-lookup"><span data-stu-id="05998-179">Moving business logic to a centralized location requires mapping messages to common types.</span></span>
