---
title: ASP.NET Core 'de amaç hiyerarşisi ve çok kiracılı
author: rick-anderson
description: ASP.NET Core veri koruma API 'Leri ile ilişkili olduğu için amaç dize hiyerarşisi ve çok kiracılı olma hakkında bilgi edinin.
ms.author: riande
ms.date: 10/14/2016
no-loc:
- Blazor
- Blazor Server
- Blazor WebAssembly
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: security/data-protection/consumer-apis/purpose-strings-multitenancy
ms.openlocfilehash: 8f069da500e7bc06e4b8712fbf7b86d90a815758
ms.sourcegitcommit: d65a027e78bf0b83727f975235a18863e685d902
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 06/26/2020
ms.locfileid: "85404385"
---
# <a name="purpose-hierarchy-and-multi-tenancy-in-aspnet-core"></a><span data-ttu-id="9cf38-103">ASP.NET Core 'de amaç hiyerarşisi ve çok kiracılı</span><span class="sxs-lookup"><span data-stu-id="9cf38-103">Purpose hierarchy and multi-tenancy in ASP.NET Core</span></span>

<span data-ttu-id="9cf38-104">`IDataProtector`Ayrıca, örtük bir şekilde de olduğu `IDataProtectionProvider` için, bir amaç birlikte zincirlenebilir.</span><span class="sxs-lookup"><span data-stu-id="9cf38-104">Since an `IDataProtector` is also implicitly an `IDataProtectionProvider`, purposes can be chained together.</span></span> <span data-ttu-id="9cf38-105">Bu anlamda `provider.CreateProtector([ "purpose1", "purpose2" ])` ile eşdeğerdir `provider.CreateProtector("purpose1").CreateProtector("purpose2")` .</span><span class="sxs-lookup"><span data-stu-id="9cf38-105">In this sense, `provider.CreateProtector([ "purpose1", "purpose2" ])` is equivalent to `provider.CreateProtector("purpose1").CreateProtector("purpose2")`.</span></span>

<span data-ttu-id="9cf38-106">Bu, veri koruma sistemi aracılığıyla bazı ilginç hiyerarşik ilişkilerin kullanılmasına olanak tanır.</span><span class="sxs-lookup"><span data-stu-id="9cf38-106">This allows for some interesting hierarchical relationships through the data protection system.</span></span> <span data-ttu-id="9cf38-107">[Contoso. Messaging. securemessage](xref:security/data-protection/consumer-apis/purpose-strings#data-protection-contoso-purpose)dosyasındaki önceki örnekte, securemessage bileşeni bir `provider.CreateProtector("Contoso.Messaging.SecureMessage")` kez önyükleyebilir ve sonucu özel bir alana önbelleğe alabilir `_myProvider` .</span><span class="sxs-lookup"><span data-stu-id="9cf38-107">In the earlier example of [Contoso.Messaging.SecureMessage](xref:security/data-protection/consumer-apis/purpose-strings#data-protection-contoso-purpose), the SecureMessage component can call `provider.CreateProtector("Contoso.Messaging.SecureMessage")` once up-front and cache the result into a private `_myProvider` field.</span></span> <span data-ttu-id="9cf38-108">Daha sonra, yapılan çağrılar aracılığıyla daha sonra oluşturulabilir `_myProvider.CreateProtector("User: username")` ve bu koruyucular tek tek iletilerin güvenliğini sağlamak için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="9cf38-108">Future protectors can then be created via calls to `_myProvider.CreateProtector("User: username")`, and these protectors would be used for securing the individual messages.</span></span>

<span data-ttu-id="9cf38-109">Bu, ayrıca çevrilebilir.</span><span class="sxs-lookup"><span data-stu-id="9cf38-109">This can also be flipped.</span></span> <span data-ttu-id="9cf38-110">Birden çok kiracıyı barındıran tek bir mantıksal uygulamayı düşünün (bir CMS makul görünmektedir) ve her kiracı kendi kimlik doğrulama ve durum yönetim sistemiyle yapılandırılabilir.</span><span class="sxs-lookup"><span data-stu-id="9cf38-110">Consider a single logical application which hosts multiple tenants (a CMS seems reasonable), and each tenant can be configured with its own authentication and state management system.</span></span> <span data-ttu-id="9cf38-111">Şemsiye uygulaması tek bir ana sağlayıcıya sahiptir ve `provider.CreateProtector("Tenant 1")` `provider.CreateProtector("Tenant 2")` her kiracıya veri koruma sisteminin yalıtılmış dilimine vermek için ve çağırır.</span><span class="sxs-lookup"><span data-stu-id="9cf38-111">The umbrella application has a single master provider, and it calls `provider.CreateProtector("Tenant 1")` and `provider.CreateProtector("Tenant 2")` to give each tenant its own isolated slice of the data protection system.</span></span> <span data-ttu-id="9cf38-112">Kiracılar daha sonra kendi ihtiyaçlarına göre kendi bireysel koruyucularını türetebilir, ancak bunları ne kadar zor bir şekilde, sistemdeki diğer kiracılarla çakıştıkları bir koruyucu oluşturamazlar.</span><span class="sxs-lookup"><span data-stu-id="9cf38-112">The tenants could then derive their own individual protectors based on their own needs, but no matter how hard they try they cannot create protectors which collide with any other tenant in the system.</span></span> <span data-ttu-id="9cf38-113">Grafik olarak, aşağıda gösterildiği gibi gösterilir.</span><span class="sxs-lookup"><span data-stu-id="9cf38-113">Graphically, this is represented as below.</span></span>

![Çoklu kiracı amaçları](purpose-strings-multitenancy/_static/purposes-multi-tenancy.png)

>[!WARNING]
> <span data-ttu-id="9cf38-115">Bu, şemsiye uygulamanın hangi API 'Lerin tek tek kiracılar için kullanılabilir olduğunu ve kiracıların sunucuda rastgele kod yürütemeyeceğini varsayar.</span><span class="sxs-lookup"><span data-stu-id="9cf38-115">This assumes the umbrella application controls which APIs are available to individual tenants and that tenants cannot execute arbitrary code on the server.</span></span> <span data-ttu-id="9cf38-116">Bir kiracı rastgele kod yürütebileceği gibi, yalıtım garantilerini bölmek için özel yansıma gerçekleştirebilir veya doğrudan ana anahtar malzemesini okuyabilir ve istedikleri alt anahtarları türetebilir.</span><span class="sxs-lookup"><span data-stu-id="9cf38-116">If a tenant can execute arbitrary code, they could perform private reflection to break the isolation guarantees, or they could just read the master keying material directly and derive whatever subkeys they desire.</span></span>

<span data-ttu-id="9cf38-117">Veri koruma sistemi aslında, varsayılan kullanıma hazır yapılandırmasında çok kiracılı bir sıralama kullanır.</span><span class="sxs-lookup"><span data-stu-id="9cf38-117">The data protection system actually uses a sort of multi-tenancy in its default out-of-the-box configuration.</span></span> <span data-ttu-id="9cf38-118">Varsayılan olarak ana anahtar malzemesi, çalışan işlem hesabının kullanıcı profili klasöründe (veya IIS uygulama havuzu kimlikleri için kayıt defterinde) depolanır.</span><span class="sxs-lookup"><span data-stu-id="9cf38-118">By default master keying material is stored in the worker process account's user profile folder (or the registry, for IIS application pool identities).</span></span> <span data-ttu-id="9cf38-119">Ancak, çok sayıda uygulama çalıştırmak için tek bir hesap kullanmak oldukça yaygın bir şeydir ve bu nedenle, tüm bu uygulamalar ana anahtar malzemesini paylaşmayı sona erdirmek için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="9cf38-119">But it's actually fairly common to use a single account to run multiple applications, and thus all these applications would end up sharing the master keying material.</span></span> <span data-ttu-id="9cf38-120">Bunu çözümlemek için, veri koruma sistemi otomatik olarak benzersiz bir uygulama başına tanımlayıcıyı genel amaçlı zincirde ilk öğe olarak ekler.</span><span class="sxs-lookup"><span data-stu-id="9cf38-120">To solve this, the data protection system automatically inserts a unique-per-application identifier as the first element in the overall purpose chain.</span></span> <span data-ttu-id="9cf38-121">Bu örtük amaç, her uygulamayı sistem içinde benzersiz bir kiracı olarak kabul ederek [tek tek uygulamaları diğerlerinden yalıtmak](xref:security/data-protection/configuration/overview#per-application-isolation) için kullanılır ve koruyucu oluşturma işlemi yukarıdaki görüntüyle aynı şekilde görünür.</span><span class="sxs-lookup"><span data-stu-id="9cf38-121">This implicit purpose serves to [isolate individual applications](xref:security/data-protection/configuration/overview#per-application-isolation) from one another by effectively treating each application as a unique tenant within the system, and the protector creation process looks identical to the image above.</span></span>
