---
title: ASP.NET Core, Azure Key Vault yapılandırma sağlayıcısı
author: guardrex
description: Azure Key Vault yapılandırma sağlayıcısı, çalışma zamanında yüklenen ad-değer çiftleri kullanarak bir uygulamayı yapılandırmak için kullanmayı öğrenin.
monikerRange: '>= aspnetcore-1.1'
ms.author: riande
ms.custom: mvc
ms.date: 10/17/2018
uid: security/key-vault-configuration
ms.openlocfilehash: 474824cccdc63bb3dc3978ed68cf4c89cec12ad5
ms.sourcegitcommit: f43f430a166a7ec137fcad12ded0372747227498
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 10/17/2018
ms.locfileid: "49391148"
---
# <a name="azure-key-vault-configuration-provider-in-aspnet-core"></a><span data-ttu-id="c690e-103">ASP.NET Core, Azure Key Vault yapılandırma sağlayıcısı</span><span class="sxs-lookup"><span data-stu-id="c690e-103">Azure Key Vault configuration provider in ASP.NET Core</span></span>

<span data-ttu-id="c690e-104">Tarafından [Luke Latham](https://github.com/guardrex) ve [Andrew Stanton-Nurse](https://github.com/anurse)</span><span class="sxs-lookup"><span data-stu-id="c690e-104">By [Luke Latham](https://github.com/guardrex) and [Andrew Stanton-Nurse](https://github.com/anurse)</span></span>

<span data-ttu-id="c690e-105">Bu belgenin nasıl kullanıldığını açıklar [Microsoft Azure Key Vault](https://azure.microsoft.com/services/key-vault/) yapılandırma sağlayıcısı, Azure Key Vault gizli diziler uygulama yapılandırma değeri yüklenemiyor.</span><span class="sxs-lookup"><span data-stu-id="c690e-105">This document explains how to use the [Microsoft Azure Key Vault](https://azure.microsoft.com/services/key-vault/) configuration provider to load app configuration values from Azure Key Vault secrets.</span></span> <span data-ttu-id="c690e-106">Azure Key Vault, şifreleme anahtarlarını ve gizli uygulamaları ve Hizmetleri tarafından kullanılan korumanıza yardımcı olan bir bulut tabanlı bir hizmettir.</span><span class="sxs-lookup"><span data-stu-id="c690e-106">Azure Key Vault is a cloud-based service that helps you safeguard cryptographic keys and secrets used by apps and services.</span></span> <span data-ttu-id="c690e-107">Yapılandırma hassas verilere erişimi denetleme yaygın senaryolar şunlardır ve FIPS 140-2 gereksinimini karşılayan 2. düzey donanım güvenlik modülleri (HSM's) yapılandırma verileri depolarken doğrulandı.</span><span class="sxs-lookup"><span data-stu-id="c690e-107">Common scenarios include controlling access to sensitive configuration data and meeting the requirement for FIPS 140-2 Level 2 validated Hardware Security Modules (HSM's) when storing configuration data.</span></span> <span data-ttu-id="c690e-108">Bu özellik, daha yüksek veya ASP.NET Core 1.1 hedefleyen uygulamalar için kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="c690e-108">This feature is available for apps that target ASP.NET Core 1.1 or higher.</span></span>

<span data-ttu-id="c690e-109">[Görüntüleme veya indirme örnek kodu](https://github.com/aspnet/Docs/tree/master/aspnetcore/security/key-vault-configuration/samples) ([nasıl indirileceğini](xref:tutorials/index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="c690e-109">[View or download sample code](https://github.com/aspnet/Docs/tree/master/aspnetcore/security/key-vault-configuration/samples) ([how to download](xref:tutorials/index#how-to-download-a-sample))</span></span>

## <a name="package"></a><span data-ttu-id="c690e-110">Paket</span><span class="sxs-lookup"><span data-stu-id="c690e-110">Package</span></span>

<span data-ttu-id="c690e-111">Sağlayıcıyı kullanmak için bir başvuru ekleyin. [Microsoft.Extensions.Configuration.AzureKeyVault](https://www.nuget.org/packages/Microsoft.Extensions.Configuration.AzureKeyVault/) paket.</span><span class="sxs-lookup"><span data-stu-id="c690e-111">To use the provider, add a reference to the [Microsoft.Extensions.Configuration.AzureKeyVault](https://www.nuget.org/packages/Microsoft.Extensions.Configuration.AzureKeyVault/) package.</span></span>

## <a name="app-configuration"></a><span data-ttu-id="c690e-112">Uygulama yapılandırması</span><span class="sxs-lookup"><span data-stu-id="c690e-112">App configuration</span></span>

<span data-ttu-id="c690e-113">Sağlayıcı ile keşfedebilirsiniz [örnek uygulamalar](https://github.com/aspnet/Docs/tree/master/aspnetcore/security/key-vault-configuration/samples).</span><span class="sxs-lookup"><span data-stu-id="c690e-113">You can explore the provider with the [sample apps](https://github.com/aspnet/Docs/tree/master/aspnetcore/security/key-vault-configuration/samples).</span></span> <span data-ttu-id="c690e-114">Bir anahtar Kasası'kurmak ve gizli dizileri kasaya oluşturma sonra örnek uygulamaları güvenli bir şekilde gizli değerleri yapılandırmalarına yüklemek ve bunları sayfalarında görüntüler.</span><span class="sxs-lookup"><span data-stu-id="c690e-114">Once you establish a key vault and create secrets in the vault, the sample apps securely load the secret values into their configurations and display them in webpages.</span></span>

<span data-ttu-id="c690e-115">Sağlayıcı uygulamanın yapılandırmasına eklenen `AddAzureKeyVault` uzantısı.</span><span class="sxs-lookup"><span data-stu-id="c690e-115">The provider is added to the app's configuration with the `AddAzureKeyVault` extension.</span></span> <span data-ttu-id="c690e-116">Örnek uygulamalar, uzantı konumundan yüklendi üç yapılandırma değerlerini kullanır. *appsettings.json* dosya.</span><span class="sxs-lookup"><span data-stu-id="c690e-116">In the sample apps, the extension uses three configuration values loaded from the *appsettings.json* file.</span></span>

| <span data-ttu-id="c690e-117">Uygulama ayarı</span><span class="sxs-lookup"><span data-stu-id="c690e-117">App Setting</span></span>    | <span data-ttu-id="c690e-118">Açıklama</span><span class="sxs-lookup"><span data-stu-id="c690e-118">Description</span></span>                    | <span data-ttu-id="c690e-119">Örnek</span><span class="sxs-lookup"><span data-stu-id="c690e-119">Example</span></span>                                      |
| -------------- | ------------------------------ | -------------------------------------------- |
| `Vault`        | <span data-ttu-id="c690e-120">Azure Key Vault adı</span><span class="sxs-lookup"><span data-stu-id="c690e-120">Azure Key Vault name</span></span>           | <span data-ttu-id="c690e-121">contosovault</span><span class="sxs-lookup"><span data-stu-id="c690e-121">contosovault</span></span>                                 |
| `ClientId`     | <span data-ttu-id="c690e-122">Azure Active Directory Uygulama Kimliği</span><span class="sxs-lookup"><span data-stu-id="c690e-122">Azure Active Directory App Id</span></span>  | <span data-ttu-id="c690e-123">627e911e-43cc-61d4-992e-12db9c81b413</span><span class="sxs-lookup"><span data-stu-id="c690e-123">627e911e-43cc-61d4-992e-12db9c81b413</span></span>         |
| `ClientSecret` | <span data-ttu-id="c690e-124">Azure Active Directory Uygulama anahtarı</span><span class="sxs-lookup"><span data-stu-id="c690e-124">Azure Active Directory App Key</span></span> | <span data-ttu-id="c690e-125">g58K3dtg59o1Pa + e59v2Tx829w6VxTB2yv9sv/101di =</span><span class="sxs-lookup"><span data-stu-id="c690e-125">g58K3dtg59o1Pa+e59v2Tx829w6VxTB2yv9sv/101di=</span></span> |

[!code-csharp[Program](key-vault-configuration/samples/basic-sample/2.x/Program.cs?name=snippet1)]

## <a name="create-key-vault-secrets-and-load-configuration-values-basic-sample"></a><span data-ttu-id="c690e-126">Anahtar kasasına gizli anahtarları oluşturma ve yapılandırma değerleri (basic-sample) yükleme</span><span class="sxs-lookup"><span data-stu-id="c690e-126">Create key vault secrets and load configuration values (basic-sample)</span></span>

1. <span data-ttu-id="c690e-127">Key vault oluşturma ve Azure Active Directory'yi (Azure AD) ayarlama, yönergeleri izleyerek uygulamayı ayarlamak [Azure anahtar kasası ile çalışmaya başlama](https://azure.microsoft.com/documentation/articles/key-vault-get-started/).</span><span class="sxs-lookup"><span data-stu-id="c690e-127">Create a key vault and set up Azure Active Directory (Azure AD) for the app following the guidance in [Get started with Azure Key Vault](https://azure.microsoft.com/documentation/articles/key-vault-get-started/).</span></span>
   * <span data-ttu-id="c690e-128">Gizli anahtar kasası kullanmaya ekleme [AzureRM anahtar kasası PowerShell modülünü](/powershell/module/azurerm.keyvault) kullanılabilir [PowerShell Galerisi](https://www.powershellgallery.com/packages/AzureRM.KeyVault), [Azure anahtar kasası REST API](/rest/api/keyvault/), veya [Azure portalında](https://portal.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="c690e-128">Add secrets to the key vault using the [AzureRM Key Vault PowerShell Module](/powershell/module/azurerm.keyvault) available from the [PowerShell Gallery](https://www.powershellgallery.com/packages/AzureRM.KeyVault), the [Azure Key Vault REST API](/rest/api/keyvault/), or the [Azure Portal](https://portal.azure.com/).</span></span> <span data-ttu-id="c690e-129">Gizli dizileri olarak oluşturulur *el ile* veya *sertifika* gizli dizileri.</span><span class="sxs-lookup"><span data-stu-id="c690e-129">Secrets are created as either *Manual* or *Certificate* secrets.</span></span> <span data-ttu-id="c690e-130">*Sertifika* gizli uygulamaları ve Hizmetleri tarafından kullanılmak üzere sertifikalar, ancak yapılandırma sağlayıcısı tarafından desteklenmiyor.</span><span class="sxs-lookup"><span data-stu-id="c690e-130">*Certificate* secrets are certificates for use by apps and services but are not supported by the configuration provider.</span></span> <span data-ttu-id="c690e-131">Kullanmanız gereken *el ile* ad-değer çifti gizli dizileri kullanmak için yapılandırma sağlayıcısı ile oluşturmak için seçeneği.</span><span class="sxs-lookup"><span data-stu-id="c690e-131">You should use the *Manual* option to create name-value pair secrets for use with the configuration provider.</span></span>
     * <span data-ttu-id="c690e-132">Basit parolaları ad-değer çiftleri olarak oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="c690e-132">Simple secrets are created as name-value pairs.</span></span> <span data-ttu-id="c690e-133">Azure Key Vault'a gizli dizi adları yalnızca alfasayısal karakter ve tire sınırlıdır.</span><span class="sxs-lookup"><span data-stu-id="c690e-133">Azure Key Vault secret names are limited to alphanumeric characters and dashes.</span></span>
     * <span data-ttu-id="c690e-134">Hiyerarşik değerleri (yapılandırma bölümlerini) kullanmak `--` (iki kısa çizgi) örnekteki ayırıcı olarak.</span><span class="sxs-lookup"><span data-stu-id="c690e-134">Hierarchical values (configuration sections) use `--` (two dashes) as a separator in the sample.</span></span> <span data-ttu-id="c690e-135">Normalde bir alt anahtarında bölümünden sınırlandırmak için kullanılan iki nokta üst üste, [ASP.NET Core yapılandırma](xref:fundamentals/configuration/index), gizli adlarında izin verilmez.</span><span class="sxs-lookup"><span data-stu-id="c690e-135">Colons, which are normally used to delimit a section from a subkey in [ASP.NET Core configuration](xref:fundamentals/configuration/index), aren't allowed in secret names.</span></span> <span data-ttu-id="c690e-136">Bu nedenle, iki kısa çizgi kullanılan ve gizli dizileri uygulama yapılandırma yüklendiğinde bir iki nokta üst üste takas.</span><span class="sxs-lookup"><span data-stu-id="c690e-136">Therefore, two dashes are used and swapped for a colon when the secrets are loaded into the app's configuration.</span></span>
     * <span data-ttu-id="c690e-137">İki *el ile* aşağıdaki ad-değer çiftleri ile gizli dizileri.</span><span class="sxs-lookup"><span data-stu-id="c690e-137">Create two *Manual* secrets with the following name-value pairs.</span></span> <span data-ttu-id="c690e-138">İlk gizli dizi basit bir ad ve değer ve ikinci gizli bir bölüm ve alt anahtarında gizli anahtar adı ile gizli değer oluşturur.:</span><span class="sxs-lookup"><span data-stu-id="c690e-138">The first secret is a simple name and value, and the second secret creates a secret value with a section and subkey in the secret name:</span></span>
       * <span data-ttu-id="c690e-139">`SecretName`: `secret_value_1`</span><span class="sxs-lookup"><span data-stu-id="c690e-139">`SecretName`: `secret_value_1`</span></span>
       * <span data-ttu-id="c690e-140">`Section--SecretName`: `secret_value_2`</span><span class="sxs-lookup"><span data-stu-id="c690e-140">`Section--SecretName`: `secret_value_2`</span></span>
   * <span data-ttu-id="c690e-141">Örnek uygulamayı Azure Active Directory ile kaydedin.</span><span class="sxs-lookup"><span data-stu-id="c690e-141">Register the sample app with Azure Active Directory.</span></span>
   * <span data-ttu-id="c690e-142">Anahtar kasasına erişmek için uygulamayı yetkilendirme.</span><span class="sxs-lookup"><span data-stu-id="c690e-142">Authorize the app to access the key vault.</span></span> <span data-ttu-id="c690e-143">Kullanırken `Set-AzureRmKeyVaultAccessPolicy` uygulamanın anahtar kasasına erişim yetkisi vermek için PowerShell cmdlet'i sağlar `List` ve `Get` ile gizli dizilere erişim `-PermissionsToSecrets list,get`.</span><span class="sxs-lookup"><span data-stu-id="c690e-143">When you use the `Set-AzureRmKeyVaultAccessPolicy` PowerShell cmdlet to authorize the app to access the key vault, provide `List` and `Get` access to secrets with `-PermissionsToSecrets list,get`.</span></span>

2. <span data-ttu-id="c690e-144">Uygulamanın güncelleştirme *appsettings.json* değerlerini dosyasıyla `Vault`, `ClientId`, ve `ClientSecret`.</span><span class="sxs-lookup"><span data-stu-id="c690e-144">Update the app's *appsettings.json* file with the values of `Vault`, `ClientId`, and `ClientSecret`.</span></span>
3. <span data-ttu-id="c690e-145">Kendi yapılandırma değerlerinden alır örnek uygulamayı çalıştırma `IConfigurationRoot` gizli dizi adı olarak aynı ada sahip.</span><span class="sxs-lookup"><span data-stu-id="c690e-145">Run the sample app, which obtains its configuration values from `IConfigurationRoot` with the same name as the secret name.</span></span>
   * <span data-ttu-id="c690e-146">Hiyerarşik olmayan değerleri: değeri `SecretName` ile elde edilen `config["SecretName"]`.</span><span class="sxs-lookup"><span data-stu-id="c690e-146">Non-hierarchical values: The value for `SecretName` is obtained with `config["SecretName"]`.</span></span>
   * <span data-ttu-id="c690e-147">Hiyerarşik değerleri (bölümleri): kullanım `:` (virgül) gösterimi veya `GetSection` genişletme yöntemi.</span><span class="sxs-lookup"><span data-stu-id="c690e-147">Hierarchical values (sections): Use `:` (colon) notation or the `GetSection` extension method.</span></span> <span data-ttu-id="c690e-148">Yapılandırma değeri elde etmek için Bu yaklaşımlardan birini kullanın:</span><span class="sxs-lookup"><span data-stu-id="c690e-148">Use either of these approaches to obtain the configuration value:</span></span>
     * `config["Section:SecretName"]`
     * `config.GetSection("Section")["SecretName"]`

<span data-ttu-id="c690e-149">Uygulamayı çalıştırdığınızda, bir Web sayfası yüklü gizli değerleri gösterir:</span><span class="sxs-lookup"><span data-stu-id="c690e-149">When you run the app, a webpage shows the loaded secret values:</span></span>

![Azure Key Vault yapılandırma sağlayıcısı yüklenen gizli değerlerini gösteren tarayıcı penceresi](key-vault-configuration/_static/sample1.png)

## <a name="bind-an-array-to-a-class"></a><span data-ttu-id="c690e-151">Bir dizi bir sınıfa Bağla</span><span class="sxs-lookup"><span data-stu-id="c690e-151">Bind an array to a class</span></span>

<span data-ttu-id="c690e-152">Sağlayıcı bir POCO diziye bağlama için bir dizi halinde yapılandırma değerlerini okuma yeteneğine sahiptir.</span><span class="sxs-lookup"><span data-stu-id="c690e-152">The provider is capable of reading configuration values into an array for binding to a POCO array.</span></span>

<span data-ttu-id="c690e-153">İki nokta üst üste içerecek şekilde anahtarları izin veren bir yapılandırma kaynaktan okunurken (`:`) ayırıcı, sayısal bir anahtar kesimi bir dizi kurulumu yapın anahtarları ayırt etmek için kullanılır (`:0:`, `:1:`,...</span><span class="sxs-lookup"><span data-stu-id="c690e-153">When reading from a configuration source that allows keys to contain colon (`:`) separators, a numeric key segment is used to distinguish the keys that make up an array (`:0:`, `:1:`, …</span></span> <span data-ttu-id="c690e-154">`:{n}:`).</span><span class="sxs-lookup"><span data-stu-id="c690e-154">`:{n}:`).</span></span> <span data-ttu-id="c690e-155">Daha fazla bilgi için [yapılandırma: bir sınıf için bir dizi bağlama](xref:fundamentals/configuration/index#bind-an-array-to-a-class).</span><span class="sxs-lookup"><span data-stu-id="c690e-155">For more information, see [Configuration: Bind an array to a class](xref:fundamentals/configuration/index#bind-an-array-to-a-class).</span></span>

<span data-ttu-id="c690e-156">Azure anahtar kasası anahtarlarını bir iki nokta üst üste ayırıcı olarak kullanamazsınız.</span><span class="sxs-lookup"><span data-stu-id="c690e-156">Azure Key Vault keys can't use a colon as a separator.</span></span> <span data-ttu-id="c690e-157">Bu konuda açıklanan yaklaşımı çift tire kullanır (`--`) hiyerarşik değerleri (bölümleri) için ayırıcı olarak.</span><span class="sxs-lookup"><span data-stu-id="c690e-157">The approach described in this topic uses double dashes (`--`) as a separator for hierarchical values (sections).</span></span> <span data-ttu-id="c690e-158">Dizi anahtarları, Azure anahtar Kasası'nda depolanır, çift çizgi ve sayısal anahtar kesimlerini (`--0--`, `--1--`,...</span><span class="sxs-lookup"><span data-stu-id="c690e-158">Array keys are stored in Azure Key Vault with double dashes and numeric key segments (`--0--`, `--1--`, …</span></span> <span data-ttu-id="c690e-159">`--{n}--`).</span><span class="sxs-lookup"><span data-stu-id="c690e-159">`--{n}--`).</span></span>

<span data-ttu-id="c690e-160">Aşağıdaki inceleyin [Serilog](https://serilog.net/) bir JSON dosyası tarafından sağlanan sağlayıcı yapılandırması günlüğe kaydetme.</span><span class="sxs-lookup"><span data-stu-id="c690e-160">Examine the following [Serilog](https://serilog.net/) logging provider configuration provided by a JSON file.</span></span> <span data-ttu-id="c690e-161">İki nesne içinde tanımlanan sabit değerler vardır `WriteTo` iki Serilog yansıtan bir dizi *havuzlarını*, günlük çıktısı hedefler açıklanmaktadır:</span><span class="sxs-lookup"><span data-stu-id="c690e-161">There are two object literals defined in the `WriteTo` array that reflect two Serilog *sinks*, which describe destinations for logging output:</span></span>

```json
"Serilog": {
  "WriteTo": [
    {
      "Name": "AzureTableStorage",
      "Args": {
        "storageTableName": "logs",
        "connectionString": "DefaultEnd...ountKey=Eby8...GMGw=="
      }
    },
    {
      "Name": "AzureDocumentDB",
      "Args": {
        "endpointUrl": "https://contoso.documents.azure.com:443",
        "authorizationKey": "Eby8...GMGw=="
      }
    }
  ]
}
```

<span data-ttu-id="c690e-162">Yukarıdaki JSON dosyasında gösterilen yapılandırma çift tire kullanarak Azure Key Vault içinde depolanır (`--`) gösterimi ve sayısal segmentleri:</span><span class="sxs-lookup"><span data-stu-id="c690e-162">The configuration shown in the preceding JSON file is stored in Azure Key Vault using double dash (`--`) notation and numeric segments:</span></span>

| <span data-ttu-id="c690e-163">Anahtar</span><span class="sxs-lookup"><span data-stu-id="c690e-163">Key</span></span> | <span data-ttu-id="c690e-164">Değer</span><span class="sxs-lookup"><span data-stu-id="c690e-164">Value</span></span> |
| --- | ----- |
| `Serilog--WriteTo--0--Name` | `AzureTableStorage` |
| `Serilog--WriteTo--0--Args--storageTableName` | `logs` |
| `Serilog--WriteTo--0--Args--connectionString` | `DefaultEnd...ountKey=Eby8...GMGw==` |
| `Serilog--WriteTo--1--Name` | `AzureDocumentDB` |
| `Serilog--WriteTo--1--Args--endpointUrl` | `https://contoso.documents.azure.com:443` |
| `Serilog--WriteTo--1--Args--authorizationKey` | `Eby8...GMGw==` |

## <a name="create-prefixed-key-vault-secrets-and-load-configuration-values-key-name-prefix-sample"></a><span data-ttu-id="c690e-165">Önekli anahtar kasasına gizli anahtarları oluşturma ve yapılandırma değerleri (anahtar-adı-önek-sample) yükleme</span><span class="sxs-lookup"><span data-stu-id="c690e-165">Create prefixed key vault secrets and load configuration values (key-name-prefix-sample)</span></span>

<span data-ttu-id="c690e-166">`AddAzureKeyVault` Ayrıca uygulaması kabul eden bir aşırı sağlar `IKeyVaultSecretManager`, nasıl anahtar kasa gizli dizilerini denetlemenize olanak sağlayan yapılandırma anahtarları dönüştürülür.</span><span class="sxs-lookup"><span data-stu-id="c690e-166">`AddAzureKeyVault` also provides an overload that accepts an implementation of `IKeyVaultSecretManager`, which allows you to control how key vault secrets are converted into configuration keys.</span></span> <span data-ttu-id="c690e-167">Örneğin, uygulama başlatma sırasında sağladığınız bir önek değere göre gizli değerlerini yüklemek için arabirim uygulayabilir.</span><span class="sxs-lookup"><span data-stu-id="c690e-167">For example, you can implement the interface to load secret values based on a prefix value you provide at app startup.</span></span> <span data-ttu-id="c690e-168">Bu, örneğin, gizli dizileri uygulama sürümüne yüklemek için sağlar.</span><span class="sxs-lookup"><span data-stu-id="c690e-168">This allows you, for example, to load secrets based on the version of the app.</span></span>

> [!WARNING]
> <span data-ttu-id="c690e-169">Ön ekleri için birden fazla uygulama gizli dizilerini aynı anahtar kasasının yerleştirmek için veya çevre gizli dizileri yerleştirmek için anahtar kasası parolaları kullanmayın (örneğin, *geliştirme* karşı *üretim* gizli Diziler) aynı içine Kasa.</span><span class="sxs-lookup"><span data-stu-id="c690e-169">Don't use prefixes on key vault secrets to place secrets for multiple apps into the same key vault or to place environmental secrets (for example, *development* versus *production* secrets) into the same vault.</span></span> <span data-ttu-id="c690e-170">Farklı uygulama ve geliştirme veya üretim ortamları ayrı anahtar kasalarını yüksek düzeyde güvenlik için uygulama ortamları ayırmak için kullanmanızı öneririz.</span><span class="sxs-lookup"><span data-stu-id="c690e-170">We recommend that different apps and development/production environments use separate key vaults to isolate app environments for the highest level of security.</span></span>

<span data-ttu-id="c690e-171">İkinci örnek uygulaması kullanarak, bir gizli dizi için anahtar kasasını oluşturduğunuz `5000-AppSecret` (anahtar kasası gizli dizi adları nokta izin verilmiyor) temsil eden bir uygulama gizli anahtarı için uygulamanızın 5.0.0.0 sürümü.</span><span class="sxs-lookup"><span data-stu-id="c690e-171">Using the second sample app, you create a secret in the key vault for `5000-AppSecret` (periods aren't allowed in key vault secret names) representing an app secret for version 5.0.0.0 of your app.</span></span> <span data-ttu-id="c690e-172">Gizli dizi için oluşturduğunuz başka bir sürümü için 5.1.0.0, `5100-AppSecret`.</span><span class="sxs-lookup"><span data-stu-id="c690e-172">For another version, 5.1.0.0, you create a secret for `5100-AppSecret`.</span></span> <span data-ttu-id="c690e-173">Her uygulama sürümü kendi gizli değer yapılandırmasına yükler `AppSecret`, çıkarma sürümü gibi gizli dizi yükler.</span><span class="sxs-lookup"><span data-stu-id="c690e-173">Each app version loads its own secret value into its configuration as `AppSecret`, stripping off the version as it loads the secret.</span></span> <span data-ttu-id="c690e-174">Örnek'ın uygulama aşağıda gösterilmiştir:</span><span class="sxs-lookup"><span data-stu-id="c690e-174">The sample's implementation is shown below:</span></span>

[!code-csharp[Configuration builder](key-vault-configuration/samples/key-name-prefix-sample/2.x/Program.cs?name=snippet1&highlight=18)]

[!code-csharp[PrefixKeyVaultSecretManager](key-vault-configuration/samples/key-name-prefix-sample/2.x/Startup.cs?name=snippet1)]

<span data-ttu-id="c690e-175">`Load` Yöntemi sürüm önekine sahip olanları bulmak için kasa gizli dizilerini yinelenen bir sağlayıcı algoritması tarafından çağrılır.</span><span class="sxs-lookup"><span data-stu-id="c690e-175">The `Load` method is called by a provider algorithm that iterates through the vault secrets to find the ones that have the version prefix.</span></span> <span data-ttu-id="c690e-176">Ne zaman bir sürüm ön eki bulundu ile `Load`, algoritmasını `GetKey` gizli dizi adı yapılandırma adını döndürmek için yöntemi.</span><span class="sxs-lookup"><span data-stu-id="c690e-176">When a version prefix is found with `Load`, the algorithm uses the `GetKey` method to return the configuration name of the secret name.</span></span> <span data-ttu-id="c690e-177">Parolanın adı sürüm önekten kapalı kaldırır ve gizli dizi adı yüklenmesi için kalan ad-değer çiftleri uygulamanın yapılandırmasını döndürür.</span><span class="sxs-lookup"><span data-stu-id="c690e-177">It strips off the version prefix from the secret's name and returns the rest of the secret name for loading into the app's configuration name-value pairs.</span></span>

<span data-ttu-id="c690e-178">Bu yaklaşım uyguladığınızda:</span><span class="sxs-lookup"><span data-stu-id="c690e-178">When you implement this approach:</span></span>

1. <span data-ttu-id="c690e-179">Anahtar kasası gizli dizileri yüklenir.</span><span class="sxs-lookup"><span data-stu-id="c690e-179">The key vault secrets are loaded.</span></span>
2. <span data-ttu-id="c690e-180">Dize gizliliğini `5000-AppSecret` eşleştirilir.</span><span class="sxs-lookup"><span data-stu-id="c690e-180">The string secret for `5000-AppSecret` is matched.</span></span>
3. <span data-ttu-id="c690e-181">Sürüm `5000` (ile dash), anahtar adına bırakarak yapılandırıldıktan `AppSecret` gizli değer ile uygulamanın yapılandırma yüklenemedi.</span><span class="sxs-lookup"><span data-stu-id="c690e-181">The version, `5000` (with the dash), is stripped off of the key name leaving `AppSecret` to load with the secret value into the app's configuration.</span></span>

> [!NOTE]
> <span data-ttu-id="c690e-182">Ayrıca kendi sağlayabilirsiniz `KeyVaultClient` uygulamasına `AddAzureKeyVault`.</span><span class="sxs-lookup"><span data-stu-id="c690e-182">You can also provide your own `KeyVaultClient` implementation to `AddAzureKeyVault`.</span></span> <span data-ttu-id="c690e-183">Özel bir istemci sağlama istemci yapılandırma sağlayıcısı ve uygulamanızın diğer bölümleri arasındaki tek bir örneğini paylaşmanıza olanak tanır.</span><span class="sxs-lookup"><span data-stu-id="c690e-183">Supplying a custom client allows you to share a single instance of the client between the configuration provider and other parts of your app.</span></span>

1. <span data-ttu-id="c690e-184">Key vault oluşturma ve Azure Active Directory'yi (Azure AD) ayarlama, yönergeleri izleyerek uygulamayı ayarlamak [Azure anahtar kasası ile çalışmaya başlama](https://azure.microsoft.com/documentation/articles/key-vault-get-started/).</span><span class="sxs-lookup"><span data-stu-id="c690e-184">Create a key vault and set up Azure Active Directory (Azure AD) for the app following the guidance in [Get started with Azure Key Vault](https://azure.microsoft.com/documentation/articles/key-vault-get-started/).</span></span>
   * <span data-ttu-id="c690e-185">Gizli anahtar kasası kullanmaya ekleme [AzureRM anahtar kasası PowerShell modülünü](/powershell/module/azurerm.keyvault) kullanılabilir [PowerShell Galerisi](https://www.powershellgallery.com/packages/AzureRM.KeyVault), [Azure anahtar kasası REST API](/rest/api/keyvault/), veya [Azure portalında](https://portal.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="c690e-185">Add secrets to the key vault using the [AzureRM Key Vault PowerShell Module](/powershell/module/azurerm.keyvault) available from the [PowerShell Gallery](https://www.powershellgallery.com/packages/AzureRM.KeyVault), the [Azure Key Vault REST API](/rest/api/keyvault/), or the [Azure Portal](https://portal.azure.com/).</span></span> <span data-ttu-id="c690e-186">Gizli dizileri olarak oluşturulur *el ile* veya *sertifika* gizli dizileri.</span><span class="sxs-lookup"><span data-stu-id="c690e-186">Secrets are created as either *Manual* or *Certificate* secrets.</span></span> <span data-ttu-id="c690e-187">*Sertifika* gizli uygulamaları ve Hizmetleri tarafından kullanılmak üzere sertifikalar, ancak yapılandırma sağlayıcısı tarafından desteklenmiyor.</span><span class="sxs-lookup"><span data-stu-id="c690e-187">*Certificate* secrets are certificates for use by apps and services but are not supported by the configuration provider.</span></span> <span data-ttu-id="c690e-188">Kullanmanız gereken *el ile* ad-değer çifti gizli dizileri kullanmak için yapılandırma sağlayıcısı ile oluşturmak için seçeneği.</span><span class="sxs-lookup"><span data-stu-id="c690e-188">You should use the *Manual* option to create name-value pair secrets for use with the configuration provider.</span></span>
     * <span data-ttu-id="c690e-189">Hiyerarşik değerleri (yapılandırma bölümlerini) kullanmak `--` (iki kısa çizgi) ayırıcı olarak.</span><span class="sxs-lookup"><span data-stu-id="c690e-189">Hierarchical values (configuration sections) use `--` (two dashes) as a separator.</span></span>
     * <span data-ttu-id="c690e-190">İki *el ile* aşağıdaki ad-değer çiftleri sahip gizli diziler:</span><span class="sxs-lookup"><span data-stu-id="c690e-190">Create two *Manual* secrets with the following name-value pairs:</span></span>
       * <span data-ttu-id="c690e-191">`5000-AppSecret`: `5.0.0.0_secret_value`</span><span class="sxs-lookup"><span data-stu-id="c690e-191">`5000-AppSecret`: `5.0.0.0_secret_value`</span></span>
       * <span data-ttu-id="c690e-192">`5100-AppSecret`: `5.1.0.0_secret_value`</span><span class="sxs-lookup"><span data-stu-id="c690e-192">`5100-AppSecret`: `5.1.0.0_secret_value`</span></span>
   * <span data-ttu-id="c690e-193">Örnek uygulamayı Azure Active Directory ile kaydedin.</span><span class="sxs-lookup"><span data-stu-id="c690e-193">Register the sample app with Azure Active Directory.</span></span>
   * <span data-ttu-id="c690e-194">Anahtar kasasına erişmek için uygulamayı yetkilendirme.</span><span class="sxs-lookup"><span data-stu-id="c690e-194">Authorize the app to access the key vault.</span></span> <span data-ttu-id="c690e-195">Kullanırken `Set-AzureRmKeyVaultAccessPolicy` uygulamanın anahtar kasasına erişim yetkisi vermek için PowerShell cmdlet'i sağlar `List` ve `Get` ile gizli dizilere erişim `-PermissionsToSecrets list,get`.</span><span class="sxs-lookup"><span data-stu-id="c690e-195">When you use the `Set-AzureRmKeyVaultAccessPolicy` PowerShell cmdlet to authorize the app to access the key vault, provide `List` and `Get` access to secrets with `-PermissionsToSecrets list,get`.</span></span>

2. <span data-ttu-id="c690e-196">Uygulamanın güncelleştirme *appsettings.json* değerlerini dosyasıyla `Vault`, `ClientId`, ve `ClientSecret`.</span><span class="sxs-lookup"><span data-stu-id="c690e-196">Update the app's *appsettings.json* file with the values of `Vault`, `ClientId`, and `ClientSecret`.</span></span>
3. <span data-ttu-id="c690e-197">Kendi yapılandırma değerlerinden alır örnek uygulamayı çalıştırma `IConfigurationRoot` önekli gizli dizi adı olarak aynı ada sahip.</span><span class="sxs-lookup"><span data-stu-id="c690e-197">Run the sample app, which obtains its configuration values from `IConfigurationRoot` with the same name as the prefixed secret name.</span></span> <span data-ttu-id="c690e-198">Bu örnekte, için sağlanan uygulamanın sürüm önekidir `PrefixKeyVaultSecretManager` Azure Key Vault yapılandırma sağlayıcısı eklediğiniz zaman.</span><span class="sxs-lookup"><span data-stu-id="c690e-198">In this sample, the prefix is the app's version, which you provided to the `PrefixKeyVaultSecretManager` when you added the Azure Key Vault configuration provider.</span></span> <span data-ttu-id="c690e-199">Değeri `AppSecret` ile elde edilen `config["AppSecret"]`.</span><span class="sxs-lookup"><span data-stu-id="c690e-199">The value for `AppSecret` is obtained with `config["AppSecret"]`.</span></span> <span data-ttu-id="c690e-200">Yüklenen değer uygulama tarafından oluşturulan Web sayfası gösterilmektedir:</span><span class="sxs-lookup"><span data-stu-id="c690e-200">The webpage generated by the app shows the loaded value:</span></span>

   ![Uygulamanın sürümü 5.0.0.0 olduğunda Azure Key Vault yapılandırma sağlayıcısı yüklenen bir gizli değer gösteren tarayıcı penceresi](key-vault-configuration/_static/sample2-1.png)

4. <span data-ttu-id="c690e-202">Proje dosyasından Uygulama derlemesinde sürümünü değiştirmek `5.0.0.0` için `5.1.0.0` ve uygulamayı yeniden çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="c690e-202">Change the version of the app assembly in the project file from `5.0.0.0` to `5.1.0.0` and run the app again.</span></span> <span data-ttu-id="c690e-203">Bu süre, döndürülen gizli değerdir `5.1.0.0_secret_value`.</span><span class="sxs-lookup"><span data-stu-id="c690e-203">This time, the secret value returned is `5.1.0.0_secret_value`.</span></span> <span data-ttu-id="c690e-204">Yüklenen değer uygulama tarafından oluşturulan Web sayfası gösterilmektedir:</span><span class="sxs-lookup"><span data-stu-id="c690e-204">The webpage generated by the app shows the loaded value:</span></span>

   ![Uygulamanın sürümü 5.1.0.0 olduğunda Azure Key Vault yapılandırma sağlayıcısı yüklenen bir gizli değer gösteren tarayıcı penceresi](key-vault-configuration/_static/sample2-2.png)

## <a name="control-access-to-the-clientsecret"></a><span data-ttu-id="c690e-206">ClientSecret erişimi denetleme</span><span class="sxs-lookup"><span data-stu-id="c690e-206">Control access to the ClientSecret</span></span>

<span data-ttu-id="c690e-207">Kullanım [gizli dizi Yöneticisi aracını](xref:security/app-secrets) korumak için `ClientSecret` proje kaynak ağacınız dışında.</span><span class="sxs-lookup"><span data-stu-id="c690e-207">Use the [Secret Manager tool](xref:security/app-secrets) to maintain the `ClientSecret` outside of your project source tree.</span></span> <span data-ttu-id="c690e-208">Gizli dizi Yöneticisi ile uygulama gizli anahtarlarının belirli bir proje ile ilişkilendirmek ve birden çok projede paylaşın.</span><span class="sxs-lookup"><span data-stu-id="c690e-208">With Secret Manager, you associate app secrets with a specific project and share them across multiple projects.</span></span>

<span data-ttu-id="c690e-209">Sertifikalar'ı destekleyen bir ortamda bir .NET Framework uygulama geliştirirken, Azure anahtar Kasası'na bir X.509 sertifikası ile kimlik doğrulaması yapabilir.</span><span class="sxs-lookup"><span data-stu-id="c690e-209">When developing a .NET Framework app in an environment that supports certificates, you can authenticate to Azure Key Vault with an X.509 certificate.</span></span> <span data-ttu-id="c690e-210">X.509 sertifikasının özel anahtar, işletim sistemi tarafından yönetilir.</span><span class="sxs-lookup"><span data-stu-id="c690e-210">The X.509 certificate's private key is managed by the OS.</span></span> <span data-ttu-id="c690e-211">Daha fazla bilgi için [bir sertifika yerine istemci gizli anahtarı ile kimlik doğrulama](https://docs.microsoft.com/azure/key-vault/key-vault-use-from-web-application#authenticate-with-a-certificate-instead-of-a-client-secret).</span><span class="sxs-lookup"><span data-stu-id="c690e-211">For more information, see [Authenticate with a Certificate instead of a Client Secret](https://docs.microsoft.com/azure/key-vault/key-vault-use-from-web-application#authenticate-with-a-certificate-instead-of-a-client-secret).</span></span> <span data-ttu-id="c690e-212">Kullanım `AddAzureKeyVault` kabul eden aşırı bir `X509Certificate2` (`_env` aşağıdaki örnekte:</span><span class="sxs-lookup"><span data-stu-id="c690e-212">Use the `AddAzureKeyVault` overload that accepts an `X509Certificate2` (`_env` in the following example :</span></span>

```csharp
var builtConfig = config.Build();

var store = new X509Store(StoreLocation.CurrentUser);
store.Open(OpenFlags.ReadOnly);
var cert = store.Certificates
    .Find(X509FindType.FindByThumbprint, 
        config["CertificateThumbprint"], false);

config.AddAzureKeyVault(
    builtConfig["Vault"],
    builtConfig["ClientId"],
    cert.OfType<X509Certificate2>().Single(),
    new EnvironmentSecretManager(context.HostingEnvironment.ApplicationName));

store.Close();
```

## <a name="reload-secrets"></a><span data-ttu-id="c690e-213">Gizli dizileri yeniden yükleyin</span><span class="sxs-lookup"><span data-stu-id="c690e-213">Reload secrets</span></span>

<span data-ttu-id="c690e-214">Gizli dizileri kadar önbelleğe alınır `IConfigurationRoot.Reload()` çağrılır.</span><span class="sxs-lookup"><span data-stu-id="c690e-214">Secrets are cached until `IConfigurationRoot.Reload()` is called.</span></span> <span data-ttu-id="c690e-215">Süresi dolan, devre dışı bırakıldı ve güncelleştirilmiş gizli anahtarları key vault'ta değil kadar uygulama tarafından dikkate `Reload` yürütülür.</span><span class="sxs-lookup"><span data-stu-id="c690e-215">Expired, disabled, and updated secrets in the key vault are not respected by the app until `Reload` is executed.</span></span>

```csharp
Configuration.Reload();
```

## <a name="disabled-and-expired-secrets"></a><span data-ttu-id="c690e-216">Devre dışı bırakılmış ve süresi dolan gizli diziler</span><span class="sxs-lookup"><span data-stu-id="c690e-216">Disabled and expired secrets</span></span>

<span data-ttu-id="c690e-217">Devre dışı bırakılmış ve süresi dolan gizli diziler throw bir `KeyVaultClientException`.</span><span class="sxs-lookup"><span data-stu-id="c690e-217">Disabled and expired secrets throw a `KeyVaultClientException`.</span></span> <span data-ttu-id="c690e-218">Uygulamanızı oluşturma gelen önlemek için uygulamanızı değiştirin veya devre dışı bırakılmış/süresi dolmuş gizli anahtarı güncelleştirme.</span><span class="sxs-lookup"><span data-stu-id="c690e-218">To prevent your app from throwing, replace your app or update the disabled/expired secret.</span></span>

## <a name="troubleshoot"></a><span data-ttu-id="c690e-219">Sorun giderme</span><span class="sxs-lookup"><span data-stu-id="c690e-219">Troubleshoot</span></span>

<span data-ttu-id="c690e-220">Yapılandırma Sağlayıcısı'nı kullanarak yüklemek uygulama başarısız olduğunda, bir hata iletisi yazılan [ASP.NET Core günlüğü altyapı](xref:fundamentals/logging/index).</span><span class="sxs-lookup"><span data-stu-id="c690e-220">When the app fails to load configuration using the provider, an error message is written to the [ASP.NET Core Logging infrastructure](xref:fundamentals/logging/index).</span></span> <span data-ttu-id="c690e-221">Aşağıdaki koşullar yapılandırma yüklenmesini engeller.</span><span class="sxs-lookup"><span data-stu-id="c690e-221">The following conditions will prevent configuration from loading:</span></span>

* <span data-ttu-id="c690e-222">Uygulamayı Azure Active Directory'de doğru şekilde yapılandırılmamış.</span><span class="sxs-lookup"><span data-stu-id="c690e-222">The app isn't configured correctly in Azure Active Directory.</span></span>
* <span data-ttu-id="c690e-223">Anahtar kasası, Azure anahtar Kasası'nda mevcut değil.</span><span class="sxs-lookup"><span data-stu-id="c690e-223">The key vault doesn't exist in Azure Key Vault.</span></span>
* <span data-ttu-id="c690e-224">Uygulama, anahtar kasasına erişmek için yetkili değil.</span><span class="sxs-lookup"><span data-stu-id="c690e-224">The app isn't authorized to access the key vault.</span></span>
* <span data-ttu-id="c690e-225">Erişim İlkesi içermez `Get` ve `List` izinleri.</span><span class="sxs-lookup"><span data-stu-id="c690e-225">The access policy doesn't include `Get` and `List` permissions.</span></span>
* <span data-ttu-id="c690e-226">Anahtar Kasası'nda yapılandırma verileri (ad-değer çifti) yanlış, eksik, devre dışı veya süresi dolmuş olarak adlandırılır.</span><span class="sxs-lookup"><span data-stu-id="c690e-226">In the key vault, the configuration data (name-value pair) is incorrectly named, missing, disabled, or expired.</span></span>
* <span data-ttu-id="c690e-227">Uygulama, yanlış anahtar kasası adına sahip (`Vault`), Azure AD uygulama kimliği (`ClientId`), veya Azure AD anahtarı (`ClientSecret`).</span><span class="sxs-lookup"><span data-stu-id="c690e-227">The app has the wrong key vault name (`Vault`), Azure AD App Id (`ClientId`), or Azure AD Key (`ClientSecret`).</span></span>
* <span data-ttu-id="c690e-228">Azure AD anahtarı (`ClientSecret`) süresi doldu.</span><span class="sxs-lookup"><span data-stu-id="c690e-228">The Azure AD Key (`ClientSecret`) is expired.</span></span>
* <span data-ttu-id="c690e-229">Yapılandırma anahtarı (ad), uygulamayı yüklemeye çalıştığınız değeri geçersiz.</span><span class="sxs-lookup"><span data-stu-id="c690e-229">The configuration key (name) is incorrect in the app for the value you're trying to load.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="c690e-230">Ek kaynaklar</span><span class="sxs-lookup"><span data-stu-id="c690e-230">Additional resources</span></span>

* <xref:fundamentals/configuration/index>
* [<span data-ttu-id="c690e-231">Microsoft Azure: Anahtar kasası</span><span class="sxs-lookup"><span data-stu-id="c690e-231">Microsoft Azure: Key Vault</span></span>](https://azure.microsoft.com/services/key-vault/)
* [<span data-ttu-id="c690e-232">Microsoft Azure: Anahtar kasası belgeleri</span><span class="sxs-lookup"><span data-stu-id="c690e-232">Microsoft Azure: Key Vault Documentation</span></span>](/azure/key-vault/)
* [<span data-ttu-id="c690e-233">Azure anahtar kasası için nasıl oluşturma ve aktarma HSM korumalı anahtarlar</span><span class="sxs-lookup"><span data-stu-id="c690e-233">How to generate and transfer HSM-protected keys for Azure Key Vault</span></span>](/azure/key-vault/key-vault-hsm-protected-keys)
* [<span data-ttu-id="c690e-234">KeyVaultClient sınıfı</span><span class="sxs-lookup"><span data-stu-id="c690e-234">KeyVaultClient Class</span></span>](/dotnet/api/microsoft.azure.keyvault.keyvaultclient)
