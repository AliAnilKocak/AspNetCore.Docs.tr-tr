---
title: EF çekirdek - CRUD - 2, 10 ile ASP.NET Core MVC
author: rick-anderson
description: ''
ms.author: tdykstra
ms.date: 03/15/2017
uid: data/ef-mvc/crud
ms.openlocfilehash: bc02ee6933634cc5987dbc3fcf57b0cce5a93bef
ms.sourcegitcommit: c6ed2f00c7a08223d79090396b85793718b0dd69
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 06/29/2018
ms.locfileid: "37093107"
---
# <a name="aspnet-core-mvc-with-ef-core---crud---2-of-10"></a><span data-ttu-id="cdfe0-102">EF çekirdek - CRUD - 2, 10 ile ASP.NET Core MVC</span><span class="sxs-lookup"><span data-stu-id="cdfe0-102">ASP.NET Core MVC with EF Core - CRUD - 2 of 10</span></span>

[!INCLUDE [RP better than MVC](~/includes/RP-EF/rp-over-mvc-21.md)]

::: moniker range="= aspnetcore-2.0"

<span data-ttu-id="cdfe0-103">Tarafından [zel Dykstra](https://github.com/tdykstra) ve [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="cdfe0-103">By [Tom Dykstra](https://github.com/tdykstra) and [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

<span data-ttu-id="cdfe0-104">Contoso University örnek web uygulaması Entity Framework Çekirdek ve Visual Studio kullanarak ASP.NET Core MVC web uygulamalarının nasıl oluşturulacağını gösterir.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-104">The Contoso University sample web application demonstrates how to create ASP.NET Core MVC web applications using Entity Framework Core and Visual Studio.</span></span> <span data-ttu-id="cdfe0-105">Eğitmen serisi hakkında daha fazla bilgi için bkz: [serideki ilk öğreticide](intro.md).</span><span class="sxs-lookup"><span data-stu-id="cdfe0-105">For information about the tutorial series, see [the first tutorial in the series](intro.md).</span></span>

<span data-ttu-id="cdfe0-106">Önceki öğreticide depolayan ve SQL Server yerel veritabanı ve Entity Framework kullanarak verileri görüntüleyen bir MVC uygulaması oluşturuldu.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-106">In the previous tutorial, you created an MVC application that stores and displays data using the Entity Framework and SQL Server LocalDB.</span></span> <span data-ttu-id="cdfe0-107">Bu öğreticide, gözden geçirmenizi ve CRUD özelleştirme (oluşturma, okuma, güncelleştirme, silme) MVC yapı iskelesi otomatik olarak denetleyicileri ve görünümlerde oluşturur kodu.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-107">In this tutorial, you'll review and customize the CRUD (create, read, update, delete) code that the MVC scaffolding automatically creates for you in controllers and views.</span></span>

> [!NOTE]
> <span data-ttu-id="cdfe0-108">Denetleyicinizi ve veri erişim katmanı arasındaki bir Soyutlama Katmanı oluşturmak için havuz deseni uygulamak için yaygın bir uygulamadır.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-108">It's a common practice to implement the repository pattern in order to create an abstraction layer between your controller and the data access layer.</span></span> <span data-ttu-id="cdfe0-109">Bu öğreticiler basit ve Entity Framework kullanmayı öğretmek odaklanmıştır tutmak için bunlar depoları kullanmayın.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-109">To keep these tutorials simple and focused on teaching how to use the Entity Framework itself, they don't use repositories.</span></span> <span data-ttu-id="cdfe0-110">Depoları EF ile ilgili daha fazla bilgi için bkz: [bu serideki son Öğreticisi](advanced.md).</span><span class="sxs-lookup"><span data-stu-id="cdfe0-110">For information about repositories with EF, see [the last tutorial in this series](advanced.md).</span></span>

<span data-ttu-id="cdfe0-111">Bu öğreticide, aşağıdaki web sayfalarının çalışması:</span><span class="sxs-lookup"><span data-stu-id="cdfe0-111">In this tutorial, you'll work with the following web pages:</span></span>

![Öğrenci Ayrıntıları sayfası](crud/_static/student-details.png)

![Öğrenci Oluştur sayfası](crud/_static/student-create.png)

![Öğrenci Düzenle sayfası](crud/_static/student-edit.png)

![Öğrenci Sil sayfası](crud/_static/student-delete.png)

## <a name="customize-the-details-page"></a><span data-ttu-id="cdfe0-116">Ayrıntılar sayfasını özelleştirme</span><span class="sxs-lookup"><span data-stu-id="cdfe0-116">Customize the Details page</span></span>

<span data-ttu-id="cdfe0-117">Öğrenciler dizin sayfası için kurulmuş kod sol `Enrollments` özelliği, bunun nedeni, bu özelliği bir koleksiyon.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-117">The scaffolded code for the Students Index page left out the `Enrollments` property, because that property holds a collection.</span></span> <span data-ttu-id="cdfe0-118">İçinde **ayrıntıları** sayfasında, bir HTML tablosunda koleksiyonunun içeriğini görüntülersiniz.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-118">In the **Details** page, you'll display the contents of the collection in an HTML table.</span></span>

<span data-ttu-id="cdfe0-119">İçinde *Controllers/StudentsController.cs*, Ayrıntılar için eylem yöntemini kullanır görüntüleyin `SingleOrDefaultAsync` tek bir alma yöntemi `Student` varlık.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-119">In *Controllers/StudentsController.cs*, the action method for the Details view uses the `SingleOrDefaultAsync` method to retrieve a single `Student` entity.</span></span> <span data-ttu-id="cdfe0-120">Çağıran kodu eklemek `Include`.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-120">Add code that calls `Include`.</span></span> <span data-ttu-id="cdfe0-121">`ThenInclude`, ve `AsNoTracking` vurgulanan aşağıdaki kodda gösterildiği gibi yöntemleri.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-121">`ThenInclude`,  and `AsNoTracking` methods, as shown in the following highlighted code.</span></span>

[!code-csharp[](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_Details&highlight=8-12)]

<span data-ttu-id="cdfe0-122">`Include` Ve `ThenInclude` yöntemleri neden yüklemek bağlam `Student.Enrollments` gezinti özelliği ve her kayıt içinde `Enrollment.Course` gezinti özelliği.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-122">The `Include` and `ThenInclude` methods cause the context to load the `Student.Enrollments` navigation property, and within each enrollment the `Enrollment.Course` navigation property.</span></span>  <span data-ttu-id="cdfe0-123">Bu yöntemleri hakkında daha fazla bilgi edineceksiniz [ilgili veri okuma](read-related-data.md) Öğreticisi.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-123">You'll learn more about these methods in the [read related data](read-related-data.md) tutorial.</span></span>

<span data-ttu-id="cdfe0-124">`AsNoTracking` Yöntemi burada döndürülen varlıklar olmaz güncelleştirilmesi geçerli bağlamın yaşam süresi senaryolarda performansı artırır.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-124">The `AsNoTracking` method improves performance in scenarios where the entities returned won't be updated in the current context's lifetime.</span></span> <span data-ttu-id="cdfe0-125">Daha fazla hakkında bilgi edineceksiniz `AsNoTracking` Bu öğreticinin sonunda.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-125">You'll learn more about `AsNoTracking` at the end of this tutorial.</span></span>

### <a name="route-data"></a><span data-ttu-id="cdfe0-126">Rota verileri</span><span class="sxs-lookup"><span data-stu-id="cdfe0-126">Route data</span></span>

<span data-ttu-id="cdfe0-127">Geçirilen anahtar değeri `Details` yöntemi gelir *rota veri*.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-127">The key value that's passed to the `Details` method comes from *route data*.</span></span> <span data-ttu-id="cdfe0-128">Rota verilerini, model bağlayıcı URL kesimdeki bulunan verilerdir.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-128">Route data is data that the model binder found in a segment of the URL.</span></span> <span data-ttu-id="cdfe0-129">Örneğin, denetleyici, eylem ve kimliği kesimleri varsayılan yolu belirtir:</span><span class="sxs-lookup"><span data-stu-id="cdfe0-129">For example, the default route specifies controller, action, and id segments:</span></span>

[!code-csharp[](intro/samples/cu/Startup.cs?name=snippet_Route&highlight=5)]

<span data-ttu-id="cdfe0-130">Aşağıdaki URL'de denetleyici, eylem olarak dizin ve kimlik olarak 1 olarak Eğitmen varsayılan rotayı eşler; Rota veri değerleri şunlardır.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-130">In the following URL, the default route maps Instructor as the controller, Index as the action, and 1 as the id; these are route data values.</span></span>

```
http://localhost:1230/Instructor/Index/1?courseID=2021
```

<span data-ttu-id="cdfe0-131">URL son parçası ("? courseID 2021 =") bir sorgu dizesi değeridir.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-131">The last part of the URL ("?courseID=2021") is a query string value.</span></span> <span data-ttu-id="cdfe0-132">Model bağlayıcı Ayrıca kimliği değerine geçer `Details` yöntemi `id` sorgu dize değeri geçirirseniz parametre:</span><span class="sxs-lookup"><span data-stu-id="cdfe0-132">The model binder will also pass the ID value to the `Details` method `id` parameter if you pass it as a query string value:</span></span>

```
http://localhost:1230/Instructor/Index?id=1&CourseID=2021
```

<span data-ttu-id="cdfe0-133">Dizin sayfasında köprü URL'leri Razor görünümünde etiket Yardımcısı deyimleri tarafından oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-133">In the Index page, hyperlink URLs are created by tag helper statements in the Razor view.</span></span> <span data-ttu-id="cdfe0-134">Aşağıdaki Razor kodunda `id` parametreyle eşleşen varsayılan yol, bu nedenle `id` rota verilerini eklenir.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-134">In the following Razor code, the `id` parameter matches the default route, so `id` is added to the route data.</span></span>

```html
<a asp-action="Edit" asp-route-id="@item.ID">Edit</a>
```

<span data-ttu-id="cdfe0-135">Bu aşağıdaki HTML oluşturur, `item.ID` 6:</span><span class="sxs-lookup"><span data-stu-id="cdfe0-135">This generates the following HTML when `item.ID` is 6:</span></span>

```html
<a href="/Students/Edit/6">Edit</a>
```

<span data-ttu-id="cdfe0-136">Aşağıdaki Razor kodunda `studentID` sorgu dizesi olarak eklenmiş şekilde varsayılan yol parametresinde eşleşmiyor.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-136">In the following Razor code, `studentID` doesn't match a parameter in the default route, so it's added as a query string.</span></span>

```html
<a asp-action="Edit" asp-route-studentID="@item.ID">Edit</a>
```

<span data-ttu-id="cdfe0-137">Bu aşağıdaki HTML oluşturur, `item.ID` 6:</span><span class="sxs-lookup"><span data-stu-id="cdfe0-137">This generates the following HTML when `item.ID` is 6:</span></span>

```html
<a href="/Students/Edit?studentID=6">Edit</a>
```

<span data-ttu-id="cdfe0-138">Etiket yardımcıları hakkında daha fazla bilgi için bkz: [etiket Yardımcıları ASP.NET Core](xref:mvc/views/tag-helpers/intro).</span><span class="sxs-lookup"><span data-stu-id="cdfe0-138">For more information about tag helpers, see [Tag helpers in ASP.NET Core](xref:mvc/views/tag-helpers/intro).</span></span>

### <a name="add-enrollments-to-the-details-view"></a><span data-ttu-id="cdfe0-139">Ayrıntılar görünümü kayıtları ekleyin</span><span class="sxs-lookup"><span data-stu-id="cdfe0-139">Add enrollments to the Details view</span></span>

<span data-ttu-id="cdfe0-140">Açık *Views/Students/Details.cshtml*.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-140">Open *Views/Students/Details.cshtml*.</span></span> <span data-ttu-id="cdfe0-141">Her bir alan kullanılarak görüntülenen `DisplayNameFor` ve `DisplayFor` aşağıdaki örnekte gösterildiği gibi Yardımcıları:</span><span class="sxs-lookup"><span data-stu-id="cdfe0-141">Each field is displayed using `DisplayNameFor` and `DisplayFor` helpers, as shown in the following example:</span></span>

[!code-html[](intro/samples/cu/Views/Students/Details.cshtml?range=13-18&highlight=2,5)]

<span data-ttu-id="cdfe0-142">Son alan sonra ve hemen kapatmadan önce `</dl>` etiketi, kayıtları listesini görüntülemek için aşağıdaki kodu ekleyin:</span><span class="sxs-lookup"><span data-stu-id="cdfe0-142">After the last field and immediately before the closing `</dl>` tag, add the following code to display a list of enrollments:</span></span>

[!code-html[](intro/samples/cu/Views/Students/Details.cshtml?range=31-52)]

<span data-ttu-id="cdfe0-143">Kod yapıştırıldıktan sonra kod girintileme yanlışsa, düzeltmek için CTRL-K-D tuşuna basın.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-143">If code indentation is wrong after you paste the code, press CTRL-K-D to correct it.</span></span>

<span data-ttu-id="cdfe0-144">Bu kod, varlıklarda döngü `Enrollments` gezinti özelliği.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-144">This code loops through the entities in the `Enrollments` navigation property.</span></span> <span data-ttu-id="cdfe0-145">Her kayıt için indirmelere başlık ve sınıf görüntüler.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-145">For each enrollment, it displays the course title and the grade.</span></span> <span data-ttu-id="cdfe0-146">İndirmelere başlık depolanan indirmelere varlık alınır `Course` kayıtları varlık gezinti özelliği.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-146">The course title is retrieved from the Course entity that's stored in the `Course` navigation property of the Enrollments entity.</span></span>

<span data-ttu-id="cdfe0-147">Uygulama, belirleyin **Öğrenciler** sekmesine ve tıklayın **ayrıntıları** Öğrenci için bağlantı.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-147">Run the app, select the **Students** tab, and click the **Details** link for a student.</span></span> <span data-ttu-id="cdfe0-148">Kurslar ve dereceleri listesi için seçilen Öğrenci bakın:</span><span class="sxs-lookup"><span data-stu-id="cdfe0-148">You see the list of courses and grades for the selected student:</span></span>

![Öğrenci Ayrıntıları sayfası](crud/_static/student-details.png)

## <a name="update-the-create-page"></a><span data-ttu-id="cdfe0-150">Güncelleştirme Oluştur sayfası</span><span class="sxs-lookup"><span data-stu-id="cdfe0-150">Update the Create page</span></span>

<span data-ttu-id="cdfe0-151">İçinde *StudentsController.cs*, HttpPost değiştirmek `Create` try-catch bloğu ekleyerek ve Kimliğinden kaldırma yöntemi `Bind` özniteliği.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-151">In *StudentsController.cs*, modify the HttpPost `Create` method by adding a try-catch block and removing ID from the `Bind` attribute.</span></span>

[!code-csharp[](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_Create&highlight=4,6-7,14-21)]

<span data-ttu-id="cdfe0-152">Bu kod, ASP.NET MVC model bağlayıcı Öğrenciler varlığa tarafından oluşturulan Öğrenci varlık ayarlayın ve ardından değişiklikleri veritabanına kaydeder ekler.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-152">This code adds the Student entity created by the ASP.NET MVC model binder to the Students entity set and then saves the changes to the database.</span></span> <span data-ttu-id="cdfe0-153">(Bir form tarafından sunulan verilerle çalışmayı kolaylaştırır ASP.NET MVC işlevlerini model bağlayıcı başvurduğu; bir model bağlayıcı gönderilen form değerleri CLR türlerine dönüştürür ve eylem yönteminin parametrelerini geçirir.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-153">(Model binder refers to the ASP.NET MVC functionality that makes it easier for you to work with data submitted by a form; a model binder converts posted form values to CLR types and passes them to the action method in parameters.</span></span> <span data-ttu-id="cdfe0-154">Bu durumda, model bağlayıcı Öğrenci varlık, Form koleksiyonu özellik değerleri kullanarak başlatır.)</span><span class="sxs-lookup"><span data-stu-id="cdfe0-154">In this case, the model binder instantiates a Student entity for you using property values from the Form collection.)</span></span>

<span data-ttu-id="cdfe0-155">Kaldırılan `ID` gelen `Bind` kimliği satır zaman eklenen SQL Server otomatik olarak ayarlayacak birincil anahtar değeri olduğundan özniteliği.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-155">You removed `ID` from the `Bind` attribute because ID is the primary key value which SQL Server will set automatically when the row is inserted.</span></span> <span data-ttu-id="cdfe0-156">Kullanıcı girişi kimliği değeri ayarlamaz.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-156">Input from the user doesn't set the ID value.</span></span>

<span data-ttu-id="cdfe0-157">Dışında `Bind` , try-catch bloğu bir özniteliktir kurulmuş kodu yapılan tek değişiklik.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-157">Other than the `Bind` attribute, the try-catch block is the only change you've made to the scaffolded code.</span></span> <span data-ttu-id="cdfe0-158">Türetilen bir özel durum, `DbUpdateException` olan değişiklikler kaydedilirken yakalandı, genel bir hata iletisi görüntülenir.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-158">If an exception that derives from `DbUpdateException` is caught while the changes are being saved, a generic error message is displayed.</span></span> <span data-ttu-id="cdfe0-159">`DbUpdateException` Kullanıcı yeniden denemek için tavsiye edilir şekilde özel durumlar bazen bir programlama hatası yerine uygulama için dış bir şey tarafından hatalardır.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-159">`DbUpdateException` exceptions are sometimes caused by something external to the application rather than a programming error, so the user is advised to try again.</span></span> <span data-ttu-id="cdfe0-160">Bu örnekte uygulanmadı karşın, bir üretim kalitesi uygulama özel durum oturum açabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-160">Although not implemented in this sample, a production quality application would log the exception.</span></span> <span data-ttu-id="cdfe0-161">Daha fazla bilgi için bkz: **hakkında bilgi için günlük** bölümüne [izleme ve Telemetri (yapı gerçek bulut uygulamaları Azure ile)](https://docs.microsoft.com/aspnet/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/monitoring-and-telemetry).</span><span class="sxs-lookup"><span data-stu-id="cdfe0-161">For more information, see the **Log for insight** section in [Monitoring and Telemetry (Building Real-World Cloud Apps with Azure)](https://docs.microsoft.com/aspnet/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/monitoring-and-telemetry).</span></span>

<span data-ttu-id="cdfe0-162">`ValidateAntiForgeryToken` Öznitelik, siteler arası istek sahtekarlığı (CSRF) saldırılarını önlemeye yardımcı olur.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-162">The `ValidateAntiForgeryToken` attribute helps prevent cross-site request forgery (CSRF) attacks.</span></span> <span data-ttu-id="cdfe0-163">Belirteç otomatik olarak görünüm tarafından içine eklenen [FormTagHelper](xref:mvc/views/working-with-forms#the-form-tag-helper) ve kullanıcı tarafından form gönderildiğinde yer alır.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-163">The token is automatically injected into the view by the [FormTagHelper](xref:mvc/views/working-with-forms#the-form-tag-helper) and is included when the form is submitted by the user.</span></span> <span data-ttu-id="cdfe0-164">Belirteç tarafından doğrulandığından `ValidateAntiForgeryToken` özniteliği.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-164">The token is validated by the `ValidateAntiForgeryToken` attribute.</span></span> <span data-ttu-id="cdfe0-165">CSRF hakkında daha fazla bilgi için bkz: [karşı istek Sahteciliğine](../../security/anti-request-forgery.md).</span><span class="sxs-lookup"><span data-stu-id="cdfe0-165">For more information about CSRF, see [Anti-Request Forgery](../../security/anti-request-forgery.md).</span></span>

<a id="overpost"></a>
### <a name="security-note-about-overposting"></a><span data-ttu-id="cdfe0-166">Güvenlik Notu overposting hakkında</span><span class="sxs-lookup"><span data-stu-id="cdfe0-166">Security note about overposting</span></span>

<span data-ttu-id="cdfe0-167">`Bind` Kurulmuş kodu içerir özniteliği `Create` yöntemdir overposting karşı korumak için bir yol senaryoları oluşturun.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-167">The `Bind` attribute that the scaffolded code includes on the `Create` method is one way to protect against overposting in create scenarios.</span></span> <span data-ttu-id="cdfe0-168">Örneğin, Öğrenci varlık içerdiğini varsayın bir `Secret` ayarlamak için bu web sayfası istemediğiniz özelliği.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-168">For example, suppose the Student entity includes a `Secret` property that you don't want this web page to set.</span></span>

```csharp
public class Student
{
    public int ID { get; set; }
    public string LastName { get; set; }
    public string FirstMidName { get; set; }
    public DateTime EnrollmentDate { get; set; }
    public string Secret { get; set; }
}
```

<span data-ttu-id="cdfe0-169">Yüklü olmasa bile, bir `Secret` alan web sayfasında, bir bilgisayar korsanının Fiddler gibi bir araç kullanın veya göndermek için bazı JavaScript Yazma bir `Secret` form değeri.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-169">Even if you don't have a `Secret` field on the web page, a hacker could use a tool such as Fiddler, or write some JavaScript, to post a `Secret` form value.</span></span> <span data-ttu-id="cdfe0-170">Olmadan `Bind` Öğrenci örneği, model bağlayıcı oluşturduğunda, model Bağlayıcısı kullandığını alanları sınırlama özniteliği ayarladıysanız çekme `Secret` form değeri ve Öğrenci varlık örneği oluşturmak için kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-170">Without the `Bind` attribute limiting the fields that the model binder uses when it creates a Student instance, the model binder would pick up that `Secret` form value and use it to create the Student entity instance.</span></span> <span data-ttu-id="cdfe0-171">Sonra ne olursa olsun değer için belirtilen korsan `Secret` form alanı veritabanınızda güncelleştirilmesi.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-171">Then whatever value the hacker specified for the `Secret` form field would be updated in your database.</span></span> <span data-ttu-id="cdfe0-172">Fiddler aracı ekleme aşağıdaki görüntüde gösterir `Secret` gönderilen form değerlerine alanı ("OverPost" değeriyle).</span><span class="sxs-lookup"><span data-stu-id="cdfe0-172">The following image shows the Fiddler tool adding the `Secret` field (with the value "OverPost") to the posted form values.</span></span>

![Fiddler ekleme gizli alan](crud/_static/fiddler.png)

<span data-ttu-id="cdfe0-174">"OverPost" sonra başarıyla eklenmesi için değer `Secret` özelliği eklenen web sayfası bu özelliği ayarlayamaz hiçbir zaman amaçlı rağmen satır.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-174">The value "OverPost" would then be successfully added to the `Secret` property of the inserted row, although you never intended that the web page be able to set that property.</span></span>

<span data-ttu-id="cdfe0-175">Varlık veritabanından ilk okuma ve ardından çağırma overposting düzenleme senaryolarda engelleyebilirsiniz `TryUpdateModel`, açıkça izin verilen özellikler listesinde geçen.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-175">You can prevent overposting in edit scenarios by reading the entity from the database first and then calling `TryUpdateModel`, passing in an explicit allowed properties list.</span></span> <span data-ttu-id="cdfe0-176">Bu öğreticiler kullanılan yöntem olmasıdır.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-176">That's the method used in these tutorials.</span></span>

<span data-ttu-id="cdfe0-177">Birçok geliştiriciler tarafından tercih edilen overposting önlemek için alternatif bir yol sınıflar yerine modelleri görüntüle model bağlamayla kullanmaktır.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-177">An alternative way to prevent overposting that's preferred by many developers is to use view models rather than entity classes with model binding.</span></span> <span data-ttu-id="cdfe0-178">Yalnızca görünüm modeli güncelleştirmek istediğiniz özellikleri içerir.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-178">Include only the properties you want to update in the view model.</span></span> <span data-ttu-id="cdfe0-179">MVC model bağlayıcı tamamladığında, görünüm model özellikleri isteğe bağlı olarak AutoMapper gibi bir araç kullanarak varlık örneği kopyalayın.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-179">Once the MVC model binder has finished, copy the view model properties to the entity instance, optionally using a tool such as AutoMapper.</span></span> <span data-ttu-id="cdfe0-180">Kullanım `_context.Entry` durumunu ayarlamak için varlık örneğinde `Unchanged`ve ardından `Property("PropertyName").IsModified` görünüm modele dahil her varlık özellikte true.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-180">Use `_context.Entry` on the entity instance to set its state to `Unchanged`, and then set `Property("PropertyName").IsModified` to true on each entity property that's included in the view model.</span></span> <span data-ttu-id="cdfe0-181">Bu yöntem works hem de düzenleyebilir ve senaryoları oluşturabilir.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-181">This method works in both edit and create scenarios.</span></span>

### <a name="test-the-create-page"></a><span data-ttu-id="cdfe0-182">Test oluşturma sayfası</span><span class="sxs-lookup"><span data-stu-id="cdfe0-182">Test the Create page</span></span>

<span data-ttu-id="cdfe0-183">Kodda *Views/Students/Create.cshtml* kullanan `label`, `input`, ve `span` (için doğrulama ileti) etiket Yardımcıları her bir alan için.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-183">The code in *Views/Students/Create.cshtml* uses `label`, `input`, and `span` (for validation messages) tag helpers for each field.</span></span>

<span data-ttu-id="cdfe0-184">Uygulama, belirleyin **Öğrenciler** sekmesine ve tıklayın **Yeni Oluştur**.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-184">Run the app, select the **Students** tab, and click **Create New**.</span></span>

<span data-ttu-id="cdfe0-185">Adları ve bir tarih girin.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-185">Enter names and a date.</span></span> <span data-ttu-id="cdfe0-186">Tarayıcınız, yapmanıza olanak sağlayan, geçersiz bir tarih girmeyi deneyin.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-186">Try entering an invalid date if your browser lets you do that.</span></span> <span data-ttu-id="cdfe0-187">(Bazı tarayıcılar tarih seçiciyi kullanın zorlayabilir.) Ardından **oluşturma** hata iletisini görmek için.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-187">(Some browsers force you to use a date picker.) Then click **Create** to see the error message.</span></span>

![Tarih doğrulama hatası](crud/_static/date-error.png)

<span data-ttu-id="cdfe0-189">Varsayılan olarak aldığınız sunucu tarafında doğrulama budur; sonraki öğreticide istemci tarafı doğrulama kodunu da oluşturur özniteliklerini ekleme görürsünüz.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-189">This is server-side validation that you get by default; in a later tutorial you'll see how to add attributes that will generate code for client-side validation also.</span></span> <span data-ttu-id="cdfe0-190">Model doğrulama denetimi ile aşağıdaki vurgulanmış kodu gösterir `Create` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-190">The following highlighted code shows the model validation check in the `Create` method.</span></span>

[!code-csharp[](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_Create&highlight=8)]

<span data-ttu-id="cdfe0-191">Tarih geçerli bir değere değiştirip'ı **oluşturma** görünür yeni Öğrenci görmek için **dizin** sayfası.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-191">Change the date to a valid value and click **Create** to see the new student appear in the **Index** page.</span></span>

## <a name="update-the-edit-page"></a><span data-ttu-id="cdfe0-192">Güncelleştirmeyi Düzenle sayfası</span><span class="sxs-lookup"><span data-stu-id="cdfe0-192">Update the Edit page</span></span>

<span data-ttu-id="cdfe0-193">İçinde *StudentController.cs*, HttpGet `Edit` yöntemi (olmadan bir `HttpPost` özniteliği) kullanan `SingleOrDefaultAsync` de anlatıldığı gibi seçilen Öğrenci varlık alma yöntemi `Details` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-193">In *StudentController.cs*, the HttpGet `Edit` method (the one without the `HttpPost` attribute) uses the `SingleOrDefaultAsync` method to retrieve the selected Student entity, as you saw in the `Details` method.</span></span> <span data-ttu-id="cdfe0-194">Bu yöntem değiştirmeniz gerekmez.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-194">You don't need to change this method.</span></span>

### <a name="recommended-httppost-edit-code-read-and-update"></a><span data-ttu-id="cdfe0-195">HttpPost düzenleme kod önerilir: Okuma ve güncelleştirme</span><span class="sxs-lookup"><span data-stu-id="cdfe0-195">Recommended HttpPost Edit code: Read and update</span></span>

<span data-ttu-id="cdfe0-196">HttpPost düzenleme eylem yöntemini aşağıdaki kodla değiştirin.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-196">Replace the HttpPost Edit action method with the following code.</span></span>

[!code-csharp[](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_ReadFirst)]

<span data-ttu-id="cdfe0-197">Bu değişiklikler overposting önlemek için bir en iyi güvenlik uygulaması uygulayın.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-197">These changes implement a security best practice to prevent overposting.</span></span> <span data-ttu-id="cdfe0-198">Oluşturulan iskele kurucu bir `Bind` özniteliği ve varlık ile kümesi için model bağlayıcı tarafından oluşturulan varlık eklenen bir `Modified` bayrağı.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-198">The scaffolder generated a `Bind` attribute and added the entity created by the model binder to the entity set with a `Modified` flag.</span></span> <span data-ttu-id="cdfe0-199">Kod için birçok senaryoları için önerilmez `Bind` özniteliği temizler listelenmez alanları önceden mevcut verileri dışarı `Include` parametresi.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-199">That code isn't recommended for many scenarios because the `Bind` attribute clears out any pre-existing data in fields not listed in the `Include` parameter.</span></span>

<span data-ttu-id="cdfe0-200">Varolan bir varlık ve çağrıları yeni kod okur `TryUpdateModel` alınan varlık alanlarını güncelleştirmek için [gönderilen form verilerini uygulamasında kullanıcı girdisi göre](xref:mvc/models/model-binding#how-model-binding-works).</span><span class="sxs-lookup"><span data-stu-id="cdfe0-200">The new code reads the existing entity and calls `TryUpdateModel` to update fields in the retrieved entity [based on user input in the posted form data](xref:mvc/models/model-binding#how-model-binding-works).</span></span> <span data-ttu-id="cdfe0-201">Entity Framework'ün otomatik değişiklik kümelerini izleme `Modified` form girişi tarafından değiştirilen alanları bayrağı.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-201">The Entity Framework's automatic change tracking sets the `Modified` flag on the fields that are changed by form input.</span></span> <span data-ttu-id="cdfe0-202">Zaman `SaveChanges` yöntemi çağrıldığında, Entity Framework veritabanı satırı güncelleştirmek için SQL deyimleri oluşturur.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-202">When the `SaveChanges` method is called, the Entity Framework creates SQL statements to update the database row.</span></span> <span data-ttu-id="cdfe0-203">Eşzamanlılık çakışması göz ardı edilir ve yalnızca kullanıcı tarafından güncelleştirildi tablo sütunları veritabanında güncelleştirilir.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-203">Concurrency conflicts are ignored, and only the table columns that were updated by the user are updated in the database.</span></span> <span data-ttu-id="cdfe0-204">(Bir sonraki öğretici eşzamanlılık çakışmaları nasıl ele alınacağını gösterir.)</span><span class="sxs-lookup"><span data-stu-id="cdfe0-204">(A later tutorial shows how to handle concurrency conflicts.)</span></span>

<span data-ttu-id="cdfe0-205">Overposting, tarafından güncelleştirilebilmesi için istediğiniz alanları önlemek için en iyi uygulama olarak **Düzenle** sayfa içinde Güvenilenler listesine olan `TryUpdateModel` parametreleri.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-205">As a best practice to prevent overposting, the fields that you want to be updateable by the **Edit** page are whitelisted in the `TryUpdateModel` parameters.</span></span> <span data-ttu-id="cdfe0-206">(Parametre listesinde bir alanlar listesi önceki boş dize form alan adları ile kullanmak bir önek içindir.) Şu anda koruduğunuz hiçbir ek alanlar vardır, ancak veri modeline gelecekte alanlar eklerseniz, açıkça bunları burada yüklemediğiniz sürece otomatik olarak korumalı olup olmadıklarını olduğunu bağlamak için model bağlayıcı istediğiniz alanları listesi sağlar.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-206">(The empty string preceding the list of fields in the parameter list is for a prefix to use with the form fields names.) Currently there are no extra fields that you're protecting, but listing the fields that you want the model binder to bind ensures that if you add fields to the data model in the future, they're automatically protected until you explicitly add them here.</span></span>

<span data-ttu-id="cdfe0-207">Bu değişiklikler, HttpPost yöntemi imzası sonucunda `Edit` yöntemi aynıdır HttpGet `Edit` yöntemi; bu nedenle yöntemi değiştirdiniz `EditPost`.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-207">As a result of these changes, the method signature of the HttpPost `Edit` method is the same as the HttpGet `Edit` method; therefore you've renamed the method `EditPost`.</span></span>

### <a name="alternative-httppost-edit-code-create-and-attach"></a><span data-ttu-id="cdfe0-208">Alternatif HttpPost düzenleme kod: oluşturun ve ekleme</span><span class="sxs-lookup"><span data-stu-id="cdfe0-208">Alternative HttpPost Edit code: Create and attach</span></span>

<span data-ttu-id="cdfe0-209">Önerilen HttpPost düzenleme kod yalnızca değiştirilen sütun güncelleştirilmesi ve model bağlama için dahil istemediğiniz özellikleri verilerini korur sağlar.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-209">The recommended HttpPost edit code ensures that only changed columns get updated and preserves data in properties that you don't want included for model binding.</span></span> <span data-ttu-id="cdfe0-210">Ancak, ek veritabanı okuma ve eşzamanlılık çakışmalarını işleme için daha karmaşık kod sonuçlanabilir okuma ilk yaklaşım gerektirir.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-210">However, the read-first approach requires an extra database read, and can result in more complex code for handling concurrency conflicts.</span></span> <span data-ttu-id="cdfe0-211">EF bağlamı için model bağlayıcı tarafından oluşturulan bir varlık eklemek ve değiştirilmiş olarak işaretlemek için kullanılan bir alternatiftir.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-211">An alternative is to attach an entity created by the model binder to the EF context and mark it as modified.</span></span> <span data-ttu-id="cdfe0-212">(Projenizin güncelleştirmemeniz şu kodla yalnızca isteğe bağlı bir yaklaşım göstermek için gösterilen.)</span><span class="sxs-lookup"><span data-stu-id="cdfe0-212">(Don't update your project with this code, it's only shown to illustrate an optional approach.)</span></span>

[!code-csharp[](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_CreateAndAttach)]

<span data-ttu-id="cdfe0-213">Web sayfası kullanıcı Arabirimi tüm alanlar varlıkta içerir ve bunlardan herhangi birinin güncelleştirebilirsiniz, bu yaklaşım kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-213">You can use this approach when the web page UI includes all of the fields in the entity and can update any of them.</span></span>

<span data-ttu-id="cdfe0-214">İskele kurulmuş kod oluşturma-ve-ekleme yaklaşımı kullanır, ancak yalnızca yakalar `DbUpdateConcurrencyException` 404 hata kodları özel durumlar ve döndürür.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-214">The scaffolded code uses the create-and-attach approach but only catches `DbUpdateConcurrencyException` exceptions and returns 404 error codes.</span></span>  <span data-ttu-id="cdfe0-215">Gösterilen örnek veritabanı güncelleştirme özel durumları yakalar ve bir hata iletisi görüntüler.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-215">The example shown catches any database update exception and displays an error message.</span></span>

### <a name="entity-states"></a><span data-ttu-id="cdfe0-216">Varlık durumları</span><span class="sxs-lookup"><span data-stu-id="cdfe0-216">Entity States</span></span>

<span data-ttu-id="cdfe0-217">Veritabanı bağlamı varlıkları bellekte kendi veritabanında karşılık gelen satır ile eşitleme ve bu bilgileri çağırdığınızda ne olacağını belirler olup olmadığını izler `SaveChanges` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-217">The database context keeps track of whether entities in memory are in sync with their corresponding rows in the database, and this information determines what happens when you call the `SaveChanges` method.</span></span> <span data-ttu-id="cdfe0-218">Örneğin, geçirdiğiniz zaman yeni bir varlık `Add` varlığın durumu kümesine yöntemi, `Added`.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-218">For example, when you pass a new entity to the `Add` method, that entity's state is set to `Added`.</span></span> <span data-ttu-id="cdfe0-219">Çağırdığınızda sonra `SaveChanges` yöntemi, veritabanı bağlamı sorunları SQL INSERT komutu.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-219">Then when you call the `SaveChanges` method, the database context issues a SQL INSERT command.</span></span>

<span data-ttu-id="cdfe0-220">Bir varlık şu durumlardan birinde olabilir:</span><span class="sxs-lookup"><span data-stu-id="cdfe0-220">An entity may be in one of the following states:</span></span>

* <span data-ttu-id="cdfe0-221">`Added`.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-221">`Added`.</span></span> <span data-ttu-id="cdfe0-222">Varlık henüz veritabanında yok.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-222">The entity doesn't yet exist in the database.</span></span> <span data-ttu-id="cdfe0-223">`SaveChanges` Yöntemi INSERT deyimi verir.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-223">The `SaveChanges` method issues an INSERT statement.</span></span>

* <span data-ttu-id="cdfe0-224">`Unchanged`.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-224">`Unchanged`.</span></span> <span data-ttu-id="cdfe0-225">Hiçbir şey bu varlık tarafından ile yapılması gerektiğini `SaveChanges` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-225">Nothing needs to be done with this entity by the `SaveChanges` method.</span></span> <span data-ttu-id="cdfe0-226">Veritabanından bir varlık okurken varlık bu durumu ile başlar.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-226">When you read an entity from the database, the entity starts out with this status.</span></span>

* <span data-ttu-id="cdfe0-227">`Modified`.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-227">`Modified`.</span></span> <span data-ttu-id="cdfe0-228">Bazılarını veya tümünü varlığın özellik değerlerini değiştirilmiş.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-228">Some or all of the entity's property values have been modified.</span></span> <span data-ttu-id="cdfe0-229">`SaveChanges` Yöntemi bir güncelleştirme deyimi sorunları.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-229">The `SaveChanges` method issues an UPDATE statement.</span></span>

* <span data-ttu-id="cdfe0-230">`Deleted`.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-230">`Deleted`.</span></span> <span data-ttu-id="cdfe0-231">Varlık silinmek üzere işaretlendi.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-231">The entity has been marked for deletion.</span></span> <span data-ttu-id="cdfe0-232">`SaveChanges` Yöntemi DELETE deyimi verir.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-232">The `SaveChanges` method issues a DELETE statement.</span></span>

* <span data-ttu-id="cdfe0-233">`Detached`.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-233">`Detached`.</span></span> <span data-ttu-id="cdfe0-234">Varlık veritabanı bağlamı tarafından izleniyor değil.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-234">The entity isn't being tracked by the database context.</span></span>

<span data-ttu-id="cdfe0-235">Bir masaüstü uygulaması durum değişiklikleri genellikle otomatik olarak ayarlanır.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-235">In a desktop application, state changes are typically set automatically.</span></span> <span data-ttu-id="cdfe0-236">Bir varlık okuma ve bazı özellik değerleri değişiklikleri yapın.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-236">You read an entity and make changes to some of its property values.</span></span> <span data-ttu-id="cdfe0-237">Bu şekilde otomatik olarak değiştirilmesi varlık durumuna neden `Modified`.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-237">This causes its entity state to automatically be changed to `Modified`.</span></span> <span data-ttu-id="cdfe0-238">Çağırdığınızda sonra `SaveChanges`, Entity Framework yalnızca değiştirdiğiniz gerçek özelliklerini güncelleştirir SQL UPDATE deyimi oluşturur.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-238">Then when you call `SaveChanges`, the Entity Framework generates a SQL UPDATE statement that updates only the actual properties that you changed.</span></span>

<span data-ttu-id="cdfe0-239">Bir web uygulamasında `DbContext` başlangıçta okuyan bir varlık ve düzenlenmesi için verileri bir sayfa oluşturulduğunda atıldı görüntüler.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-239">In a web app, the `DbContext` that initially reads an entity and displays its data to be edited is disposed after a page is rendered.</span></span> <span data-ttu-id="cdfe0-240">Zaman HttpPost `Edit` eylem yöntemi çağrıldığında, yeni bir web istek yapıldığında ve yeni bir örneğini sahip `DbContext`.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-240">When the HttpPost `Edit` action method is called,  a new web request is made and you have a new instance of the `DbContext`.</span></span> <span data-ttu-id="cdfe0-241">Bu yeni bağlam varlıkta yeniden okuyun, Masaüstü işleme benzetimi.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-241">If you re-read the entity in that new context, you simulate desktop processing.</span></span>

<span data-ttu-id="cdfe0-242">Ancak yapmak istemiyorsanız, ek okuma işlemi, model bağlayıcı tarafından oluşturulan varlığı nesne kullanmak zorunda.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-242">But if you don't want to do the extra read operation, you have to use the entity object created by the model binder.</span></span>  <span data-ttu-id="cdfe0-243">Bunu yapmanın en kolay yolu varlık durumu değiştirme için daha önce gösterilen alternatif HttpPost düzenleme kodda yapıldığı şekilde ayarlamaktır.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-243">The simplest way to do this is to set the entity state to Modified as is done in the alternative HttpPost Edit code shown earlier.</span></span> <span data-ttu-id="cdfe0-244">Çağırdığınızda sonra `SaveChanges`, bağlam değiştirdiğiniz hangi özelliklerin kaybedeceğinizi öğrenmenin bir yolu bulunduğundan Entity Framework veritabanı satırın tüm sütunları güncelleştirir.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-244">Then when you call `SaveChanges`, the Entity Framework updates all columns of the database row, because the context has no way to know which properties you changed.</span></span>

<span data-ttu-id="cdfe0-245">Okuma ilk yaklaşım önlemek istiyorsanız, ancak aynı zamanda kullanıcının gerçekten değiştirilen alanları güncelleştirmek için SQL UPDATE deyimini istediğiniz, daha karmaşık bir kodudur.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-245">If you want to avoid the read-first approach, but you also want the SQL UPDATE statement to update only the fields that the user actually changed, the code is more complex.</span></span> <span data-ttu-id="cdfe0-246">Herhangi bir yolla özgün değerler kaydetmek zorunda (gibi gizli alanları kullanarak) bunların ne zaman kullanılabilir olduğunu HttpPost `Edit` yöntemi çağrılır.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-246">You have to save the original values in some way (such as by using hidden fields) so that they're available when the HttpPost `Edit` method is called.</span></span> <span data-ttu-id="cdfe0-247">Çağrı orijinal değerleri kullanarak bir öğrenci varlık oluşturup `Attach` varlık özgün sürümünün yöntemiyle varlığın değerleri için yeni değerleri güncelleştirmek ve ardından çağırın `SaveChanges`.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-247">Then you can create a Student entity using the original values, call the `Attach` method with that original version of the entity, update the entity's values to the new values, and then call `SaveChanges`.</span></span>

### <a name="test-the-edit-page"></a><span data-ttu-id="cdfe0-248">Sınama Düzenle sayfası</span><span class="sxs-lookup"><span data-stu-id="cdfe0-248">Test the Edit page</span></span>

<span data-ttu-id="cdfe0-249">Uygulama, belirleyin **Öğrenciler** sekmesini ve ardından bir **Düzenle** köprü.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-249">Run the app, select the **Students** tab, then click an **Edit** hyperlink.</span></span>

![Öğrenciler Düzenle sayfası](crud/_static/student-edit.png)

<span data-ttu-id="cdfe0-251">Bazı tıklatın ve verileri değiştirme **kaydetmek**.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-251">Change some of the data and click **Save**.</span></span> <span data-ttu-id="cdfe0-252">**Dizin** sayfası açılır ve değiştirilen verileri bakın.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-252">The **Index** page opens and you see the changed data.</span></span>

## <a name="update-the-delete-page"></a><span data-ttu-id="cdfe0-253">Güncelleştirme Sil sayfası</span><span class="sxs-lookup"><span data-stu-id="cdfe0-253">Update the Delete page</span></span>

<span data-ttu-id="cdfe0-254">İçinde *StudentController.cs*, HttpGet için şablonu kodu `Delete` yöntemi kullanan `SingleOrDefaultAsync` yöntemleri Ayrıntılar ve düzenleme anlatıldığı gibi seçilen Öğrenci varlık alma yöntemi.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-254">In *StudentController.cs*, the template code for the HttpGet `Delete` method uses the `SingleOrDefaultAsync` method to retrieve the selected Student entity, as you saw in the Details and Edit methods.</span></span> <span data-ttu-id="cdfe0-255">Ancak, uygulamak için bir özel hata iletisi ne zaman çağrısı `SaveChanges` başarısız olursa, karşılık gelen görebilir ve bu yöntem işlevselliğinin ekleyeceksiniz.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-255">However, to implement a custom error message when the call to `SaveChanges` fails, you'll add some functionality to this method and its corresponding view.</span></span>

<span data-ttu-id="cdfe0-256">Güncelleştirmesi gördünüz ve işlemler oluşturmak gibi silme işlemleri iki eylem yöntemleri gerektirir.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-256">As you saw for update and create operations, delete operations require two action methods.</span></span> <span data-ttu-id="cdfe0-257">Bir GET isteğine yanıt olarak adlandırılan yöntemi onaylamak veya silme işlemini iptal etmek için bir fırsat kullanıcıya veren bir görünüm görüntüler.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-257">The method that's called in response to a GET request displays a view that gives the user a chance to approve or cancel the delete operation.</span></span> <span data-ttu-id="cdfe0-258">Kullanıcı onaylarsa, bir POST isteği oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-258">If the user approves it, a POST request is created.</span></span> <span data-ttu-id="cdfe0-259">Bu durumda, HttpPost `Delete` yöntemi çağrılır ve bu yöntem gerçekte silme işlemi gerçekleştirir.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-259">When that happens, the HttpPost `Delete` method is called and then that method actually performs the delete operation.</span></span>

<span data-ttu-id="cdfe0-260">Try-catch bloğu HttpPost ekleyeceksiniz `Delete` veritabanı güncelleştirildiğinde oluşabilecek tüm hataları işlemek için yöntem.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-260">You'll add a try-catch block to the HttpPost `Delete` method to handle any errors that might occur when the database is updated.</span></span> <span data-ttu-id="cdfe0-261">Bir hata oluşursa, bir hata oluştuğunu gösteren bir parametre geçirme HttpGet Delete yöntemini HttpPost Delete yöntemini çağırır.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-261">If an error occurs, the HttpPost Delete method calls the HttpGet Delete method, passing it a parameter that indicates that an error has occurred.</span></span> <span data-ttu-id="cdfe0-262">HttpGet Delete yöntemini ardından onay sayfasında kullanıcı iptal etme veya yeniden denemek için bir fırsat vermiş hata iletisi ile birlikte görüntüler.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-262">The HttpGet Delete method then redisplays the confirmation page along with the error message, giving the user an opportunity to cancel or try again.</span></span>

<span data-ttu-id="cdfe0-263">HttpGet Değiştir `Delete` hata raporlama yönetir aşağıdaki kodla eylem yöntemi.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-263">Replace the HttpGet `Delete` action method with the following code, which manages error reporting.</span></span>

[!code-csharp[](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_DeleteGet&highlight=1,9,16-21)]

<span data-ttu-id="cdfe0-264">Bu kod değişiklikleri kaydetmek için bir hatadan sonra yöntemi çağrıldı olup olmadığını belirten isteğe bağlı bir parametre kabul eder.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-264">This code accepts an optional parameter that indicates whether the method was called after a failure to save changes.</span></span> <span data-ttu-id="cdfe0-265">Bu parametre yanlış HttpGet `Delete` yöntemi, önceki bir hata çağrılır.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-265">This parameter is false when the HttpGet `Delete` method is called without a previous failure.</span></span> <span data-ttu-id="cdfe0-266">Ne zaman çağırıldığında tarafından HttpPost `Delete` yöntemi yanıt olarak bir veritabanı güncelleştirme hatası parametresi true olduğunda ve bir hata iletisi görünüme iletilir.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-266">When it's called by the HttpPost `Delete` method in response to a database update error, the parameter is true and an error message is passed to the view.</span></span>

### <a name="the-read-first-approach-to-httppost-delete"></a><span data-ttu-id="cdfe0-267">Okuma ilk yaklaşım HttpPost silme</span><span class="sxs-lookup"><span data-stu-id="cdfe0-267">The read-first approach to HttpPost Delete</span></span>

<span data-ttu-id="cdfe0-268">HttpPost Değiştir `Delete` eylem yöntemi (adlı `DeleteConfirmed`) gerçek silme işlemi gerçekleştirir ve veritabanını güncelleştirme hataları yakalar aşağıdaki kodu.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-268">Replace the HttpPost `Delete` action method (named `DeleteConfirmed`) with the following code, which performs the actual delete operation and catches any database update errors.</span></span>

[!code-csharp[](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_DeleteWithReadFirst&highlight=6,8-11,13-14,18-23)]

<span data-ttu-id="cdfe0-269">Seçilen varlığın bu kodu alır sonra çağırır `Remove` varlığın durumu ayarlamak için yöntemi `Deleted`.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-269">This code retrieves the selected entity, then calls the `Remove` method to set the entity's status to `Deleted`.</span></span> <span data-ttu-id="cdfe0-270">Zaman `SaveChanges` çağrılır SQL DELETE komutu oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-270">When `SaveChanges` is called, a SQL DELETE command is generated.</span></span>

### <a name="the-create-and-attach-approach-to-httppost-delete"></a><span data-ttu-id="cdfe0-271">Create-ve-ekleme yaklaşım HttpPost silme</span><span class="sxs-lookup"><span data-stu-id="cdfe0-271">The create-and-attach approach to HttpPost Delete</span></span>

<span data-ttu-id="cdfe0-272">Yüksek hacimli uygulama performansını iyileştirme bir öncelik ise, yalnızca birincil kullanarak bir öğrenci varlık örneği tarafından gereksiz bir SQL sorgusu kaçının anahtar değeri ve varlık durumu ayarı `Deleted`.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-272">If improving performance in a high-volume application is a priority, you could avoid an unnecessary SQL query by instantiating a Student entity using only the primary key value and then setting the entity state to `Deleted`.</span></span> <span data-ttu-id="cdfe0-273">Entity Framework varlığı silmek için gereken tüm budur.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-273">That's all that the Entity Framework needs in order to delete the entity.</span></span> <span data-ttu-id="cdfe0-274">(Yalnızca bir alternatif göstermek için bu aşağıda verilmiştir; bu kodu projenizde koymayın.)</span><span class="sxs-lookup"><span data-stu-id="cdfe0-274">(Don't put this code in your project; it's here just to illustrate an alternative.)</span></span>

[!code-csharp[](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_DeleteWithoutReadFirst&highlight=7-8)]

<span data-ttu-id="cdfe0-275">Varlık ilgili de silinip silinmeyeceği verileri, o art arda silme veritabanında yapılandırıldığından emin olun.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-275">If the entity has related data that should also be deleted, make sure that cascade delete is configured in the database.</span></span> <span data-ttu-id="cdfe0-276">Varlık silme işlemi için Bu yaklaşımda, silinecek ilgili varlık vardır EF farkına varmazsınız.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-276">With this approach to entity deletion, EF might not realize there are related entities to be deleted.</span></span>

### <a name="update-the-delete-view"></a><span data-ttu-id="cdfe0-277">Delete görünümünü güncelleştirme</span><span class="sxs-lookup"><span data-stu-id="cdfe0-277">Update the Delete view</span></span>

<span data-ttu-id="cdfe0-278">İçinde *Views/Student/Delete.cshtml*, hata iletisi h2 başlığı ve h3 başlık arasında aşağıdaki örnekte gösterildiği gibi ekleyin:</span><span class="sxs-lookup"><span data-stu-id="cdfe0-278">In *Views/Student/Delete.cshtml*, add an error message between the h2 heading and the h3 heading, as shown in the following example:</span></span>

[!code-html[](intro/samples/cu/Views/Students/Delete.cshtml?range=7-9&highlight=2)]

<span data-ttu-id="cdfe0-279">Uygulama, belirleyin **Öğrenciler** sekmesine ve tıklayın bir **silmek** köprü:</span><span class="sxs-lookup"><span data-stu-id="cdfe0-279">Run the app, select the **Students** tab, and click a **Delete** hyperlink:</span></span>

![Onay sayfasında Sil](crud/_static/student-delete.png)

<span data-ttu-id="cdfe0-281">Tıklatın **silmek**.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-281">Click **Delete**.</span></span> <span data-ttu-id="cdfe0-282">Dizin Sayfası silinen Öğrenci görüntülenir.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-282">The Index page is displayed without the deleted student.</span></span> <span data-ttu-id="cdfe0-283">(Hata işleyen kodu eşzamanlılık öğreticideki uygulamada bir örneğini göreceksiniz.)</span><span class="sxs-lookup"><span data-stu-id="cdfe0-283">(You'll see an example of the error handling code in action in the concurrency tutorial.)</span></span>

## <a name="closing-database-connections"></a><span data-ttu-id="cdfe0-284">Veritabanı bağlantıları kapatma</span><span class="sxs-lookup"><span data-stu-id="cdfe0-284">Closing database connections</span></span>

<span data-ttu-id="cdfe0-285">İşiniz bittiğinde ile bir veritabanı bağlantısı tutan kaynakları boşaltmak için bağlam örneğinin mümkün olan en kısa sürede çıkarılması gerekir.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-285">To free up the resources that a database connection holds, the context instance must be disposed as soon as possible when you are done with it.</span></span> <span data-ttu-id="cdfe0-286">ASP.NET Core yerleşik [bağımlılık ekleme](../../fundamentals/dependency-injection.md) alır bu görev sizin için gerçekleştirir.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-286">The ASP.NET Core built-in [dependency injection](../../fundamentals/dependency-injection.md) takes care of that task for you.</span></span>

<span data-ttu-id="cdfe0-287">İçinde *haline*, çağırmanız [AddDbContext genişletme yöntemi](https://github.com/aspnet/EntityFrameworkCore/blob/03bcb5122e3f577a84498545fcf130ba79a3d987/src/Microsoft.EntityFrameworkCore/EntityFrameworkServiceCollectionExtensions.cs) sağlamak için `DbContext` ASP.NET dı kapsayıcısında sınıfı.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-287">In *Startup.cs*, you call the [AddDbContext extension method](https://github.com/aspnet/EntityFrameworkCore/blob/03bcb5122e3f577a84498545fcf130ba79a3d987/src/Microsoft.EntityFrameworkCore/EntityFrameworkServiceCollectionExtensions.cs) to provision the `DbContext` class in the ASP.NET DI container.</span></span> <span data-ttu-id="cdfe0-288">Yöntem hizmet ömrü ayarlar `Scoped` varsayılan olarak.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-288">That method sets the service lifetime to `Scoped` by default.</span></span> <span data-ttu-id="cdfe0-289">`Scoped` bağlam nesne ömrü örtüşür web isteği yaşam süresiyle anlamına gelir ve `Dispose` yöntemi çağrılır otomatik olarak web isteği sonunda.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-289">`Scoped` means the context object lifetime coincides with the web request life time, and the `Dispose` method will be called automatically at the end of the web request.</span></span>

## <a name="handling-transactions"></a><span data-ttu-id="cdfe0-290">İşleme işlemleri</span><span class="sxs-lookup"><span data-stu-id="cdfe0-290">Handling Transactions</span></span>

<span data-ttu-id="cdfe0-291">Varsayılan olarak Entity Framework örtük olarak işlemleri gerçekleştirir.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-291">By default the Entity Framework implicitly implements transactions.</span></span> <span data-ttu-id="cdfe0-292">Burada birden çok satır veya tablo için değişiklik ve ardından çağıran senaryolarda `SaveChanges`, Entity Framework otomatik olarak tüm değişikliklerinizi başarılı veya başarısız hepsi emin olur.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-292">In scenarios where you make changes to multiple rows or tables and then call `SaveChanges`, the Entity Framework automatically makes sure that either all of your changes succeed or they all fail.</span></span> <span data-ttu-id="cdfe0-293">Bazı değişiklikler ilk yapılır ve bir hata olur, bu değişiklikleri otomatik olarak geri alınır.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-293">If some changes are done first and then an error happens, those changes are automatically rolled back.</span></span> <span data-ttu-id="cdfe0-294">Burada, daha fazla denetim--Örneğin, bir işlem içinde--Entity Framework dışında yapılan işlemleri dahil etmek istiyorsanız senaryolar görmek için [işlemleri](https://docs.microsoft.com/ef/core/saving/transactions).</span><span class="sxs-lookup"><span data-stu-id="cdfe0-294">For scenarios where you need more control -- for example, if you want to include operations done outside of Entity Framework in a transaction -- see [Transactions](https://docs.microsoft.com/ef/core/saving/transactions).</span></span>

## <a name="no-tracking-queries"></a><span data-ttu-id="cdfe0-295">Hayır-izleme sorguları</span><span class="sxs-lookup"><span data-stu-id="cdfe0-295">No-tracking queries</span></span>

<span data-ttu-id="cdfe0-296">Veritabanı bağlamı tablo satırları alır ve bunları temsil eden varlık nesnesi oluşturur, varsayılan olarak veritabanında nedir ile varlıkları bellekte eşit olup olmadığını izler.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-296">When a database context retrieves table rows and creates entity objects that represent them, by default it keeps track of whether the entities in memory are in sync with what's in the database.</span></span> <span data-ttu-id="cdfe0-297">Bellekteki veri önbelleği olarak davranır ve bir varlık güncelleştirdiğinizde kullanılır.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-297">The data in memory acts as a cache and is used when you update an entity.</span></span> <span data-ttu-id="cdfe0-298">Bağlam olan genellikle kısa süreli (yeni bir tane oluşturulur ve atıldı her istek için) ve bağlam örnekleri için bu önbelleğe alma genellikle bir web uygulamasında gereksizdir okuyan bir varlığın varlık yeniden kullanılmadan önce genellikle atıldı.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-298">This caching is often unnecessary in a web application because context instances are typically short-lived (a new one is created and disposed for each request) and the context that reads an entity is typically disposed before that entity is used again.</span></span>

<span data-ttu-id="cdfe0-299">Çağırarak varlık nesnesi bellekte izleme devre dışı bırakabilirsiniz `AsNoTracking` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-299">You can disable tracking of entity objects in memory by calling the `AsNoTracking` method.</span></span> <span data-ttu-id="cdfe0-300">Bunu yapmak isteyebilirsiniz tipik senaryolar aşağıdakileri içerir:</span><span class="sxs-lookup"><span data-stu-id="cdfe0-300">Typical scenarios in which you might want to do that include the following:</span></span>

* <span data-ttu-id="cdfe0-301">Bağlam ömrü boyunca herhangi bir varlık güncelleştirmeniz gerekmez ve EF için gerekmeyen [otomatik olarak ayrı sorgular tarafından alınan varlıklarla Gezinti özellikleri yük](read-related-data.md).</span><span class="sxs-lookup"><span data-stu-id="cdfe0-301">During the context lifetime you don't need to update any entities, and you don't need EF to [automatically load navigation properties with  entities retrieved by separate queries](read-related-data.md).</span></span> <span data-ttu-id="cdfe0-302">Bu koşullar bir denetleyicinin HttpGet eylem yöntemlerinde sık karşılıyor.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-302">Frequently these conditions are met in a controller's HttpGet action methods.</span></span>

* <span data-ttu-id="cdfe0-303">Büyük miktarda veri alan bir sorgu çalıştırıyorsanız ve yalnızca küçük bir bölümü, döndürülen verilerin güncelleştirilir.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-303">You are running a query that retrieves a large volume of data, and only a small portion of the returned data will be updated.</span></span> <span data-ttu-id="cdfe0-304">Büyük sorgu için izlemeyi devre dışı bırakın ve daha sonra güncelleştirilmesi gereken birkaç varlıklar için bir sorgu çalıştırmak için daha etkili olabilir.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-304">It may be more efficient to turn off tracking for the large query, and run a query later for the few entities that need to be updated.</span></span>

* <span data-ttu-id="cdfe0-305">Güncelleştirmek için bir varlık eklemek için kullanmak istediğiniz, ancak daha önce farklı bir amaç için aynı varlık alınır.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-305">You want to attach an entity in order to update it, but earlier you retrieved the same entity for a different purpose.</span></span> <span data-ttu-id="cdfe0-306">Varlık tarafından veritabanı bağlamı zaten izlenmekte olduğundan, değiştirmek istediğiniz varlık eklenemiyor.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-306">Because the entity is already being tracked by the database context, you can't attach the entity that you want to change.</span></span> <span data-ttu-id="cdfe0-307">Bu durumu yönetmek için bir yol çağırmaktır `AsNoTracking` önceki sorgusu.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-307">One way to handle this situation is to call `AsNoTracking` on the earlier query.</span></span>

<span data-ttu-id="cdfe0-308">Daha fazla bilgi için bkz: [vs izleme. Hayır-izleme](https://docs.microsoft.com/ef/core/querying/tracking).</span><span class="sxs-lookup"><span data-stu-id="cdfe0-308">For more information, see [Tracking vs. No-Tracking](https://docs.microsoft.com/ef/core/querying/tracking).</span></span>

## <a name="summary"></a><span data-ttu-id="cdfe0-309">Özet</span><span class="sxs-lookup"><span data-stu-id="cdfe0-309">Summary</span></span>

<span data-ttu-id="cdfe0-310">Artık Öğrenci varlıklar için basit CRUD işlemleri gerçekleştiren sayfaları eksiksiz bir kümesini var.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-310">You now have a complete set of pages that perform simple CRUD operations for Student entities.</span></span> <span data-ttu-id="cdfe0-311">İşlevlerini genişletmek sonraki öğreticide **dizin** sıralama, filtreleme ve disk belleği ekleyerek sayfası.</span><span class="sxs-lookup"><span data-stu-id="cdfe0-311">In the next tutorial you'll expand the functionality of the **Index** page by adding sorting, filtering, and paging.</span></span>

::: moniker-end

> [!div class="step-by-step"]
> <span data-ttu-id="cdfe0-312">[Önceki](intro.md)
> [sonraki](sort-filter-page.md)</span><span class="sxs-lookup"><span data-stu-id="cdfe0-312">[Previous](intro.md)
[Next](sort-filter-page.md)</span></span>
