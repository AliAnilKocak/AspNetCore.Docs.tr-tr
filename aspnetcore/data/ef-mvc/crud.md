---
title: 'Öğretici: CRUD İşlevselliği Uygulayın - EF Core ile mvc ASP.NET'
description: Bu eğitimde, MVC iskelesinin denetleyicilerde ve görünümlerde sizin için otomatik olarak oluşturduğu CRUD (oluşturma, oku, güncelleme, silme) kodunu gözden geçirip özelleştireceksiniz.
author: rick-anderson
ms.author: riande
ms.custom: mvc
ms.date: 02/04/2019
ms.topic: tutorial
uid: data/ef-mvc/crud
ms.openlocfilehash: 2aa4ef48509b9a34f3b25eb657b1ecac51c1374b
ms.sourcegitcommit: f7886fd2e219db9d7ce27b16c0dc5901e658d64e
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 04/06/2020
ms.locfileid: "79416214"
---
# <a name="tutorial-implement-crud-functionality---aspnet-mvc-with-ef-core"></a><span data-ttu-id="8107a-103">Öğretici: CRUD İşlevselliği Uygulayın - EF Core ile mvc ASP.NET</span><span class="sxs-lookup"><span data-stu-id="8107a-103">Tutorial: Implement CRUD Functionality - ASP.NET MVC with EF Core</span></span>

<span data-ttu-id="8107a-104">Önceki öğreticide, Entity Framework ve SQL Server LocalDB'yi kullanarak verileri depolayan ve görüntüleyen bir MVC uygulaması oluşturdunuz.</span><span class="sxs-lookup"><span data-stu-id="8107a-104">In the previous tutorial, you created an MVC application that stores and displays data using the Entity Framework and SQL Server LocalDB.</span></span> <span data-ttu-id="8107a-105">Bu eğitimde, MVC iskelesinin denetleyicilerde ve görünümlerde sizin için otomatik olarak oluşturduğu CRUD (oluşturma, oku, güncelleme, silme) kodunu gözden geçirip özelleştireceksiniz.</span><span class="sxs-lookup"><span data-stu-id="8107a-105">In this tutorial, you'll review and customize the CRUD (create, read, update, delete) code that the MVC scaffolding automatically creates for you in controllers and views.</span></span>

> [!NOTE]
> <span data-ttu-id="8107a-106">Denetleyiciniz ve veri erişim katmanı arasında bir soyutlama katmanı oluşturmak için depo deseni uygulamak yaygın bir uygulamadır.</span><span class="sxs-lookup"><span data-stu-id="8107a-106">It's a common practice to implement the repository pattern in order to create an abstraction layer between your controller and the data access layer.</span></span> <span data-ttu-id="8107a-107">Bu öğreticileri basit tutmak ve Entity Framework'ün kendisini nasıl kullanacağını öğretmeye odaklanmak için depolar kullanmaz.</span><span class="sxs-lookup"><span data-stu-id="8107a-107">To keep these tutorials simple and focused on teaching how to use the Entity Framework itself, they don't use repositories.</span></span> <span data-ttu-id="8107a-108">EF ile depolar hakkında daha fazla bilgi için [bu serinin son öğreticibakın.](advanced.md)</span><span class="sxs-lookup"><span data-stu-id="8107a-108">For information about repositories with EF, see [the last tutorial in this series](advanced.md).</span></span>

<span data-ttu-id="8107a-109">Bu öğreticide şunları yaptınız:</span><span class="sxs-lookup"><span data-stu-id="8107a-109">In this tutorial, you:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="8107a-110">Ayrıntılar sayfasını özelleştirin</span><span class="sxs-lookup"><span data-stu-id="8107a-110">Customize the Details page</span></span>
> * <span data-ttu-id="8107a-111">Oluştur sayfasını güncelleştirin</span><span class="sxs-lookup"><span data-stu-id="8107a-111">Update the Create page</span></span>
> * <span data-ttu-id="8107a-112">Edit sayfasını güncelleştir</span><span class="sxs-lookup"><span data-stu-id="8107a-112">Update the Edit page</span></span>
> * <span data-ttu-id="8107a-113">Sil sayfasını güncelleştir</span><span class="sxs-lookup"><span data-stu-id="8107a-113">Update the Delete page</span></span>
> * <span data-ttu-id="8107a-114">Veritabanı bağlantılarını kapatma</span><span class="sxs-lookup"><span data-stu-id="8107a-114">Close database connections</span></span>

## <a name="prerequisites"></a><span data-ttu-id="8107a-115">Ön koşullar</span><span class="sxs-lookup"><span data-stu-id="8107a-115">Prerequisites</span></span>

* [<span data-ttu-id="8107a-116">EF Core ve ASP.NET Core MVC ile başlayın</span><span class="sxs-lookup"><span data-stu-id="8107a-116">Get started with EF Core and ASP.NET Core MVC</span></span>](intro.md)

## <a name="customize-the-details-page"></a><span data-ttu-id="8107a-117">Ayrıntılar sayfasını özelleştirin</span><span class="sxs-lookup"><span data-stu-id="8107a-117">Customize the Details page</span></span>

<span data-ttu-id="8107a-118">Öğrenci Dizini sayfasının iskele kodu, bu `Enrollments` özelliğin bir koleksiyona sahip olması nedeniyle özelliği dışarıda bıraktı.</span><span class="sxs-lookup"><span data-stu-id="8107a-118">The scaffolded code for the Students Index page left out the `Enrollments` property, because that property holds a collection.</span></span> <span data-ttu-id="8107a-119">**Ayrıntılar** sayfasında, koleksiyonun içeriğini bir HTML tablosunda görüntülersiniz.</span><span class="sxs-lookup"><span data-stu-id="8107a-119">In the **Details** page, you'll display the contents of the collection in an HTML table.</span></span>

<span data-ttu-id="8107a-120">*Denetleyiciler/StudentsController.cs 'de*Ayrıntılar görünümü için eylem `SingleOrDefaultAsync` yöntemi tek `Student` bir varlığı almak için yöntemi kullanır.</span><span class="sxs-lookup"><span data-stu-id="8107a-120">In *Controllers/StudentsController.cs*, the action method for the Details view uses the `SingleOrDefaultAsync` method to retrieve a single `Student` entity.</span></span> <span data-ttu-id="8107a-121">Çağıran `Include`kod ekle.</span><span class="sxs-lookup"><span data-stu-id="8107a-121">Add code that calls `Include`.</span></span> <span data-ttu-id="8107a-122">`ThenInclude`ve `AsNoTracking` yöntemler, aşağıdaki vurgulanan kodda gösterildiği gibi.</span><span class="sxs-lookup"><span data-stu-id="8107a-122">`ThenInclude`,  and `AsNoTracking` methods, as shown in the following highlighted code.</span></span>

[!code-csharp[](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_Details&highlight=8-12)]

<span data-ttu-id="8107a-123">Ve `Include` `ThenInclude` yöntemler, bağlamın gezinti `Student.Enrollments` özelliğini yüklemesine ve `Enrollment.Course` her kayıt içinde gezinti özelliğine neden olur.</span><span class="sxs-lookup"><span data-stu-id="8107a-123">The `Include` and `ThenInclude` methods cause the context to load the `Student.Enrollments` navigation property, and within each enrollment the `Enrollment.Course` navigation property.</span></span>  <span data-ttu-id="8107a-124">Bu yöntemler hakkında daha fazla [read related data](read-related-data.md) bilgi edinebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="8107a-124">You'll learn more about these methods in the [read related data](read-related-data.md) tutorial.</span></span>

<span data-ttu-id="8107a-125">Yöntem, `AsNoTracking` döndürülen varlıkların geçerli bağlamın ömrü nde güncelleştirilmeyeceği senaryolarda performansı artırır.</span><span class="sxs-lookup"><span data-stu-id="8107a-125">The `AsNoTracking` method improves performance in scenarios where the entities returned won't be updated in the current context's lifetime.</span></span> <span data-ttu-id="8107a-126">Bu eğitimin sonunda `AsNoTracking` hakkında daha fazla bilgi edineceksiniz.</span><span class="sxs-lookup"><span data-stu-id="8107a-126">You'll learn more about `AsNoTracking` at the end of this tutorial.</span></span>

### <a name="route-data"></a><span data-ttu-id="8107a-127">Veri yönlendirme</span><span class="sxs-lookup"><span data-stu-id="8107a-127">Route data</span></span>

<span data-ttu-id="8107a-128">`Details` Yönteme geçirilen anahtar değer *rota verilerinden*gelir.</span><span class="sxs-lookup"><span data-stu-id="8107a-128">The key value that's passed to the `Details` method comes from *route data*.</span></span> <span data-ttu-id="8107a-129">Rota verileri, model bağlayıcısının URL'nin bir kesiminde bulduğu verilerdir.</span><span class="sxs-lookup"><span data-stu-id="8107a-129">Route data is data that the model binder found in a segment of the URL.</span></span> <span data-ttu-id="8107a-130">Örneğin, varsayılan rota denetleyici, eylem ve id segmentleri belirtir:</span><span class="sxs-lookup"><span data-stu-id="8107a-130">For example, the default route specifies controller, action, and id segments:</span></span>

[!code-csharp[](intro/samples/cu/Startup.cs?name=snippet_Route&highlight=5)]

<span data-ttu-id="8107a-131">Aşağıdaki URL'de, varsayılan rota Eğitmeni denetleyici olarak, Dizin eylem olarak ve 1 id olarak eşler; bunlar rota veri değerleridir.</span><span class="sxs-lookup"><span data-stu-id="8107a-131">In the following URL, the default route maps Instructor as the controller, Index as the action, and 1 as the id; these are route data values.</span></span>

```
http://localhost:1230/Instructor/Index/1?courseID=2021
```

<span data-ttu-id="8107a-132">URL'nin son bölümü ("?courseID=2021") bir sorgu dize değeridir.</span><span class="sxs-lookup"><span data-stu-id="8107a-132">The last part of the URL ("?courseID=2021") is a query string value.</span></span> <span data-ttu-id="8107a-133">Bir sorgu dize değeri olarak geçerseniz model bağlayıcısı da `Index` yöntem `id` parametrekimlik değeri geçecektir:</span><span class="sxs-lookup"><span data-stu-id="8107a-133">The model binder will also pass the ID value to the `Index` method `id` parameter if you pass it as a query string value:</span></span>

```
http://localhost:1230/Instructor/Index?id=1&CourseID=2021
```

<span data-ttu-id="8107a-134">Dizin sayfasında, köprü URL'leri Razor görünümünde etiket yardımcısı ifadeleri tarafından oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="8107a-134">In the Index page, hyperlink URLs are created by tag helper statements in the Razor view.</span></span> <span data-ttu-id="8107a-135">Aşağıdaki Razor `id` kodunda, parametre varsayılan rotayla `id` eşleşir, böylece rota verilerine eklenir.</span><span class="sxs-lookup"><span data-stu-id="8107a-135">In the following Razor code, the `id` parameter matches the default route, so `id` is added to the route data.</span></span>

```html
<a asp-action="Edit" asp-route-id="@item.ID">Edit</a>
```

<span data-ttu-id="8107a-136">Bu, 6 olduğunda `item.ID` aşağıdaki HTML'yi oluşturur:</span><span class="sxs-lookup"><span data-stu-id="8107a-136">This generates the following HTML when `item.ID` is 6:</span></span>

```html
<a href="/Students/Edit/6">Edit</a>
```

<span data-ttu-id="8107a-137">Aşağıdaki Razor kodunda, `studentID` varsayılan rotadaki bir parametreyle eşleşmez, bu nedenle sorgu dizesi olarak eklenir.</span><span class="sxs-lookup"><span data-stu-id="8107a-137">In the following Razor code, `studentID` doesn't match a parameter in the default route, so it's added as a query string.</span></span>

```html
<a asp-action="Edit" asp-route-studentID="@item.ID">Edit</a>
```

<span data-ttu-id="8107a-138">Bu, 6 olduğunda `item.ID` aşağıdaki HTML'yi oluşturur:</span><span class="sxs-lookup"><span data-stu-id="8107a-138">This generates the following HTML when `item.ID` is 6:</span></span>

```html
<a href="/Students/Edit?studentID=6">Edit</a>
```

<span data-ttu-id="8107a-139">Etiket yardımcıları hakkında daha fazla <xref:mvc/views/tag-helpers/intro>bilgi için bkz.</span><span class="sxs-lookup"><span data-stu-id="8107a-139">For more information about tag helpers, see <xref:mvc/views/tag-helpers/intro>.</span></span>

### <a name="add-enrollments-to-the-details-view"></a><span data-ttu-id="8107a-140">Ayrıntılar görünümüne kayıt ekleme</span><span class="sxs-lookup"><span data-stu-id="8107a-140">Add enrollments to the Details view</span></span>

<span data-ttu-id="8107a-141">*Açık Görünümler/Öğrenciler/Ayrıntılar.cshtml*.</span><span class="sxs-lookup"><span data-stu-id="8107a-141">Open *Views/Students/Details.cshtml*.</span></span> <span data-ttu-id="8107a-142">Her alan, `DisplayNameFor` aşağıdaki `DisplayFor` örnekte gösterildiği gibi, aşağıdaki şekilde kullanılarak ve yardımcılar kullanılarak görüntülenir:</span><span class="sxs-lookup"><span data-stu-id="8107a-142">Each field is displayed using `DisplayNameFor` and `DisplayFor` helpers, as shown in the following example:</span></span>

[!code-html[](intro/samples/cu/Views/Students/Details.cshtml?range=13-18&highlight=2,5)]

<span data-ttu-id="8107a-143">Son alandan sonra ve `</dl>` kapanış etiketinden hemen önce, kayıt listesini görüntülemek için aşağıdaki kodu ekleyin:</span><span class="sxs-lookup"><span data-stu-id="8107a-143">After the last field and immediately before the closing `</dl>` tag, add the following code to display a list of enrollments:</span></span>

[!code-html[](intro/samples/cu/Views/Students/Details.cshtml?range=31-52)]

<span data-ttu-id="8107a-144">Kodu yapıştırdıktan sonra kod girintisi yanlışsa, düzeltmek için CTRL-K-D tuşuna basın.</span><span class="sxs-lookup"><span data-stu-id="8107a-144">If code indentation is wrong after you paste the code, press CTRL-K-D to correct it.</span></span>

<span data-ttu-id="8107a-145">Bu kod, gezinti özelliğindeki `Enrollments` varlıklar arasında döngüler.</span><span class="sxs-lookup"><span data-stu-id="8107a-145">This code loops through the entities in the `Enrollments` navigation property.</span></span> <span data-ttu-id="8107a-146">Her kayıt için ders unvanını ve notu görüntüler.</span><span class="sxs-lookup"><span data-stu-id="8107a-146">For each enrollment, it displays the course title and the grade.</span></span> <span data-ttu-id="8107a-147">Kurs unvanı, Kayıtlar kuruluşunun `Course` navigasyon özelliğinde depolanan Kurs kuruluşundan alınır.</span><span class="sxs-lookup"><span data-stu-id="8107a-147">The course title is retrieved from the Course entity that's stored in the `Course` navigation property of the Enrollments entity.</span></span>

<span data-ttu-id="8107a-148">Uygulamayı çalıştırın, **Öğrenciler** sekmesini seçin ve bir öğrenciiçin **Ayrıntılar** bağlantısını tıklatın.</span><span class="sxs-lookup"><span data-stu-id="8107a-148">Run the app, select the **Students** tab, and click the **Details** link for a student.</span></span> <span data-ttu-id="8107a-149">Seçilen öğrencinin ders ve notlarının listesini görürsünüz:</span><span class="sxs-lookup"><span data-stu-id="8107a-149">You see the list of courses and grades for the selected student:</span></span>

![Öğrenci Detayları sayfası](crud/_static/student-details.png)

## <a name="update-the-create-page"></a><span data-ttu-id="8107a-151">Oluştur sayfasını güncelleştirin</span><span class="sxs-lookup"><span data-stu-id="8107a-151">Update the Create page</span></span>

<span data-ttu-id="8107a-152">*StudentsController.cs,* bir try-catch bloğu ekleyerek ve öznitelik kimliği kaldırarak HttpPost `Create` yöntemini `Bind` değiştirin.</span><span class="sxs-lookup"><span data-stu-id="8107a-152">In *StudentsController.cs*, modify the HttpPost `Create` method by adding a try-catch block and removing ID from the `Bind` attribute.</span></span>

[!code-csharp[](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_Create&highlight=4,6-7,14-21)]

<span data-ttu-id="8107a-153">Bu kod, ASP.NET Core MVC modeli bağlayıcısı tarafından oluşturulan Öğrenci varlığını Öğrenci varlık kümesine ekler ve sonra değişiklikleri veritabanına kaydeder.</span><span class="sxs-lookup"><span data-stu-id="8107a-153">This code adds the Student entity created by the ASP.NET Core MVC model binder to the Students entity set and then saves the changes to the database.</span></span> <span data-ttu-id="8107a-154">(Model bağlayıcısı, form tarafından gönderilen verilerle çalışmanızı kolaylaştıran ASP.NET Core MVC işlevini ifade eder; bir model bağlayıcısı deftere nakledilen form değerlerini CLR türlerine dönüştürür ve bunları parametrelerdeki eylem yöntemine geçirir.</span><span class="sxs-lookup"><span data-stu-id="8107a-154">(Model binder refers to the ASP.NET Core MVC functionality that makes it easier for you to work with data submitted by a form; a model binder converts posted form values to CLR types and passes them to the action method in parameters.</span></span> <span data-ttu-id="8107a-155">Bu durumda, model bağlayıcısı Form koleksiyonundaki özellik değerlerini kullanarak öğrenci varlığını anında alır.)</span><span class="sxs-lookup"><span data-stu-id="8107a-155">In this case, the model binder instantiates a Student entity for you using property values from the Form collection.)</span></span>

<span data-ttu-id="8107a-156">ID, `ID` SQL `Bind` Server'ın satır eklendiğinde otomatik olarak ayarladığı birincil anahtar değeri olduğu için öznitelikten kaldırıldınız.</span><span class="sxs-lookup"><span data-stu-id="8107a-156">You removed `ID` from the `Bind` attribute because ID is the primary key value which SQL Server will set automatically when the row is inserted.</span></span> <span data-ttu-id="8107a-157">Kullanıcıdan giriş, kimlik değerini belirlemez.</span><span class="sxs-lookup"><span data-stu-id="8107a-157">Input from the user doesn't set the ID value.</span></span>

<span data-ttu-id="8107a-158">Öznitelik `Bind` dışında, try-catch bloğu, iskele kodunda yaptığınız tek değişikliktir.</span><span class="sxs-lookup"><span data-stu-id="8107a-158">Other than the `Bind` attribute, the try-catch block is the only change you've made to the scaffolded code.</span></span> <span data-ttu-id="8107a-159">Değişiklikler kaydedilirken türeyen `DbUpdateException` bir özel durum yakalanırsa, genel bir hata iletisi görüntülenir.</span><span class="sxs-lookup"><span data-stu-id="8107a-159">If an exception that derives from `DbUpdateException` is caught while the changes are being saved, a generic error message is displayed.</span></span> <span data-ttu-id="8107a-160">`DbUpdateException`özel durumlar bazen bir programlama hatası yerine uygulamanın dışında bir şey neden olur, bu nedenle kullanıcının yeniden denemesi önerilir.</span><span class="sxs-lookup"><span data-stu-id="8107a-160">`DbUpdateException` exceptions are sometimes caused by something external to the application rather than a programming error, so the user is advised to try again.</span></span> <span data-ttu-id="8107a-161">Bu örnekte uygulanmasa da, üretim kalitesi uygulaması özel durumu günlüğe kaydeder.</span><span class="sxs-lookup"><span data-stu-id="8107a-161">Although not implemented in this sample, a production quality application would log the exception.</span></span> <span data-ttu-id="8107a-162">Daha fazla bilgi için İzleme [ve Telemetri (Azure ile Gerçek Dünya Bulut Uygulamaları Oluşturma)](/aspnet/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/monitoring-and-telemetry) **bölümündeki öngörü** ler için Günlük bölümüne bakın.</span><span class="sxs-lookup"><span data-stu-id="8107a-162">For more information, see the **Log for insight** section in [Monitoring and Telemetry (Building Real-World Cloud Apps with Azure)](/aspnet/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/monitoring-and-telemetry).</span></span>

<span data-ttu-id="8107a-163">Öznitelik, `ValidateAntiForgeryToken` siteler arası istek sahteciliği (CSRF) saldırılarını önlemeye yardımcı olur.</span><span class="sxs-lookup"><span data-stu-id="8107a-163">The `ValidateAntiForgeryToken` attribute helps prevent cross-site request forgery (CSRF) attacks.</span></span> <span data-ttu-id="8107a-164">Belirteç, [FormTagHelper](xref:mvc/views/working-with-forms#the-form-tag-helper) tarafından görüntüye otomatik olarak enjekte edilir ve form kullanıcı tarafından gönderildiğinde dahil edilir.</span><span class="sxs-lookup"><span data-stu-id="8107a-164">The token is automatically injected into the view by the [FormTagHelper](xref:mvc/views/working-with-forms#the-form-tag-helper) and is included when the form is submitted by the user.</span></span> <span data-ttu-id="8107a-165">Belirteç öznitelik tarafından `ValidateAntiForgeryToken` doğrulanır.</span><span class="sxs-lookup"><span data-stu-id="8107a-165">The token is validated by the `ValidateAntiForgeryToken` attribute.</span></span> <span data-ttu-id="8107a-166">CSRF hakkında daha fazla bilgi için [Anti-İstek Sahteciliği'ne](../../security/anti-request-forgery.md)bakın.</span><span class="sxs-lookup"><span data-stu-id="8107a-166">For more information about CSRF, see [Anti-Request Forgery](../../security/anti-request-forgery.md).</span></span>

<a id="overpost"></a>

### <a name="security-note-about-overposting"></a><span data-ttu-id="8107a-167">Aşırı gönderme ile ilgili güvenlik notu</span><span class="sxs-lookup"><span data-stu-id="8107a-167">Security note about overposting</span></span>

<span data-ttu-id="8107a-168">`Bind` İskele koduyöntemde `Create` içerdiği öznitelik, oluşturma senaryolarında aşırıya katlamaya karşı korumanın bir yoludur.</span><span class="sxs-lookup"><span data-stu-id="8107a-168">The `Bind` attribute that the scaffolded code includes on the `Create` method is one way to protect against overposting in create scenarios.</span></span> <span data-ttu-id="8107a-169">Örneğin, Öğrenci tüzel kişiliğinin bu web sayfasının ayarlamasını istemediğiniz bir `Secret` özellik içerdiğini varsayalım.</span><span class="sxs-lookup"><span data-stu-id="8107a-169">For example, suppose the Student entity includes a `Secret` property that you don't want this web page to set.</span></span>

```csharp
public class Student
{
    public int ID { get; set; }
    public string LastName { get; set; }
    public string FirstMidName { get; set; }
    public DateTime EnrollmentDate { get; set; }
    public string Secret { get; set; }
}
```

<span data-ttu-id="8107a-170">Web sayfasında bir `Secret` alanınız olmasa bile, bir bilgisayar korsanı `Secret` form değeri göndermek için Fiddler gibi bir araç kullanabilir veya bazı JavaScript yazabilir.</span><span class="sxs-lookup"><span data-stu-id="8107a-170">Even if you don't have a `Secret` field on the web page, a hacker could use a tool such as Fiddler, or write some JavaScript, to post a `Secret` form value.</span></span> <span data-ttu-id="8107a-171">`Bind` Model bağlayıcısının Öğrenci örneğini oluştururken kullandığı alanları sınırlayan öznitelik olmadan, model bağlayıcısı `Secret` bu form değerini alır ve Öğrenci varlık örneğini oluşturmak için kullanır.</span><span class="sxs-lookup"><span data-stu-id="8107a-171">Without the `Bind` attribute limiting the fields that the model binder uses when it creates a Student instance, the model binder would pick up that `Secret` form value and use it to create the Student entity instance.</span></span> <span data-ttu-id="8107a-172">Daha sonra, `Secret` form alanı için belirtilen bilgisayar korsanı değeri veritabanınızda güncelleştirilir.</span><span class="sxs-lookup"><span data-stu-id="8107a-172">Then whatever value the hacker specified for the `Secret` form field would be updated in your database.</span></span> <span data-ttu-id="8107a-173">Aşağıdaki resimde Fiddler aracı, `Secret` deftere nakledilen form değerlerine alanı ("OverPost" değeriyle) ekleyerek gösterir.</span><span class="sxs-lookup"><span data-stu-id="8107a-173">The following image shows the Fiddler tool adding the `Secret` field (with the value "OverPost") to the posted form values.</span></span>

![Fiddler Gizli alan ekleme](crud/_static/fiddler.png)

<span data-ttu-id="8107a-175">"OverPost" değeri daha sonra eklenen satırın `Secret` özelliğine başarıyla eklenir, ancak web sayfasının bu özelliği ayarlayabilmesi ni hiç amaçlamamanıza rağmen.</span><span class="sxs-lookup"><span data-stu-id="8107a-175">The value "OverPost" would then be successfully added to the `Secret` property of the inserted row, although you never intended that the web page be able to set that property.</span></span>

<span data-ttu-id="8107a-176">Önce veritabanından varlığı okuyup sonra açık izin verilen özellikler listesinden geçerek çağırarak `TryUpdateModel`düzenleme senaryolarında aşırı deftere nakilyi önleyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="8107a-176">You can prevent overposting in edit scenarios by reading the entity from the database first and then calling `TryUpdateModel`, passing in an explicit allowed properties list.</span></span> <span data-ttu-id="8107a-177">Bu öğreticilerde kullanılan yöntem bu.</span><span class="sxs-lookup"><span data-stu-id="8107a-177">That's the method used in these tutorials.</span></span>

<span data-ttu-id="8107a-178">Birçok geliştirici tarafından tercih edilen aşırı deftere nakilleri önlemenin alternatif bir yolu, model bağlamalı varlık sınıfları yerine görünüm modellerini kullanmaktır.</span><span class="sxs-lookup"><span data-stu-id="8107a-178">An alternative way to prevent overposting that's preferred by many developers is to use view models rather than entity classes with model binding.</span></span> <span data-ttu-id="8107a-179">Görünüm modelinde yalnızca güncelleştirmek istediğiniz özellikleri ekleyin.</span><span class="sxs-lookup"><span data-stu-id="8107a-179">Include only the properties you want to update in the view model.</span></span> <span data-ttu-id="8107a-180">MVC model bağlayıcısı tamamlandıktan sonra, isteğe bağlı olarak AutoMapper gibi bir araç kullanarak görünüm modeli özelliklerini varlık örneğine kopyalayın.</span><span class="sxs-lookup"><span data-stu-id="8107a-180">Once the MVC model binder has finished, copy the view model properties to the entity instance, optionally using a tool such as AutoMapper.</span></span> <span data-ttu-id="8107a-181">Durum `_context.Entry` `Unchanged`durumunu ayarlamak ve ardından görünüm modelinde `Property("PropertyName").IsModified` yer alan her varlık özelliğinde doğru olarak ayarlamak için varlık örneğini kullanın.</span><span class="sxs-lookup"><span data-stu-id="8107a-181">Use `_context.Entry` on the entity instance to set its state to `Unchanged`, and then set `Property("PropertyName").IsModified` to true on each entity property that's included in the view model.</span></span> <span data-ttu-id="8107a-182">Bu yöntem hem düzenlemesi hem de senaryooluşturmada çalışır.</span><span class="sxs-lookup"><span data-stu-id="8107a-182">This method works in both edit and create scenarios.</span></span>

### <a name="test-the-create-page"></a><span data-ttu-id="8107a-183">Oluştur sayfasını test edin</span><span class="sxs-lookup"><span data-stu-id="8107a-183">Test the Create page</span></span>

<span data-ttu-id="8107a-184">*Görünümler/Öğrenciler/Create.cshtml'deki* `label`kod, `input` `span` her alan için yardımcıları ve (doğrulama iletileri için) kullanır.</span><span class="sxs-lookup"><span data-stu-id="8107a-184">The code in *Views/Students/Create.cshtml* uses `label`, `input`, and `span` (for validation messages) tag helpers for each field.</span></span>

<span data-ttu-id="8107a-185">Uygulamayı çalıştırın, **Öğrenciler** sekmesini seçin ve **Yeni Oluştur'u**tıklatın.</span><span class="sxs-lookup"><span data-stu-id="8107a-185">Run the app, select the **Students** tab, and click **Create New**.</span></span>

<span data-ttu-id="8107a-186">Adları ve tarihi girin.</span><span class="sxs-lookup"><span data-stu-id="8107a-186">Enter names and a date.</span></span> <span data-ttu-id="8107a-187">Tarayıcınız bunu yapmanıza izin veriyorsa geçersiz bir tarih girmeyi deneyin.</span><span class="sxs-lookup"><span data-stu-id="8107a-187">Try entering an invalid date if your browser lets you do that.</span></span> <span data-ttu-id="8107a-188">(Bazı tarayıcılar sizi tarih seçici kullanmaya zorlar.) Ardından hata iletisini görmek için **Oluştur'u** tıklatın.</span><span class="sxs-lookup"><span data-stu-id="8107a-188">(Some browsers force you to use a date picker.) Then click **Create** to see the error message.</span></span>

![Tarih doğrulama hatası](crud/_static/date-error.png)

<span data-ttu-id="8107a-190">Bu, varsayılan olarak aldığınız sunucu tarafı doğrulamasI; daha sonraki bir öğreticide, istemci tarafı doğrulaması için kod oluşturacak özniteliklerin nasıl ekleyeceğinide de göreceksiniz.</span><span class="sxs-lookup"><span data-stu-id="8107a-190">This is server-side validation that you get by default; in a later tutorial you'll see how to add attributes that will generate code for client-side validation also.</span></span> <span data-ttu-id="8107a-191">Aşağıdaki vurgulanan kod yöntemde model doğrulama `Create` denetimini gösterir.</span><span class="sxs-lookup"><span data-stu-id="8107a-191">The following highlighted code shows the model validation check in the `Create` method.</span></span>

[!code-csharp[](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_Create&highlight=8)]

<span data-ttu-id="8107a-192">Tarihi geçerli bir değerle değiştirin ve yeni öğrencinin **Dizin** sayfasında görünmesini görmek için **Oluştur'u** tıklatın.</span><span class="sxs-lookup"><span data-stu-id="8107a-192">Change the date to a valid value and click **Create** to see the new student appear in the **Index** page.</span></span>

## <a name="update-the-edit-page"></a><span data-ttu-id="8107a-193">Edit sayfasını güncelleştir</span><span class="sxs-lookup"><span data-stu-id="8107a-193">Update the Edit page</span></span>

<span data-ttu-id="8107a-194">StudentController.cs'da, *StudentController.cs*HttpGet `Edit` yöntemi (özniteliği olmayan `HttpPost` yöntem) `SingleOrDefaultAsync` `Details` yöntemde gördüğünüz gibi seçili Öğrenci varlığını almak için yöntemi kullanır.</span><span class="sxs-lookup"><span data-stu-id="8107a-194">In *StudentController.cs*, the HttpGet `Edit` method (the one without the `HttpPost` attribute) uses the `SingleOrDefaultAsync` method to retrieve the selected Student entity, as you saw in the `Details` method.</span></span> <span data-ttu-id="8107a-195">Bu yöntemi değiştirmeniz gerekmez.</span><span class="sxs-lookup"><span data-stu-id="8107a-195">You don't need to change this method.</span></span>

### <a name="recommended-httppost-edit-code-read-and-update"></a><span data-ttu-id="8107a-196">Önerilen HttpPost Edit kodu: Okuma ve güncelleme</span><span class="sxs-lookup"><span data-stu-id="8107a-196">Recommended HttpPost Edit code: Read and update</span></span>

<span data-ttu-id="8107a-197">HttpPost Edit eylem yöntemini aşağıdaki kodla değiştirin.</span><span class="sxs-lookup"><span data-stu-id="8107a-197">Replace the HttpPost Edit action method with the following code.</span></span>

[!code-csharp[](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_ReadFirst)]

<span data-ttu-id="8107a-198">Bu değişiklikler, aşırı göndermeyi önlemek için bir güvenlik en iyi uygulama uygular.</span><span class="sxs-lookup"><span data-stu-id="8107a-198">These changes implement a security best practice to prevent overposting.</span></span> <span data-ttu-id="8107a-199">İskele klasörü bir `Bind` öznitelik oluşturdu ve model bağlayıcısı tarafından oluşturulan varlığı `Modified` bir bayrak ile ayarlanan varlığa ekledi.</span><span class="sxs-lookup"><span data-stu-id="8107a-199">The scaffolder generated a `Bind` attribute and added the entity created by the model binder to the entity set with a `Modified` flag.</span></span> <span data-ttu-id="8107a-200">`Bind` Öznitelik `Include` parametrede listelenmemiş alanlarda önceden varolan verileri temizler, çünkü bu kod birçok senaryo için önerilmez.</span><span class="sxs-lookup"><span data-stu-id="8107a-200">That code isn't recommended for many scenarios because the `Bind` attribute clears out any pre-existing data in fields not listed in the `Include` parameter.</span></span>

<span data-ttu-id="8107a-201">Yeni kod, varolan varlığı `TryUpdateModel` okur ve [deftere nakledilen form verilerindeki kullanıcı girişine dayalı](xref:mvc/models/model-binding)olarak alınan varlıktaki alanları güncelleştirmek için çağrılar.</span><span class="sxs-lookup"><span data-stu-id="8107a-201">The new code reads the existing entity and calls `TryUpdateModel` to update fields in the retrieved entity [based on user input in the posted form data](xref:mvc/models/model-binding).</span></span> <span data-ttu-id="8107a-202">Varlık Çerçevesi'nin otomatik değişiklik `Modified` izleme formu girişi ile değiştirilen alanlarda bayrağı ayarlar.</span><span class="sxs-lookup"><span data-stu-id="8107a-202">The Entity Framework's automatic change tracking sets the `Modified` flag on the fields that are changed by form input.</span></span> <span data-ttu-id="8107a-203">`SaveChanges` Yöntem çağrıldığında, Varlık Çerçevesi veritabanı satırını güncelleştirmek için SQL deyimleri oluşturur.</span><span class="sxs-lookup"><span data-stu-id="8107a-203">When the `SaveChanges` method is called, the Entity Framework creates SQL statements to update the database row.</span></span> <span data-ttu-id="8107a-204">Eşzamanlılık çakışmaları yoksayılır ve yalnızca kullanıcı tarafından güncelleştirilen tablo sütunları veritabanında güncelleştirilir.</span><span class="sxs-lookup"><span data-stu-id="8107a-204">Concurrency conflicts are ignored, and only the table columns that were updated by the user are updated in the database.</span></span> <span data-ttu-id="8107a-205">(Daha sonraki bir öğretici eşzamanlılık çakışmaları nasıl ele alınılacağını gösterir.)</span><span class="sxs-lookup"><span data-stu-id="8107a-205">(A later tutorial shows how to handle concurrency conflicts.)</span></span>

<span data-ttu-id="8107a-206">Aşırı deftere nakil önlemek için en iyi yöntem olarak, **Düzenleme** sayfası tarafından güncelleştirilebilmesini istediğiniz alanlar `TryUpdateModel` parametrelerde beyaz listelenir.</span><span class="sxs-lookup"><span data-stu-id="8107a-206">As a best practice to prevent overposting, the fields that you want to be updateable by the **Edit** page are whitelisted in the `TryUpdateModel` parameters.</span></span> <span data-ttu-id="8107a-207">(Parametre listesindeki alanların listesinden önceki boş dize, form alanları adlarıyla kullanılacak bir önek içindir.) Şu anda koruduğunuz ek alan yok, ancak model bağlayıcısının bağlanmasını istediğiniz alanları listelemek, gelecekte veri modeline alan eklerseniz, bunları açıkça buraya ekleyene kadar otomatik olarak korunduklarını sağlar.</span><span class="sxs-lookup"><span data-stu-id="8107a-207">(The empty string preceding the list of fields in the parameter list is for a prefix to use with the form fields names.) Currently there are no extra fields that you're protecting, but listing the fields that you want the model binder to bind ensures that if you add fields to the data model in the future, they're automatically protected until you explicitly add them here.</span></span>

<span data-ttu-id="8107a-208">Bu değişikliklerin bir sonucu olarak, HttpPost `Edit` yönteminin yöntem imzası HttpGet `Edit` yöntemiyle aynıdır; bu nedenle yöntemi `EditPost`yeniden adlandırdın.</span><span class="sxs-lookup"><span data-stu-id="8107a-208">As a result of these changes, the method signature of the HttpPost `Edit` method is the same as the HttpGet `Edit` method; therefore you've renamed the method `EditPost`.</span></span>

### <a name="alternative-httppost-edit-code-create-and-attach"></a><span data-ttu-id="8107a-209">Alternatif HttpPost Edit kodu: Oluştur ve ekle</span><span class="sxs-lookup"><span data-stu-id="8107a-209">Alternative HttpPost Edit code: Create and attach</span></span>

<span data-ttu-id="8107a-210">Önerilen HttpPost düzenleme kodu, yalnızca değiştirilen sütunların güncelleştirilmesini sağlar ve model bağlama için dahil edilmesini istemediğiniz özelliklerdeki verileri korur.</span><span class="sxs-lookup"><span data-stu-id="8107a-210">The recommended HttpPost edit code ensures that only changed columns get updated and preserves data in properties that you don't want included for model binding.</span></span> <span data-ttu-id="8107a-211">Ancak, ilk okuma yaklaşımı fazladan bir veritabanı okuması gerektirir ve eşzamanlılık çakışmaları işlemek için daha karmaşık kodlar neden olabilir.</span><span class="sxs-lookup"><span data-stu-id="8107a-211">However, the read-first approach requires an extra database read, and can result in more complex code for handling concurrency conflicts.</span></span> <span data-ttu-id="8107a-212">Alternatif, model bağlayıcısı tarafından oluşturulan bir varlığı EF bağlamına eklemek ve değiştirilmiş olarak işaretlemektir.</span><span class="sxs-lookup"><span data-stu-id="8107a-212">An alternative is to attach an entity created by the model binder to the EF context and mark it as modified.</span></span> <span data-ttu-id="8107a-213">(Projenizi bu kodla güncellemeyin, yalnızca isteğe bağlı bir yaklaşımı göstermek için gösterilir.)</span><span class="sxs-lookup"><span data-stu-id="8107a-213">(Don't update your project with this code, it's only shown to illustrate an optional approach.)</span></span>

[!code-csharp[](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_CreateAndAttach)]

<span data-ttu-id="8107a-214">Web sayfası Kullanıcı GSürümü varlıktaki tüm alanları içerdiğinde ve bunlardan herhangi birini güncelleştirebildiği zaman bu yaklaşımı kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="8107a-214">You can use this approach when the web page UI includes all of the fields in the entity and can update any of them.</span></span>

<span data-ttu-id="8107a-215">İskele kodu oluşturma ve iliştirme yaklaşımını kullanır, `DbUpdateConcurrencyException` ancak yalnızca özel durumları yakalar ve 404 hata kodlarını döndürür.</span><span class="sxs-lookup"><span data-stu-id="8107a-215">The scaffolded code uses the create-and-attach approach but only catches `DbUpdateConcurrencyException` exceptions and returns 404 error codes.</span></span>  <span data-ttu-id="8107a-216">Gösterilen örnek, herhangi bir veritabanı güncelleştirme özel durum yakalar ve bir hata iletisi görüntüler.</span><span class="sxs-lookup"><span data-stu-id="8107a-216">The example shown catches any database update exception and displays an error message.</span></span>

### <a name="entity-states"></a><span data-ttu-id="8107a-217">Taraf Devletleri</span><span class="sxs-lookup"><span data-stu-id="8107a-217">Entity States</span></span>

<span data-ttu-id="8107a-218">Veritabanı bağlamı, bellekteki varlıkların veritabanındaki karşılık gelen satırlarla eşitlenip eşit olmadığını izler ve bu `SaveChanges` bilgiler yöntemi çağırdığınızda ne olacağını belirler.</span><span class="sxs-lookup"><span data-stu-id="8107a-218">The database context keeps track of whether entities in memory are in sync with their corresponding rows in the database, and this information determines what happens when you call the `SaveChanges` method.</span></span> <span data-ttu-id="8107a-219">Örneğin, `Add` yönteme yeni bir varlık geçtiğinde, o varlığın `Added`durumu .</span><span class="sxs-lookup"><span data-stu-id="8107a-219">For example, when you pass a new entity to the `Add` method, that entity's state is set to `Added`.</span></span> <span data-ttu-id="8107a-220">Daha sonra `SaveChanges` yöntemi çağırdığınızda, veritabanı bağlamı bir SQL INSERT komutu yayınlar.</span><span class="sxs-lookup"><span data-stu-id="8107a-220">Then when you call the `SaveChanges` method, the database context issues a SQL INSERT command.</span></span>

<span data-ttu-id="8107a-221">Bir varlık aşağıdaki durumlardan birinde olabilir:</span><span class="sxs-lookup"><span data-stu-id="8107a-221">An entity may be in one of the following states:</span></span>

* <span data-ttu-id="8107a-222">`Added`.</span><span class="sxs-lookup"><span data-stu-id="8107a-222">`Added`.</span></span> <span data-ttu-id="8107a-223">Varlık henüz veritabanında yok.</span><span class="sxs-lookup"><span data-stu-id="8107a-223">The entity doesn't yet exist in the database.</span></span> <span data-ttu-id="8107a-224">Yöntem `SaveChanges` bir INSERT deyimi yayınlar.</span><span class="sxs-lookup"><span data-stu-id="8107a-224">The `SaveChanges` method issues an INSERT statement.</span></span>

* <span data-ttu-id="8107a-225">`Unchanged`.</span><span class="sxs-lookup"><span data-stu-id="8107a-225">`Unchanged`.</span></span> <span data-ttu-id="8107a-226">Bu varlıkla `SaveChanges` yöntemle hiçbir şey yapılamamalıdır.</span><span class="sxs-lookup"><span data-stu-id="8107a-226">Nothing needs to be done with this entity by the `SaveChanges` method.</span></span> <span data-ttu-id="8107a-227">Veritabanından bir varlık okuduğunuzda, varlık bu durumla başlar.</span><span class="sxs-lookup"><span data-stu-id="8107a-227">When you read an entity from the database, the entity starts out with this status.</span></span>

* <span data-ttu-id="8107a-228">`Modified`.</span><span class="sxs-lookup"><span data-stu-id="8107a-228">`Modified`.</span></span> <span data-ttu-id="8107a-229">Varlığın özellik değerlerinin bir kısmı veya tümü değiştirildi.</span><span class="sxs-lookup"><span data-stu-id="8107a-229">Some or all of the entity's property values have been modified.</span></span> <span data-ttu-id="8107a-230">Yöntem, `SaveChanges` UPDATE deyimini yayınlar.</span><span class="sxs-lookup"><span data-stu-id="8107a-230">The `SaveChanges` method issues an UPDATE statement.</span></span>

* <span data-ttu-id="8107a-231">`Deleted`.</span><span class="sxs-lookup"><span data-stu-id="8107a-231">`Deleted`.</span></span> <span data-ttu-id="8107a-232">Varlık silinmesi için işaretlenmiştir.</span><span class="sxs-lookup"><span data-stu-id="8107a-232">The entity has been marked for deletion.</span></span> <span data-ttu-id="8107a-233">Yöntem, `SaveChanges` DELETE deyimi ni yayınlar.</span><span class="sxs-lookup"><span data-stu-id="8107a-233">The `SaveChanges` method issues a DELETE statement.</span></span>

* <span data-ttu-id="8107a-234">`Detached`.</span><span class="sxs-lookup"><span data-stu-id="8107a-234">`Detached`.</span></span> <span data-ttu-id="8107a-235">Varlık veritabanı bağlamı tarafından izlenmiyor.</span><span class="sxs-lookup"><span data-stu-id="8107a-235">The entity isn't being tracked by the database context.</span></span>

<span data-ttu-id="8107a-236">Bir masaüstü uygulamasında durum değişiklikleri genellikle otomatik olarak ayarlanır.</span><span class="sxs-lookup"><span data-stu-id="8107a-236">In a desktop application, state changes are typically set automatically.</span></span> <span data-ttu-id="8107a-237">Bir varlığı okur ve bazı özellik değerlerinde değişiklik yaparsınız.</span><span class="sxs-lookup"><span data-stu-id="8107a-237">You read an entity and make changes to some of its property values.</span></span> <span data-ttu-id="8107a-238">Bu, varlık durumunun otomatik olarak `Modified`'' olarak değiştirilmesine neden olur.</span><span class="sxs-lookup"><span data-stu-id="8107a-238">This causes its entity state to automatically be changed to `Modified`.</span></span> <span data-ttu-id="8107a-239">Daha sonra `SaveChanges`, Entity Framework'u aradiğinizde, yalnızca değiştirdiğiniz gerçek özellikleri güncelleştiren bir SQL UPDATE deyimi oluşturur.</span><span class="sxs-lookup"><span data-stu-id="8107a-239">Then when you call `SaveChanges`, the Entity Framework generates a SQL UPDATE statement that updates only the actual properties that you changed.</span></span>

<span data-ttu-id="8107a-240">Bir web uygulamasında, `DbContext` başlangıçta bir varlığı okuyan ve düzenlenecek verileri görüntüleyen sayfa işlendikten sonra atılır.</span><span class="sxs-lookup"><span data-stu-id="8107a-240">In a web app, the `DbContext` that initially reads an entity and displays its data to be edited is disposed after a page is rendered.</span></span> <span data-ttu-id="8107a-241">HttpPost `Edit` eylem yöntemi çağrıldığında, yeni bir web isteği yapılır ve `DbContext`yeni bir örnek var.</span><span class="sxs-lookup"><span data-stu-id="8107a-241">When the HttpPost `Edit` action method is called,  a new web request is made and you have a new instance of the `DbContext`.</span></span> <span data-ttu-id="8107a-242">Varlığı bu yeni bağlamda yeniden okursanız, masaüstü işlemeyi simüle elersiniz.</span><span class="sxs-lookup"><span data-stu-id="8107a-242">If you re-read the entity in that new context, you simulate desktop processing.</span></span>

<span data-ttu-id="8107a-243">Ancak, ek okuma işlemini yapmak istemiyorsanız, model bağlayıcısı tarafından oluşturulan varlık nesnesini kullanmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="8107a-243">But if you don't want to do the extra read operation, you have to use the entity object created by the model binder.</span></span>  <span data-ttu-id="8107a-244">Bunu yapmanın en basit yolu, daha önce gösterilen alternatif HttpPost Edit kodunda yapıldığı gibi varlık durumunu Değiştirilecek şekilde ayarlamaktır.</span><span class="sxs-lookup"><span data-stu-id="8107a-244">The simplest way to do this is to set the entity state to Modified as is done in the alternative HttpPost Edit code shown earlier.</span></span> <span data-ttu-id="8107a-245">Ardından, `SaveChanges`bağlam değiştirdiğiniz özellikleri bilmenin bir yolu olmadığından, Varlık Çerçevesi veritabanı satırının tüm sütunlarını güncelleştirir.</span><span class="sxs-lookup"><span data-stu-id="8107a-245">Then when you call `SaveChanges`, the Entity Framework updates all columns of the database row, because the context has no way to know which properties you changed.</span></span>

<span data-ttu-id="8107a-246">İlk okuma yaklaşımından kaçınmak istiyorsanız, ancak SQL UPDATE deyiminin yalnızca kullanıcının gerçekten değiştirdiği alanları güncelleştirmesini istiyorsanız, kod daha karmaşıktır.</span><span class="sxs-lookup"><span data-stu-id="8107a-246">If you want to avoid the read-first approach, but you also want the SQL UPDATE statement to update only the fields that the user actually changed, the code is more complex.</span></span> <span data-ttu-id="8107a-247">Orijinal değerleri bir şekilde kaydetmeniz gerekir (gizli alanları kullanarak gibi) böylece HttpPost `Edit` yöntemi çağrıldığında kullanılabilir olurlar.</span><span class="sxs-lookup"><span data-stu-id="8107a-247">You have to save the original values in some way (such as by using hidden fields) so that they're available when the HttpPost `Edit` method is called.</span></span> <span data-ttu-id="8107a-248">Daha sonra özgün değerleri kullanarak bir Öğrenci `Attach` varlığı oluşturabilir, varlığın özgün sürümüyle yöntemi arayabilir, varlığın değerlerini `SaveChanges`yeni değerlere güncelleyebilir ve sonra .</span><span class="sxs-lookup"><span data-stu-id="8107a-248">Then you can create a Student entity using the original values, call the `Attach` method with that original version of the entity, update the entity's values to the new values, and then call `SaveChanges`.</span></span>

### <a name="test-the-edit-page"></a><span data-ttu-id="8107a-249">Edit sayfasını test edin</span><span class="sxs-lookup"><span data-stu-id="8107a-249">Test the Edit page</span></span>

<span data-ttu-id="8107a-250">Uygulamayı çalıştırın, **Öğrenciler** sekmesini seçin ve ardından bir **Edit** köprüünü tıklatın.</span><span class="sxs-lookup"><span data-stu-id="8107a-250">Run the app, select the **Students** tab, then click an **Edit** hyperlink.</span></span>

![Öğrenciler sayfayı edin](crud/_static/student-edit.png)

<span data-ttu-id="8107a-252">Bazı verileri değiştirin ve **Kaydet'i**tıklatın.</span><span class="sxs-lookup"><span data-stu-id="8107a-252">Change some of the data and click **Save**.</span></span> <span data-ttu-id="8107a-253">**Dizin** sayfası açılır ve değiştirilen verileri görürsünüz.</span><span class="sxs-lookup"><span data-stu-id="8107a-253">The **Index** page opens and you see the changed data.</span></span>

## <a name="update-the-delete-page"></a><span data-ttu-id="8107a-254">Sil sayfasını güncelleştir</span><span class="sxs-lookup"><span data-stu-id="8107a-254">Update the Delete page</span></span>

<span data-ttu-id="8107a-255">*StudentController.cs'* de, HttpGet `Delete` yönteminin şablon `SingleOrDefaultAsync` kodu, Ayrıntılar ve Edit yöntemlerinde gördüğünüz gibi seçili Öğrenci varlığını almak için yöntemi kullanır.</span><span class="sxs-lookup"><span data-stu-id="8107a-255">In *StudentController.cs*, the template code for the HttpGet `Delete` method uses the `SingleOrDefaultAsync` method to retrieve the selected Student entity, as you saw in the Details and Edit methods.</span></span> <span data-ttu-id="8107a-256">Ancak, arama `SaveChanges` başarısız olduğunda özel bir hata iletisi uygulamak için, bu yönteme ve ilgili görünümüne bazı işlevler eklersiniz.</span><span class="sxs-lookup"><span data-stu-id="8107a-256">However, to implement a custom error message when the call to `SaveChanges` fails, you'll add some functionality to this method and its corresponding view.</span></span>

<span data-ttu-id="8107a-257">Güncelleştirme ve oluşturma işlemleri için gördüğünüz gibi, silme işlemleri iki eylem yöntemi gerektirir.</span><span class="sxs-lookup"><span data-stu-id="8107a-257">As you saw for update and create operations, delete operations require two action methods.</span></span> <span data-ttu-id="8107a-258">GET isteğine yanıt olarak çağrılan yöntem, kullanıcıya silme işlemini onaylama veya iptal etme şansı veren bir görünüm görüntüler.</span><span class="sxs-lookup"><span data-stu-id="8107a-258">The method that's called in response to a GET request displays a view that gives the user a chance to approve or cancel the delete operation.</span></span> <span data-ttu-id="8107a-259">Kullanıcı onaylarsa, bir POST isteği oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="8107a-259">If the user approves it, a POST request is created.</span></span> <span data-ttu-id="8107a-260">Bu durumda, HttpPost `Delete` yöntemi çağrılır ve daha sonra bu yöntem aslında silme işlemi gerçekleştirir.</span><span class="sxs-lookup"><span data-stu-id="8107a-260">When that happens, the HttpPost `Delete` method is called and then that method actually performs the delete operation.</span></span>

<span data-ttu-id="8107a-261">Veritabanı güncelleştirildiğinde oluşabilecek hataları işlemek `Delete` için HttpPost yöntemine bir try-catch bloğu eklersiniz.</span><span class="sxs-lookup"><span data-stu-id="8107a-261">You'll add a try-catch block to the HttpPost `Delete` method to handle any errors that might occur when the database is updated.</span></span> <span data-ttu-id="8107a-262">Bir hata oluşursa, HttpPost Delete yöntemi HttpGet Delete yöntemini çağırır ve bir hata oluştuğunu belirten bir parametre yi geçer.</span><span class="sxs-lookup"><span data-stu-id="8107a-262">If an error occurs, the HttpPost Delete method calls the HttpGet Delete method, passing it a parameter that indicates that an error has occurred.</span></span> <span data-ttu-id="8107a-263">HttpGet Delete yöntemi daha sonra onay sayfasını hata iletisiyle birlikte yeniden görüntüler ve kullanıcıya iptal etme veya yeniden deneme fırsatı verir.</span><span class="sxs-lookup"><span data-stu-id="8107a-263">The HttpGet Delete method then redisplays the confirmation page along with the error message, giving the user an opportunity to cancel or try again.</span></span>

<span data-ttu-id="8107a-264">Hata raporlamayı `Delete` yöneten aşağıdaki kodla HttpGet eylem yöntemini değiştirin.</span><span class="sxs-lookup"><span data-stu-id="8107a-264">Replace the HttpGet `Delete` action method with the following code, which manages error reporting.</span></span>

[!code-csharp[](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_DeleteGet&highlight=1,9,16-21)]

<span data-ttu-id="8107a-265">Bu kod, yöntemin değişiklikleri kaydetme hatasından sonra çağrılıp çağrılmadığını gösteren isteğe bağlı bir parametre kabul eder.</span><span class="sxs-lookup"><span data-stu-id="8107a-265">This code accepts an optional parameter that indicates whether the method was called after a failure to save changes.</span></span> <span data-ttu-id="8107a-266">Bu parametre, Daha önce `Delete` bir hata olmadan HttpGet yöntemi çağrıldığında yanlıştır.</span><span class="sxs-lookup"><span data-stu-id="8107a-266">This parameter is false when the HttpGet `Delete` method is called without a previous failure.</span></span> <span data-ttu-id="8107a-267">Bir veritabanı güncelleştirme hatasına `Delete` yanıt olarak HttpPost yöntemi tarafından çağrıldığında, parametre doğrudur ve görünüme bir hata iletisi iletilir.</span><span class="sxs-lookup"><span data-stu-id="8107a-267">When it's called by the HttpPost `Delete` method in response to a database update error, the parameter is true and an error message is passed to the view.</span></span>

### <a name="the-read-first-approach-to-httppost-delete"></a><span data-ttu-id="8107a-268">HttpPost Delete için ilk okuma yaklaşımı</span><span class="sxs-lookup"><span data-stu-id="8107a-268">The read-first approach to HttpPost Delete</span></span>

<span data-ttu-id="8107a-269">Gerçek silme `Delete` işlemini gerçekleştiren `DeleteConfirmed`ve veritabanı güncelleştirme hatalarını yakalayan Aşağıdaki kodla HttpPost eylem yöntemini (adlandırılmış) değiştirin.</span><span class="sxs-lookup"><span data-stu-id="8107a-269">Replace the HttpPost `Delete` action method (named `DeleteConfirmed`) with the following code, which performs the actual delete operation and catches any database update errors.</span></span>

[!code-csharp[](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_DeleteWithReadFirst&highlight=6-9,11-12,16-21)]

<span data-ttu-id="8107a-270">Bu kod seçili varlığı alır, `Remove` sonra varlığın durumunu `Deleted`'da ayarlamak için yöntemi çağırır.</span><span class="sxs-lookup"><span data-stu-id="8107a-270">This code retrieves the selected entity, then calls the `Remove` method to set the entity's status to `Deleted`.</span></span> <span data-ttu-id="8107a-271">Çağrıldığında, `SaveChanges` bir SQL DELETE komutu oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="8107a-271">When `SaveChanges` is called, a SQL DELETE command is generated.</span></span>

### <a name="the-create-and-attach-approach-to-httppost-delete"></a><span data-ttu-id="8107a-272">HttpPost Delete'e oluşturma ve iliştirme yaklaşımı</span><span class="sxs-lookup"><span data-stu-id="8107a-272">The create-and-attach approach to HttpPost Delete</span></span>

<span data-ttu-id="8107a-273">Yüksek hacimli bir uygulamada performansı artırmak bir öncelikse, öğrenci varlığını yalnızca birincil anahtar değerini kullanarak anında ayarlayarak ve varlık `Deleted`durumunu 'ya ayarlayarak gereksiz bir SQL sorgusundan kaçınabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="8107a-273">If improving performance in a high-volume application is a priority, you could avoid an unnecessary SQL query by instantiating a Student entity using only the primary key value and then setting the entity state to `Deleted`.</span></span> <span data-ttu-id="8107a-274">Varlık Çerçevesi'nin varlığı silmek için ihtiyacı olan tek şey bu.</span><span class="sxs-lookup"><span data-stu-id="8107a-274">That's all that the Entity Framework needs in order to delete the entity.</span></span> <span data-ttu-id="8107a-275">(Bu kodu projenize koymayın; sadece bir alternatif göstermek için buradadır.)</span><span class="sxs-lookup"><span data-stu-id="8107a-275">(Don't put this code in your project; it's here just to illustrate an alternative.)</span></span>

[!code-csharp[](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_DeleteWithoutReadFirst&highlight=7-8)]

<span data-ttu-id="8107a-276">Varlığın da silinmesi gereken ilgili verileri varsa, basamaklı silmenin veritabanında yapılandırıldığından emin olun.</span><span class="sxs-lookup"><span data-stu-id="8107a-276">If the entity has related data that should also be deleted, make sure that cascade delete is configured in the database.</span></span> <span data-ttu-id="8107a-277">Varlık silme bu yaklaşım ile, EF silinecek ilgili varlıklar olduğunu fark olmayabilir.</span><span class="sxs-lookup"><span data-stu-id="8107a-277">With this approach to entity deletion, EF might not realize there are related entities to be deleted.</span></span>

### <a name="update-the-delete-view"></a><span data-ttu-id="8107a-278">Sil görünümünü güncelleştir</span><span class="sxs-lookup"><span data-stu-id="8107a-278">Update the Delete view</span></span>

<span data-ttu-id="8107a-279">*Görünümler/Öğrenci/Delete.cshtml'de,* aşağıdaki örnekte gösterildiği gibi h2 başlığı ile h3 başlığı arasında bir hata iletisi ekleyin:</span><span class="sxs-lookup"><span data-stu-id="8107a-279">In *Views/Student/Delete.cshtml*, add an error message between the h2 heading and the h3 heading, as shown in the following example:</span></span>

[!code-html[](intro/samples/cu/Views/Students/Delete.cshtml?range=7-9&highlight=2)]

<span data-ttu-id="8107a-280">Uygulamayı çalıştırın, **Öğrenciler** sekmesini seçin ve **Sil** köprüünü tıklatın:</span><span class="sxs-lookup"><span data-stu-id="8107a-280">Run the app, select the **Students** tab, and click a **Delete** hyperlink:</span></span>

![Onay sayfasını silme](crud/_static/student-delete.png)

<span data-ttu-id="8107a-282">**Sil'i**tıklatın.</span><span class="sxs-lookup"><span data-stu-id="8107a-282">Click **Delete**.</span></span> <span data-ttu-id="8107a-283">Dizin sayfası silinen öğrenci olmadan görüntülenir.</span><span class="sxs-lookup"><span data-stu-id="8107a-283">The Index page is displayed without the deleted student.</span></span> <span data-ttu-id="8107a-284">(Eşzamanlılık öğreticisinde eylem hata işleme kodunun bir örneğini görürsünüz.)</span><span class="sxs-lookup"><span data-stu-id="8107a-284">(You'll see an example of the error handling code in action in the concurrency tutorial.)</span></span>

## <a name="close-database-connections"></a><span data-ttu-id="8107a-285">Veritabanı bağlantılarını kapatma</span><span class="sxs-lookup"><span data-stu-id="8107a-285">Close database connections</span></span>

<span data-ttu-id="8107a-286">Veritabanı bağlantısının tuttuğu kaynakları boşaltmak için, bağlam örneğinin, bu bağlantıyla yaptığınız iş bittiğinde mümkün olan en kısa sürede imha edilmesi gerekir.</span><span class="sxs-lookup"><span data-stu-id="8107a-286">To free up the resources that a database connection holds, the context instance must be disposed as soon as possible when you are done with it.</span></span> <span data-ttu-id="8107a-287">ASP.NET Core yerleşik [bağımlılık enjeksiyonu](../../fundamentals/dependency-injection.md) sizin için bu görevi halletmek.</span><span class="sxs-lookup"><span data-stu-id="8107a-287">The ASP.NET Core built-in [dependency injection](../../fundamentals/dependency-injection.md) takes care of that task for you.</span></span>

<span data-ttu-id="8107a-288">*Startup.cs,* ASP.NET Core DI kapsayıcısında `DbContext` sınıf sağlamak için [AddDbContext uzantı yöntemini](https://github.com/aspnet/EntityFrameworkCore/blob/03bcb5122e3f577a84498545fcf130ba79a3d987/src/Microsoft.EntityFrameworkCore/EntityFrameworkServiceCollectionExtensions.cs) çağırırsınız.</span><span class="sxs-lookup"><span data-stu-id="8107a-288">In *Startup.cs*, you call the [AddDbContext extension method](https://github.com/aspnet/EntityFrameworkCore/blob/03bcb5122e3f577a84498545fcf130ba79a3d987/src/Microsoft.EntityFrameworkCore/EntityFrameworkServiceCollectionExtensions.cs) to provision the `DbContext` class in the ASP.NET Core DI container.</span></span> <span data-ttu-id="8107a-289">Bu yöntem, hizmet `Scoped` ömrünü varsayılan olarak ayarlar.</span><span class="sxs-lookup"><span data-stu-id="8107a-289">That method sets the service lifetime to `Scoped` by default.</span></span> <span data-ttu-id="8107a-290">`Scoped`bağlam nesnesi yaşam süresi web isteği yaşam `Dispose` süresi ile çakışıyor anlamına gelir ve yöntem web isteğinin sonunda otomatik olarak çağrılacak.</span><span class="sxs-lookup"><span data-stu-id="8107a-290">`Scoped` means the context object lifetime coincides with the web request life time, and the `Dispose` method will be called automatically at the end of the web request.</span></span>

## <a name="handle-transactions"></a><span data-ttu-id="8107a-291">Hareketleri işleme</span><span class="sxs-lookup"><span data-stu-id="8107a-291">Handle transactions</span></span>

<span data-ttu-id="8107a-292">Varsayılan olarak Varlık Çerçevesi işlemleri dolaylı olarak uygular.</span><span class="sxs-lookup"><span data-stu-id="8107a-292">By default the Entity Framework implicitly implements transactions.</span></span> <span data-ttu-id="8107a-293">Birden çok satırda veya tabloda değişiklik yaptığınız `SaveChanges`ve ardından "Varlık Çerçevesi" dediğiniz senaryolarda, Varlık Çerçevesi otomatik olarak tüm değişikliklerinizin başarılı olmasını veya hepsinin başarısız olmasını sağlar.</span><span class="sxs-lookup"><span data-stu-id="8107a-293">In scenarios where you make changes to multiple rows or tables and then call `SaveChanges`, the Entity Framework automatically makes sure that either all of your changes succeed or they all fail.</span></span> <span data-ttu-id="8107a-294">Bazı değişiklikler önce yapılırsa ve sonra bir hata olursa, bu değişiklikler otomatik olarak geri alınır.</span><span class="sxs-lookup"><span data-stu-id="8107a-294">If some changes are done first and then an error happens, those changes are automatically rolled back.</span></span> <span data-ttu-id="8107a-295">Daha fazla denetime ihtiyaç duyduğunuz senaryolar için (örneğin, bir harekette Entity Framework dışında yapılan işlemleri eklemek istiyorsanız), [Hareketler'e](/ef/core/saving/transactions)bakın.</span><span class="sxs-lookup"><span data-stu-id="8107a-295">For scenarios where you need more control -- for example, if you want to include operations done outside of Entity Framework in a transaction -- see [Transactions](/ef/core/saving/transactions).</span></span>

## <a name="no-tracking-queries"></a><span data-ttu-id="8107a-296">Sorguları izlememe</span><span class="sxs-lookup"><span data-stu-id="8107a-296">No-tracking queries</span></span>

<span data-ttu-id="8107a-297">Veritabanı bağlamı tablo satırlarını aldığında ve bunları temsil eden varlık nesneleri oluşturduğunda, varsayılan olarak bellekteki varlıkların veritabanındakilerle eşitlenip eşitolmadığını izler.</span><span class="sxs-lookup"><span data-stu-id="8107a-297">When a database context retrieves table rows and creates entity objects that represent them, by default it keeps track of whether the entities in memory are in sync with what's in the database.</span></span> <span data-ttu-id="8107a-298">Bellekteki veriler önbellek görevi görür ve bir varlığı güncelleştirdiğinizde kullanılır.</span><span class="sxs-lookup"><span data-stu-id="8107a-298">The data in memory acts as a cache and is used when you update an entity.</span></span> <span data-ttu-id="8107a-299">Bağlam örnekleri genellikle kısa ömürlü olduğundan (her istek için yeni bir tane oluşturulur ve atılır) ve varlığı okuyan bağlam genellikle bu varlık yeniden kullanılmadan önce atılır, çünkü bu önbelleğe alma genellikle bir web uygulamasında gereksizdir.</span><span class="sxs-lookup"><span data-stu-id="8107a-299">This caching is often unnecessary in a web application because context instances are typically short-lived (a new one is created and disposed for each request) and the context that reads an entity is typically disposed before that entity is used again.</span></span>

<span data-ttu-id="8107a-300">`AsNoTracking` Yöntemi çağırarak bellekteki varlık nesnelerinin izlemeyi devre dışı kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="8107a-300">You can disable tracking of entity objects in memory by calling the `AsNoTracking` method.</span></span> <span data-ttu-id="8107a-301">Yapmak isteyebileceğin tipik senaryolar şunlardır:</span><span class="sxs-lookup"><span data-stu-id="8107a-301">Typical scenarios in which you might want to do that include the following:</span></span>

* <span data-ttu-id="8107a-302">Bağlam ömrü boyunca herhangi bir varlığı güncelleştirmeniz gerekmez ve gezinti özelliklerini [ayrı sorgular tarafından alınan varlıklarla otomatik olarak yüklemek](read-related-data.md)için EF'ye ihtiyacınız yoktur.</span><span class="sxs-lookup"><span data-stu-id="8107a-302">During the context lifetime you don't need to update any entities, and you don't need EF to [automatically load navigation properties with  entities retrieved by separate queries](read-related-data.md).</span></span> <span data-ttu-id="8107a-303">Bu koşullar genellikle bir denetleyicinin HttpGet eylem yöntemleriyle karşılanır.</span><span class="sxs-lookup"><span data-stu-id="8107a-303">Frequently these conditions are met in a controller's HttpGet action methods.</span></span>

* <span data-ttu-id="8107a-304">Büyük miktarda veri alan bir sorgu çalıştırıyorsunuz ve döndürülen verilerin yalnızca küçük bir bölümü güncelleştirildi.</span><span class="sxs-lookup"><span data-stu-id="8107a-304">You are running a query that retrieves a large volume of data, and only a small portion of the returned data will be updated.</span></span> <span data-ttu-id="8107a-305">Büyük sorgu için izlemeyi kapatmak ve daha sonra güncelleştirilmesi gereken birkaç varlık için bir sorgu çalıştırmak daha verimli olabilir.</span><span class="sxs-lookup"><span data-stu-id="8107a-305">It may be more efficient to turn off tracking for the large query, and run a query later for the few entities that need to be updated.</span></span>

* <span data-ttu-id="8107a-306">Bir varlığı güncelleştirmek için eklemek istiyorsunuz, ancak daha önce farklı bir amaç için aynı varlığı aldınız.</span><span class="sxs-lookup"><span data-stu-id="8107a-306">You want to attach an entity in order to update it, but earlier you retrieved the same entity for a different purpose.</span></span> <span data-ttu-id="8107a-307">Varlık zaten veritabanı bağlamı tarafından izleniyor olduğundan, değiştirmek istediğiniz varlığı ekemezsiniz.</span><span class="sxs-lookup"><span data-stu-id="8107a-307">Because the entity is already being tracked by the database context, you can't attach the entity that you want to change.</span></span> <span data-ttu-id="8107a-308">Bu durumu ele almak için `AsNoTracking` bir yolu önceki sorgu çağırmaktır.</span><span class="sxs-lookup"><span data-stu-id="8107a-308">One way to handle this situation is to call `AsNoTracking` on the earlier query.</span></span>

<span data-ttu-id="8107a-309">Daha fazla bilgi için izleme [ve İzleme Yok'](/ef/core/querying/tracking)a bakın.</span><span class="sxs-lookup"><span data-stu-id="8107a-309">For more information, see [Tracking vs. No-Tracking](/ef/core/querying/tracking).</span></span>

## <a name="get-the-code"></a><span data-ttu-id="8107a-310">Kodu alma</span><span class="sxs-lookup"><span data-stu-id="8107a-310">Get the code</span></span>

[<span data-ttu-id="8107a-311">Tamamlanan uygulamayı karşıdan yükleyin veya görüntüleyin.</span><span class="sxs-lookup"><span data-stu-id="8107a-311">Download or view the completed application.</span></span>](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/data/ef-mvc/intro/samples/cu-final)

## <a name="next-steps"></a><span data-ttu-id="8107a-312">Sonraki adımlar</span><span class="sxs-lookup"><span data-stu-id="8107a-312">Next steps</span></span>

<span data-ttu-id="8107a-313">Bu öğreticide şunları yaptınız:</span><span class="sxs-lookup"><span data-stu-id="8107a-313">In this tutorial, you:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="8107a-314">Ayrıntılar sayfasını özelleştirmiş</span><span class="sxs-lookup"><span data-stu-id="8107a-314">Customized the Details page</span></span>
> * <span data-ttu-id="8107a-315">Oluştur sayfasını güncelleştir</span><span class="sxs-lookup"><span data-stu-id="8107a-315">Updated the Create page</span></span>
> * <span data-ttu-id="8107a-316">Edit sayfasını güncelleştir</span><span class="sxs-lookup"><span data-stu-id="8107a-316">Updated the Edit page</span></span>
> * <span data-ttu-id="8107a-317">Sil sayfasını güncelleştir</span><span class="sxs-lookup"><span data-stu-id="8107a-317">Updated the Delete page</span></span>
> * <span data-ttu-id="8107a-318">Kapalı veritabanı bağlantıları</span><span class="sxs-lookup"><span data-stu-id="8107a-318">Closed database connections</span></span>

<span data-ttu-id="8107a-319">Sıralama, filtreleme ve sayfalama ekleyerek **Dizin** sayfasının işlevselliğini nasıl genişleteceklerini öğrenmek için bir sonraki öğreticiye geçin.</span><span class="sxs-lookup"><span data-stu-id="8107a-319">Advance to the next tutorial to learn how to expand the functionality of the **Index** page by adding sorting, filtering, and paging.</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="8107a-320">Sonraki: Sıralama, filtreleme ve sayfalama</span><span class="sxs-lookup"><span data-stu-id="8107a-320">Next: Sorting, filtering, and paging</span></span>](sort-filter-page.md)
