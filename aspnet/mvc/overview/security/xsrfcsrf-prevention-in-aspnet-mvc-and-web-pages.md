---
uid: mvc/overview/security/xsrfcsrf-prevention-in-aspnet-mvc-and-web-pages
title: ASP.NET MVC ve Web sayfaları XSRF/CSRF önleme | Microsoft Docs
author: Rick-Anderson
description: Siteler arası istek sahtekarlığı (XSRF veya CSRF olarak da bilinir), kötü amaçlı web sitesini Etkileşi yapabildiği etkileyebilir web barındırılan uygulamalara yönelik bir saldırı olduğunu...
ms.author: aspnetcontent
manager: wpickett
ms.date: 03/14/2013
ms.topic: article
ms.assetid: aadc5fa4-8215-4fc7-afd5-bcd2ef879728
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/security/xsrfcsrf-prevention-in-aspnet-mvc-and-web-pages
msc.type: authoredcontent
ms.openlocfilehash: 6cf30daa7ed966b11405cec715c5bc803b567249
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 04/10/2018
ms.locfileid: "28034002"
---
<a name="xsrfcsrf-prevention-in-aspnet-mvc-and-web-pages"></a><span data-ttu-id="958a5-103">ASP.NET MVC ve Web sayfaları XSRF/CSRF önleme</span><span class="sxs-lookup"><span data-stu-id="958a5-103">XSRF/CSRF Prevention in ASP.NET MVC and Web Pages</span></span>
====================
<span data-ttu-id="958a5-104">tarafından [Rick Anderson](https://github.com/Rick-Anderson)</span><span class="sxs-lookup"><span data-stu-id="958a5-104">by [Rick Anderson](https://github.com/Rick-Anderson)</span></span>

> <span data-ttu-id="958a5-105">Siteler arası istek sahtekarlığı (XSRF veya CSRF olarak da bilinir) kötü amaçlı web sitesini istemci tarayıcısına ve bu tarayıcı tarafından güvenilen bir web sitesi arasındaki etkileşim yapabildiği etkileyebilir web barındırılan uygulamalara yönelik bir saldırı olduğunu.</span><span class="sxs-lookup"><span data-stu-id="958a5-105">Cross-site request forgery (also known as XSRF or CSRF) is an attack against web-hosted applications whereby a malicious web site can influence the interaction between a client browser and a web site trusted by that browser.</span></span> <span data-ttu-id="958a5-106">Web tarayıcıları bir web sitesi için kimlik doğrulama belirteçleri her istek ile otomatik olarak gönderir çünkü bu saldırıların olası yapılır.</span><span class="sxs-lookup"><span data-stu-id="958a5-106">These attacks are made possible because web browsers will send authentication tokens automatically with every request to a web site.</span></span> <span data-ttu-id="958a5-107">Klasik ASP gibi bir kimlik doğrulama tanımlama bilgisini bir örneğidir. NET'in form kimlik doğrulaması bileti.</span><span class="sxs-lookup"><span data-stu-id="958a5-107">The canonical example is an authentication cookie, such as ASP.NET's Forms Authentication ticket.</span></span> <span data-ttu-id="958a5-108">Ancak, tüm kalıcı kimlik doğrulama mekanizması (örneğin, Windows kimlik doğrulaması, temel ve benzeri) kullanan web siteleri tarafından bu saldırıların hedeflenebilir.</span><span class="sxs-lookup"><span data-stu-id="958a5-108">However, web sites which use any persistent authentication mechanism (such as Windows Authentication, Basic, and so forth) can be targeted by these attacks.</span></span>
> 
> <span data-ttu-id="958a5-109">Bir kimlik avı saldırıdan XSRF saldırının farklıdır.</span><span class="sxs-lookup"><span data-stu-id="958a5-109">An XSRF attack is distinct from a phishing attack.</span></span> <span data-ttu-id="958a5-110">Kimlik avı saldırıları kurbanın müdahalesini gerektirir.</span><span class="sxs-lookup"><span data-stu-id="958a5-110">Phishing attacks require interaction from the victim.</span></span> <span data-ttu-id="958a5-111">Bir kimlik avı saldırısı zararlı bir web sitesini hedef web sitesi benzetimini yapacak ve kurbanın saldırgan için hassas bilgileri sağlayarak içine sizi kandırmalarına.</span><span class="sxs-lookup"><span data-stu-id="958a5-111">In a phishing attack, a malicious web site will mimic the target web site, and the victim is fooled into providing sensitive information to the attacker.</span></span> <span data-ttu-id="958a5-112">Bir XSRF saldırısında, genellikle bir etkileşim yoktur kurban gerekli.</span><span class="sxs-lookup"><span data-stu-id="958a5-112">In an XSRF attack, there is often no interaction necessary from the victim.</span></span> <span data-ttu-id="958a5-113">Bunun yerine, tüm ilgili tanımlama bilgilerini otomatik olarak hedef web sitesine göndermeye tarayıcının saldırgan bağlı.</span><span class="sxs-lookup"><span data-stu-id="958a5-113">Rather, the attacker is relying on the browser automatically sending all relevant cookies to the destination web site.</span></span>
> 
> <span data-ttu-id="958a5-114">Daha fazla bilgi için bkz: [açık Web uygulaması güvenlik projesi](https://www.owasp.org/index.php/Main_Page)(OWASP) [XSRF](https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)).</span><span class="sxs-lookup"><span data-stu-id="958a5-114">For more information, see the [Open Web Application Security Project](https://www.owasp.org/index.php/Main_Page)(OWASP) [XSRF](https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)).</span></span>


## <a name="anatomy-of-an-attack"></a><span data-ttu-id="958a5-115">Saldırının anatomisi</span><span class="sxs-lookup"><span data-stu-id="958a5-115">Anatomy of an attack</span></span>

<span data-ttu-id="958a5-116">XSRF saldırının yürütmek için bazı çevrimiçi bankacılık işlemler gerçekleştirmek isteyen bir kullanıcının göz önünde bulundurun.</span><span class="sxs-lookup"><span data-stu-id="958a5-116">To walk through an XSRF attack, consider a user who wants to perform some online banking transactions.</span></span> <span data-ttu-id="958a5-117">Bu kullanıcı ilk WoodgroveBank.com ve günlükleri, bu noktada yanıt üstbilgisi kendi kimlik doğrulama tanımlama bilgisi içerecektir ziyaret eder:</span><span class="sxs-lookup"><span data-stu-id="958a5-117">This user first visits WoodgroveBank.com and logs in, at which point the response header will contain her authentication cookie:</span></span>

[!code-console[Main](xsrfcsrf-prevention-in-aspnet-mvc-and-web-pages/samples/sample1.cmd)]

<span data-ttu-id="958a5-118">Kimlik doğrulama tanımlama bilgisini bir oturum tanımlama bilgisi olduğundan, tarayıcı işlemi çıktığında, otomatik olarak tarayıcı tarafından temizlenir.</span><span class="sxs-lookup"><span data-stu-id="958a5-118">Because the authentication cookie is a session cookie, it will be automatically cleared by the browser when the browser process exits.</span></span> <span data-ttu-id="958a5-119">Ancak, o zamana kadar tarayıcı otomatik olarak tanımlama bilgisi WoodgroveBank.com her istek ile içerecektir. Kullanıcı artık aynen bankacılık sitesinde form doldurur ve tarayıcı bu sunucuya istekte $1000 başka bir hesaba aktarmak istiyor:</span><span class="sxs-lookup"><span data-stu-id="958a5-119">However, until that time, the browser will automatically include the cookie with each request to WoodgroveBank.com. The user now wants to transfer $1000 to another account, so she fills out a form on the banking site, and the browser makes this request to the server:</span></span>

[!code-console[Main](xsrfcsrf-prevention-in-aspnet-mvc-and-web-pages/samples/sample2.cmd)]

<span data-ttu-id="958a5-120">Bu işlem bir yan etkisi (para bir işlem başlatır) olduğundan, bu işlemi başlatmak için bir HTTP POST gerektirecek şekilde bankacılık sitesi seçti.</span><span class="sxs-lookup"><span data-stu-id="958a5-120">Because this operation has a side effect (it initiates a monetary transaction), the banking site has chosen to require an HTTP POST in order to initiate this operation.</span></span> <span data-ttu-id="958a5-121">Sunucu kimlik doğrulama belirteci isteğini okur, geçerli kullanıcının hesap numarası görünüyor, fon mevcut ve hedef hesap harekete başlatır doğrular.</span><span class="sxs-lookup"><span data-stu-id="958a5-121">The server reads the authentication token from the request, looks up the current user's account number, verifies that sufficient funds exist, and then initiates the transaction into the destination account.</span></span>

<span data-ttu-id="958a5-122">Her çevrimiçi tam bankacılık, kullanıcı çıktığınızda bankacılık sitesi gider ve başka konumlara Web'de ziyaret eder.</span><span class="sxs-lookup"><span data-stu-id="958a5-122">Her online banking complete, the user navigates away from the banking site and visits other locations on the web.</span></span> <span data-ttu-id="958a5-123">İçinde katıştırılmış bir sayfada aşağıdaki biçimlendirme sitelere – fabrikam.com – birini içeren bir &lt;IFRAME&gt;:</span><span class="sxs-lookup"><span data-stu-id="958a5-123">One of those sites – fabrikam.com – includes the following markup on a page embedded within an &lt;iframe&gt;:</span></span>

[!code-html[Main](xsrfcsrf-prevention-in-aspnet-mvc-and-web-pages/samples/sample3.html)]

<span data-ttu-id="958a5-124">Daha sonra bu isteği yapmak tarayıcı neden olur:</span><span class="sxs-lookup"><span data-stu-id="958a5-124">Which then causes the browser to make this request:</span></span>

[!code-console[Main](xsrfcsrf-prevention-in-aspnet-mvc-and-web-pages/samples/sample4.cmd)]

<span data-ttu-id="958a5-125">Saldırgan, kullanıcı hedef web sitesi için geçerli bir kimlik doğrulama belirteci sahip ve kendisi bir HTTP POST hedef siteye otomatik olarak yapmak tarayıcı neden küçük parçacık JavaScript kullanıyorsa olgu kullanıyordur.</span><span class="sxs-lookup"><span data-stu-id="958a5-125">The attacker is exploiting the fact that the user might still have a valid authentication token for the target web site, and she is using a small snippet of Javascript to cause the browser to make an HTTP POST to the target site automatically.</span></span> <span data-ttu-id="958a5-126">Kimlik doğrulama belirteci hala geçerliyse, bankacılık sitesi $250 aktarımını saldırganın seçme hesaba başlatır.</span><span class="sxs-lookup"><span data-stu-id="958a5-126">If the authentication token is still valid, the banking site will initiate a transfer of $250 into the account of the attacker's choosing.</span></span>

### <a name="ineffective-mitigations"></a><span data-ttu-id="958a5-127">Etkisiz Azaltıcı Etkenler</span><span class="sxs-lookup"><span data-stu-id="958a5-127">Ineffective mitigations</span></span>

<span data-ttu-id="958a5-128">Yukarıdaki senaryoda WoodgroveBank.com SSL erişilen ve yalnızca SSL kimlik doğrulama tanımlama bilgisi içeriyor olgusu saldırı korunmanıza yetersiz olduğuna dikkat çekmek üzere ilginç olacaktır.</span><span class="sxs-lookup"><span data-stu-id="958a5-128">It is interesting to note that in the above scenario, the fact that WoodgroveBank.com was being accessed via SSL and had an SSL-only authentication cookie was insufficient to thwart the attack.</span></span> <span data-ttu-id="958a5-129">Saldırgan belirtin yapabiliyor [URI düzeni](http://en.wikipedia.org/wiki/URI_scheme) (https) içinde her &lt;form&gt; öğesi ve tarayıcı devam bu tanımlama bilgileri URI'sı ile tutarlı olduğu sürece, süresi dolmamış tanımlama bilgileri hedef siteye göndermek Hedef düzeni.</span><span class="sxs-lookup"><span data-stu-id="958a5-129">The attacker is able to specify the [URI scheme](http://en.wikipedia.org/wiki/URI_scheme) (https) in her &lt;form&gt; element, and the browser will continue to send unexpired cookies to the target site as long as those cookies are consistent with the URI scheme of the intended target.</span></span>

<span data-ttu-id="958a5-130">Bir kullanıcı yalnızca güvenilen siteler, yalnızca çevrimiçi güvenli kalmasına yardımcı ziyaret olarak güvenilmeyen siteleri ziyaret değil karşıdır.</span><span class="sxs-lookup"><span data-stu-id="958a5-130">One could argue that the user should simply not visit untrusted sites, as visiting only trusted sites is helps to remain safe online.</span></span> <span data-ttu-id="958a5-131">Bazı gerçekte bu yoktur, ancak ne yazık ki bu öneriler her zaman pratik olmaz.</span><span class="sxs-lookup"><span data-stu-id="958a5-131">There is some truth to this, but unfortunately this advice is not always practical.</span></span> <span data-ttu-id="958a5-132">Belki de kullanıcı "yerel haberleri site ConsolidatedMessenger güvenir".</span><span class="sxs-lookup"><span data-stu-id="958a5-132">Perhaps the user "trusts" the local news site ConsolidatedMessenger.</span></span> <span data-ttu-id="958a5-133">ConsolidatedMessenger.com ve bunun yerine site ziyaret edin, ancak bu siteye giden bir saldırganın aynı fabrikam.com üzerinde çalışan kod parçacığını eklemesine olanak tanıyan bir XSS Güvenlik açığı vardır.</span><span class="sxs-lookup"><span data-stu-id="958a5-133">ConsolidatedMessenger.com and goes to visit that site instead, but that site has an XSS vulnerability which allows an attacker to inject the same snippet of code that was running on fabrikam.com.</span></span>

<span data-ttu-id="958a5-134">Gelen istekleri sahip olduğunuzu doğrulayın bir [başvuran üstbilgi](http://www.w3.org/Protocols/HTTP/HTRQ_Headers.html#z14) etki alanınızın başvuruyor.</span><span class="sxs-lookup"><span data-stu-id="958a5-134">You can verify that incoming requests have a [Referer header](http://www.w3.org/Protocols/HTTP/HTRQ_Headers.html#z14) referencing your domain.</span></span> <span data-ttu-id="958a5-135">Bu, istemeden bir üçüncü taraf etki alanından gönderilen istekleri durdurur.</span><span class="sxs-lookup"><span data-stu-id="958a5-135">This will stop requests unwittingly submitted from a third-party domain.</span></span> <span data-ttu-id="958a5-136">Ancak, bazı kişiler gizlilikle ilgili nedenlerden dolayı tarayıcının başvuran üstbilgisi devre dışı bırakın ve belirli güvenli olmayan yazılımı yüklü kurbanın varsa, saldırganlar bu başlığı bazen taklit edebilir.</span><span class="sxs-lookup"><span data-stu-id="958a5-136">However, some people disable their browser's Referer header for privacy reasons, and attackers can sometimes spoof that header if the victim has certain insecure software installed.</span></span> <span data-ttu-id="958a5-137">Doğrulama [başvuran üstbilgi](http://www.w3.org/Protocols/HTTP/HTRQ_Headers.html#z14) XSRF saldırılarını önleme için güvenli bir yöntem olarak kabul edilmez.</span><span class="sxs-lookup"><span data-stu-id="958a5-137">Verifying the [Referer header](http://www.w3.org/Protocols/HTTP/HTRQ_Headers.html#z14) is not considered a secure approach to preventing XSRF attacks.</span></span>

## <a name="web-stack-runtime-xsrf-mitigations"></a><span data-ttu-id="958a5-138">Web yığını çalışma zamanı XSRF Azaltıcı Etkenler</span><span class="sxs-lookup"><span data-stu-id="958a5-138">Web Stack Runtime XSRF mitigations</span></span>

<span data-ttu-id="958a5-139">ASP.NET Web yığını çalışma zamanı bir türevi kullanır [Eşitleyici belirteci düzeni](https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)_Prevention_Cheat_Sheet#General_Recommendation:_Synchronizer_Token_Pattern) XSRF saldırılarına karşı korumak için.</span><span class="sxs-lookup"><span data-stu-id="958a5-139">The ASP.NET Web Stack Runtime uses a variant of the [synchronizer token pattern](https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)_Prevention_Cheat_Sheet#General_Recommendation:_Synchronizer_Token_Pattern) to defend against XSRF attacks.</span></span> <span data-ttu-id="958a5-140">Genel Eşitleyici belirteci düzeni iki anti-XSRF belirteci her HTTP POST (ek olarak kimlik doğrulama belirteci) sunucusuyla gönderilir biçimidir: olarak bir tanımlama bilgisi ve diğer form değer olarak bir belirteç.</span><span class="sxs-lookup"><span data-stu-id="958a5-140">The general form of the synchronizer token pattern is that two anti-XSRF tokens are submitted to the server with each HTTP POST (In addition to the authentication token): one token as a cookie, and the other as a form value.</span></span> <span data-ttu-id="958a5-141">ASP.NET çalışma zamanı tarafından oluşturulan belirteç değerleri belirleyici veya saldırgan tarafından tahmin edilebilir değil.</span><span class="sxs-lookup"><span data-stu-id="958a5-141">The token values generated by the ASP.NET runtime are not deterministic or predictable by an attacker.</span></span> <span data-ttu-id="958a5-142">Belirteçleri gönderildiğinde, sunucunun yalnızca her iki simge bir karşılaştırma denetimi başarılı olursa isteğin sağlayacaktır.</span><span class="sxs-lookup"><span data-stu-id="958a5-142">When the tokens are submitted, the server will allow the request to proceed only if both tokens pass a comparison check.</span></span>

<span data-ttu-id="958a5-143">XSRF istek doğrulaması *Oturum belirteci* bir HTTP tanımlama bilgisi olarak depolanır ve şu anda kendi yükte aşağıdaki bilgileri içerir:</span><span class="sxs-lookup"><span data-stu-id="958a5-143">The XSRF request verification *session token* is stored as an HTTP cookie and currently contains the following information in its payload:</span></span>

- <span data-ttu-id="958a5-144">Rastgele bir 128-bit tanıtıcısı oluşan bir güvenlik belirteci.</span><span class="sxs-lookup"><span data-stu-id="958a5-144">A security token, consisting of a random 128-bit identifier.</span></span>   
 <span data-ttu-id="958a5-145">Aşağıdaki resimde Internet Explorer F12 Geliştirici Araçları'ndaki görüntülenen XSRF istek doğrulama Oturum belirteci gösterilmiştir: (Bu geçerli uygulamasıdır ve konu Not değiştirmek bile olabilir.)</span><span class="sxs-lookup"><span data-stu-id="958a5-145">The following image shows the XSRF request verification session token displayed with the Internet Explorer F12 developer tools: (Note this is the current implementation and is subject, even likely, to change.)</span></span>

![](xsrfcsrf-prevention-in-aspnet-mvc-and-web-pages/_static/image1.png)

<span data-ttu-id="958a5-146">*Alan belirteci* olarak saklanan bir `<input type="hidden" />` ve kendi yükte aşağıdaki bilgileri içerir:</span><span class="sxs-lookup"><span data-stu-id="958a5-146">The *field token* is stored as an `<input type="hidden" />` and contains the following information in its payload:</span></span>

- <span data-ttu-id="958a5-147">Oturum açan kullanıcının kullanıcı adı (kimlik doğrulaması gerekiyorsa).</span><span class="sxs-lookup"><span data-stu-id="958a5-147">The logged-in user's username (if authenticated).</span></span>
- <span data-ttu-id="958a5-148">Tarafından sağlanan herhangi bir ek veriyi bir [IAntiForgeryAdditionalDataProvider](https://msdn.microsoft.com/library/system.web.helpers.iantiforgeryadditionaldataprovider(v=vs.111).aspx).</span><span class="sxs-lookup"><span data-stu-id="958a5-148">Any additional data provided by an [IAntiForgeryAdditionalDataProvider](https://msdn.microsoft.com/library/system.web.helpers.iantiforgeryadditionaldataprovider(v=vs.111).aspx).</span></span>

<span data-ttu-id="958a5-149">Anti-XSRF belirteçleri yükü şifrelenir ve imzalanmış belirteçleri incelemek için araçları kullanılırken kullanıcı adı görüntüleyemezsiniz şekilde.</span><span class="sxs-lookup"><span data-stu-id="958a5-149">The payloads of the anti-XSRF tokens are encrypted and signed, so you can't view the username when using tools to examine the tokens.</span></span> <span data-ttu-id="958a5-150">Web uygulamasını ASP.NET 4.0 hedeflerken Şifreleme Hizmetleri tarafından sağlanan [MachineKey.Encode](https://msdn.microsoft.com/library/system.web.security.machinekey.encode.aspx) yordamı.</span><span class="sxs-lookup"><span data-stu-id="958a5-150">When the web application is targeting ASP.NET 4.0, cryptographic services are provided by the [MachineKey.Encode](https://msdn.microsoft.com/library/system.web.security.machinekey.encode.aspx) routine.</span></span> <span data-ttu-id="958a5-151">Ne zaman web uygulamasını ASP.NET 4.5 hedefleme ya da daha yüksek, Şifreleme Hizmetleri tarafından sağlanan [MachineKey.Protect](https://msdn.microsoft.com/library/system.web.security.machinekey.protect(v=vs.110)) daha iyi performans, genişletilebilirlik ve güvenlik sunar yordamı.</span><span class="sxs-lookup"><span data-stu-id="958a5-151">When the web application is targeting ASP.NET 4.5 or higher, cryptographic services are provided by the [MachineKey.Protect](https://msdn.microsoft.com/library/system.web.security.machinekey.protect(v=vs.110)) routine, which offers better performance, extensibility, and security.</span></span> <span data-ttu-id="958a5-152">Daha fazla bilgi için şu blog yazılarını bakın:</span><span class="sxs-lookup"><span data-stu-id="958a5-152">See the following blog posts for more details:</span></span>

- [<span data-ttu-id="958a5-153">ASP.NET 4.5 şifreleme geliştirmeler, pt. 1</span><span class="sxs-lookup"><span data-stu-id="958a5-153">Cryptographic Improvements in ASP.NET 4.5, pt. 1</span></span>](https://blogs.msdn.com/b/webdev/archive/2012/10/22/cryptographic-improvements-in-asp-net-4-5-pt-1.aspx)
- [<span data-ttu-id="958a5-154">ASP.NET 4.5 şifreleme geliştirmeler, pt. 2</span><span class="sxs-lookup"><span data-stu-id="958a5-154">Cryptographic Improvements in ASP.NET 4.5, pt. 2</span></span>](https://blogs.msdn.com/b/webdev/archive/2012/10/23/cryptographic-improvements-in-asp-net-4-5-pt-2.aspx)
- [<span data-ttu-id="958a5-155">ASP.NET 4.5 şifreleme geliştirmeler, pt. 3</span><span class="sxs-lookup"><span data-stu-id="958a5-155">Cryptographic Improvements in ASP.NET 4.5, pt. 3</span></span>](https://blogs.msdn.com/b/webdev/archive/2012/10/24/cryptographic-improvements-in-asp-net-4-5-pt-3.aspx)

## <a name="generating-the-tokens"></a><span data-ttu-id="958a5-156">Belirteçler üreten</span><span class="sxs-lookup"><span data-stu-id="958a5-156">Generating the tokens</span></span>

<span data-ttu-id="958a5-157">Anti-XSRF belirteçleri oluşturmak için çağrı [ @Html.AntiForgeryToken ](https://msdn.microsoft.com/library/dd470175.aspx) MVC görünümü yönteminden veya @AntiForgery.GetHtmlRazor sayfasından ().</span><span class="sxs-lookup"><span data-stu-id="958a5-157">To generate the anti-XSRF tokens, call the [@Html.AntiForgeryToken](https://msdn.microsoft.com/library/dd470175.aspx) method from an MVC view or @AntiForgery.GetHtml() from a Razor page.</span></span> <span data-ttu-id="958a5-158">Çalışma zamanı, ardından aşağıdaki adımları gerçekleştirmeniz gerekmektedir:</span><span class="sxs-lookup"><span data-stu-id="958a5-158">The runtime will then perform the following steps:</span></span>

1. <span data-ttu-id="958a5-159">Geçerli HTTP isteği zaten bir anti-XSRF Oturum belirteci içeriyorsa (anti-XSRF tanımlama bilgisi \_ \_RequestVerificationToken), güvenlik belirteci şuradan ayıklanır.</span><span class="sxs-lookup"><span data-stu-id="958a5-159">If the current HTTP request already contains an anti-XSRF session token (the anti-XSRF cookie \_\_RequestVerificationToken), the security token is extracted from it.</span></span> <span data-ttu-id="958a5-160">HTTP isteği bir anti-XSRF Oturum belirteci içermiyorsa veya güvenlik belirteci ayıklama başarısız olursa, yeni bir rastgele anti-XSRF belirteci oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="958a5-160">If the HTTP request does not contain an anti-XSRF session token or if extraction of the security token fails, a new random anti-XSRF token will be generated.</span></span>
2. <span data-ttu-id="958a5-161">Anti-XSRF alan belirteci (1) Yukarıdaki adımı ve geçerli oturum açan kullanıcının kimliğini güvenlik belirteci kullanılarak oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="958a5-161">An anti-XSRF field token is generated using the security token from step (1) above and the identity of the current logged-in user.</span></span> <span data-ttu-id="958a5-162">(Kullanıcı kimliği belirleme hakkında daha fazla bilgi için bkz: **[özel desteğiyle senaryoları](#_Scenarios_with_special)** bölümüne bakın.) Ayrıca, varsa bir [IAntiForgeryAdditionalDataProvider](https://msdn.microsoft.com/library/jj158328(v=vs.111).aspx) olan yapılandırılmış, çalışma zamanı çağıracak kendi [GetAdditionalData](https://msdn.microsoft.com/library/system.web.helpers.iantiforgeryadditionaldataprovider.getadditionaldata(v=vs.111).aspx) yöntemi ve alan belirteci döndürülen dize içerir.</span><span class="sxs-lookup"><span data-stu-id="958a5-162">(For more information on determining user identity, see the **[Scenarios with special support](#_Scenarios_with_special)** section below.) Additionally, if an [IAntiForgeryAdditionalDataProvider](https://msdn.microsoft.com/library/jj158328(v=vs.111).aspx) is configured, the runtime will call its [GetAdditionalData](https://msdn.microsoft.com/library/system.web.helpers.iantiforgeryadditionaldataprovider.getadditionaldata(v=vs.111).aspx) method and include the returned string in the field token.</span></span> <span data-ttu-id="958a5-163">(Bkz **[yapılandırma ve genişletilebilirlik](#_Configuration_and_extensibility)** bölümü daha fazla bilgi için.)</span><span class="sxs-lookup"><span data-stu-id="958a5-163">(See the **[Configuration and extensibility](#_Configuration_and_extensibility)** section for more information.)</span></span>
3. <span data-ttu-id="958a5-164">Yeni bir anti-XSRF belirteci adım (1) oluşturulduysa, yeni oturum belirteci içermesi için oluşturulacak ve giden HTTP tanımlama bilgileri koleksiyonu eklenir.</span><span class="sxs-lookup"><span data-stu-id="958a5-164">If a new anti-XSRF token was generated in step (1), a new session token will be created to contain it and will be added to the outbound HTTP cookies collection.</span></span> <span data-ttu-id="958a5-165">(2) adımdan alan belirteci içinde kaydırılan bir `<input type="hidden" />` öğesi ve bu HTML biçimlendirmesi dönüş değerini olacak `Html.AntiForgeryToken()` veya `AntiForgery.GetHtml()`.</span><span class="sxs-lookup"><span data-stu-id="958a5-165">The field token from step (2) will be wrapped in an `<input type="hidden" />` element, and this HTML markup will be the return value of `Html.AntiForgeryToken()` or `AntiForgery.GetHtml()`.</span></span>

## <a name="validating-the-tokens"></a><span data-ttu-id="958a5-166">Belirteçleri doğrulanıyor</span><span class="sxs-lookup"><span data-stu-id="958a5-166">Validating the tokens</span></span>

<span data-ttu-id="958a5-167">Gelen anti-XSRF belirteçleri doğrulamak için geliştirici içeren bir [ValidateAntiForgeryToken](https://msdn.microsoft.com/library/system.web.mvc.validateantiforgerytokenattribute(VS.108).aspx) kendi MVC eylem veya denetleyici veya SEH çağrıları öznitelikte `@AntiForgery.Validate()` kendi Razor sayfasından.</span><span class="sxs-lookup"><span data-stu-id="958a5-167">To validate the incoming anti-XSRF tokens, the developer includes a [ValidateAntiForgeryToken](https://msdn.microsoft.com/library/system.web.mvc.validateantiforgerytokenattribute(VS.108).aspx) attribute on her MVC action or controller, or she calls `@AntiForgery.Validate()` from her Razor page.</span></span> <span data-ttu-id="958a5-168">Çalışma zamanı, aşağıdaki adımları gerçekleştirmeniz gerekmektedir:</span><span class="sxs-lookup"><span data-stu-id="958a5-168">The runtime will perform the following steps:</span></span>

1. <span data-ttu-id="958a5-169">Gelen oturum belirteci ve alan belirtecini okuyun ve anti-XSRF belirteci her birinden ayıklanır.</span><span class="sxs-lookup"><span data-stu-id="958a5-169">The incoming session token and field token are read and the anti-XSRF token extracted from each.</span></span> <span data-ttu-id="958a5-170">Anti-XSRF belirteçleri oluşturma yordamına (2) adımda başına aynı olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="958a5-170">The anti-XSRF tokens must be identical per step (2) in the generation routine.</span></span>
2. <span data-ttu-id="958a5-171">Geçerli kullanıcı kimlik doğrulaması gerekiyorsa, her kullanıcı adı alanı belirteçte depolanan kullanıcı adı ile karşılaştırılır.</span><span class="sxs-lookup"><span data-stu-id="958a5-171">If the current user is authenticated, her username is compared with the username stored in the field token.</span></span> <span data-ttu-id="958a5-172">Kullanıcı adları eşleşmelidir.</span><span class="sxs-lookup"><span data-stu-id="958a5-172">The usernames must match.</span></span>
3. <span data-ttu-id="958a5-173">Varsa bir [IAntiForgeryAdditionalDataProvider](https://msdn.microsoft.com/library/system.web.helpers.iantiforgeryadditionaldataprovider(v=vs.111).aspx) yapılandırılır, çalışma zamanı çağrıları kendi *ValidateAdditionalData* yöntemi.</span><span class="sxs-lookup"><span data-stu-id="958a5-173">If an [IAntiForgeryAdditionalDataProvider](https://msdn.microsoft.com/library/system.web.helpers.iantiforgeryadditionaldataprovider(v=vs.111).aspx) is configured, the runtime calls its *ValidateAdditionalData* method.</span></span> <span data-ttu-id="958a5-174">Yöntem Boolean değeri döndürmelidir *doğru*.</span><span class="sxs-lookup"><span data-stu-id="958a5-174">The method must return the Boolean value *true*.</span></span>

<span data-ttu-id="958a5-175">Doğrulama başarılı olursa, istek devam etmesine izin verilir.</span><span class="sxs-lookup"><span data-stu-id="958a5-175">If validation succeeds, the request is allowed to proceed.</span></span> <span data-ttu-id="958a5-176">Doğrulama başarısız olursa, framework özel durum oluşturacak bir *HttpAntiForgeryException*.</span><span class="sxs-lookup"><span data-stu-id="958a5-176">If validation fails, the framework will throw an *HttpAntiForgeryException*.</span></span>

## <a name="failure-conditions"></a><span data-ttu-id="958a5-177">Hata koşulları</span><span class="sxs-lookup"><span data-stu-id="958a5-177">Failure conditions</span></span>

<span data-ttu-id="958a5-178">Herhangi bir ASP.NET Web yığını çalışma zamanı v2 ile başlayan *HttpAntiForgeryException* sırasında oluşturulan doğrulama nelerin yanlış gittiğini hakkında ayrıntılı bilgi içerir.</span><span class="sxs-lookup"><span data-stu-id="958a5-178">Starting with The ASP.NET Web Stack Runtime v2, any *HttpAntiForgeryException* that is thrown during validation will contain detailed information about what went wrong.</span></span> <span data-ttu-id="958a5-179">Şu anda tanımlanmış hata koşulları şunlardır:</span><span class="sxs-lookup"><span data-stu-id="958a5-179">The currently defined failure conditions are:</span></span>

- <span data-ttu-id="958a5-180">Oturum belirteci veya form belirteci istekte mevcut değil.</span><span class="sxs-lookup"><span data-stu-id="958a5-180">The session token or form token is not present in the request.</span></span>
- <span data-ttu-id="958a5-181">Oturum belirteci ya da form simgesi okunamaz.</span><span class="sxs-lookup"><span data-stu-id="958a5-181">The session token or form token is unreadable.</span></span> <span data-ttu-id="958a5-182">ASP.NET Web yığını Runtime veya grubunu eşleşmeyen sürümlerini çalıştıran bir grubu Bunun en olası nedeni olan nerede &lt;machineKey&gt; Web.config öğesinde makineler arasında farklılık gösterir.</span><span class="sxs-lookup"><span data-stu-id="958a5-182">The most likely cause of this is a farm running mismatched versions of The ASP.NET Web Stack Runtime or a farm where the &lt;machineKey&gt; element in Web.config differs between machines.</span></span> <span data-ttu-id="958a5-183">Bu özel durum ya da anti-XSRF belirteci ile oynanmasını tarafından zorlamak için Fiddler gibi bir araç kullanın.</span><span class="sxs-lookup"><span data-stu-id="958a5-183">You can use a tool such as Fiddler to force this exception by tampering with either anti-XSRF token.</span></span>
- <span data-ttu-id="958a5-184">Oturum belirteci ve alan belirteci değiştirildi.</span><span class="sxs-lookup"><span data-stu-id="958a5-184">The session token and field token were swapped.</span></span>
- <span data-ttu-id="958a5-185">Oturum belirteci ve alan belirteci eşleşmeyen güvenlik belirteçleri içerir.</span><span class="sxs-lookup"><span data-stu-id="958a5-185">The session token and field token contain mismatched security tokens.</span></span>
- <span data-ttu-id="958a5-186">İçinde alan belirteci katıştırılmış kullanıcı adı, geçerli oturum açan kullanıcının kullanıcı adı eşleşmiyor.</span><span class="sxs-lookup"><span data-stu-id="958a5-186">The username embedded within the field token does not match the current logged-in user's username.</span></span>
- <span data-ttu-id="958a5-187">*[IAntiForgeryAdditionalDataProvider.ValidateAdditionalData](https://msdn.microsoft.com/library/system.web.helpers.iantiforgeryadditionaldataprovider.validateadditionaldata(v=vs.111).aspx)* döndürülen yöntemi *false*.</span><span class="sxs-lookup"><span data-stu-id="958a5-187">The *[IAntiForgeryAdditionalDataProvider.ValidateAdditionalData](https://msdn.microsoft.com/library/system.web.helpers.iantiforgeryadditionaldataprovider.validateadditionaldata(v=vs.111).aspx)* method returned *false*.</span></span>

<span data-ttu-id="958a5-188">Anti-XSRF özellikleri, ayrıca belirteci oluşturma veya doğrulama sırasında ek denetimi gerçekleştirebilir ve hataları bu denetimleri sırasında oluşturulan özel durumları neden olabilir.</span><span class="sxs-lookup"><span data-stu-id="958a5-188">The anti-XSRF facilities may also perform additional checking during token generation or validation, and failures during these checks may result in exceptions being thrown.</span></span> <span data-ttu-id="958a5-189">Bkz: [WIF / ACS / talep tabanlı kimlik doğrulaması](#_WIF_ACS) ve **[yapılandırma ve genişletilebilirlik](#_Configuration_and_extensibility)** bölümlerde daha fazla bilgi için.</span><span class="sxs-lookup"><span data-stu-id="958a5-189">See the [WIF / ACS / claims-based authentication](#_WIF_ACS) and **[Configuration and extensibility](#_Configuration_and_extensibility)** sections for more information.</span></span>

<a id="_Scenarios_with_special"></a>

## <a name="scenarios-with-special-support"></a><span data-ttu-id="958a5-190">Özel desteğiyle senaryoları</span><span class="sxs-lookup"><span data-stu-id="958a5-190">Scenarios with special support</span></span>

### <a name="anonymous-authentication"></a><span data-ttu-id="958a5-191">Anonim kimlik doğrulama</span><span class="sxs-lookup"><span data-stu-id="958a5-191">Anonymous authentication</span></span>

<span data-ttu-id="958a5-192">Burada "anonim" tanımlanmış bir kullanıcı olarak anonim kullanıcılar için özel destek anti-XSRF sistemini içeren nerede *IIdentity.IsAuthenticated* özelliği döndürür *false*.</span><span class="sxs-lookup"><span data-stu-id="958a5-192">The anti-XSRF system contains special support for anonymous users, where "anonymous" is defined as a user where the *IIdentity.IsAuthenticated* property returns *false*.</span></span> <span data-ttu-id="958a5-193">Senaryolar içerir (kullanıcının kimliği doğrulanır önce) oturum açma sayfası ve burada uygulamanın kullandığı bir mekanizma dışında özel kimlik doğrulama şemasını XSRF koruma sağlayan *IIdentity* kullanıcıları tanımlamak için.</span><span class="sxs-lookup"><span data-stu-id="958a5-193">Scenarios include providing XSRF protection to the login page (before the user is authenticated) and custom authentication schemes where the application uses a mechanism other than *IIdentity* to identify users.</span></span>

<span data-ttu-id="958a5-194">Bu senaryoları desteklemek için oturum ve alan belirteçleri bir 128-bit rastgele oluşturulan donuk tanımlayıcısı bir güvenlik belirteci tarafından katılan geri çağırma.</span><span class="sxs-lookup"><span data-stu-id="958a5-194">To support these scenarios, recall that the session and field tokens are joined by a security token, which is a 128-bit randomly-generated opaque identifier.</span></span> <span data-ttu-id="958a5-195">Bu güvenlik belirteci, etkili bir şekilde anonim bir tanımlayıcı amaca hizmet eder şekilde aynen site gider gibi tek bir kullanıcının oturumu izlemek için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="958a5-195">This security token is used to track an individual user's session as she navigates the site, so it effectively serves the purpose of an anonymous identifier.</span></span> <span data-ttu-id="958a5-196">Boş bir dize, yukarıda açıklanan oluşturma ve doğrulama yordamları için kullanıcı adı yerine kullanılır.</span><span class="sxs-lookup"><span data-stu-id="958a5-196">An empty string is used in place of the username for the generation and validation routines described above.</span></span>

<a id="_WIF_ACS"></a>

### <a name="wif--acs--claims-based-authentication"></a><span data-ttu-id="958a5-197">WIF / ACS / talep tabanlı kimlik doğrulaması</span><span class="sxs-lookup"><span data-stu-id="958a5-197">WIF / ACS / claims-based authentication</span></span>

<span data-ttu-id="958a5-198">Normalde, *IIdentity* .NET Framework yerleşik sınıfları özelliğe sahip, *IIdentity.Name* belirli bir kullanıcının belirli bir uygulama içinde benzersiz şekilde tanımlamak yeterlidir.</span><span class="sxs-lookup"><span data-stu-id="958a5-198">Normally, the *IIdentity* classes built in to the .NET Framework have the property that *IIdentity.Name* is sufficient to uniquely identify a particular user within a particular application.</span></span> <span data-ttu-id="958a5-199">Örneğin, *FormsIdentity.Name* (Bu, tüm uygulamalara bağlı olarak bu veritabanı için benzersiz olan) üyelik veritabanında depolanan kullanıcı adını döndürür *WindowsIdentity.Name* döndürür etki alanı tam kimliği kullanıcı ve benzeri.</span><span class="sxs-lookup"><span data-stu-id="958a5-199">For example, *FormsIdentity.Name* returns the username stored in the membership database (which is unique for all applications depending on that database), *WindowsIdentity.Name* returns the domain-qualified identity of the user, and so on.</span></span> <span data-ttu-id="958a5-200">Bu sistemler yalnızca kimlik doğrulaması sağlamak; Bunlar ayrıca *tanımlamak* kullanıcılara bir uygulama.</span><span class="sxs-lookup"><span data-stu-id="958a5-200">These systems provide not only authentication; they also *identify* users to an application.</span></span>

<span data-ttu-id="958a5-201">Talep tabanlı kimlik doğrulama, diğer yandan, mutlaka belirli bir kullanıcının tanımlama gerektirmez.</span><span class="sxs-lookup"><span data-stu-id="958a5-201">Claims-based authentication, on the other hand, does not necessarily require identifying a particular user.</span></span> <span data-ttu-id="958a5-202">Bunun yerine, *ClaimsPrincipal* ve *Claimsıdentity* türleri bir kümesiyle ilişkili *talep* örnekleri, burada bireysel talepler olabilir "yaşın 18 +" veya " Yönetici başka bir şey için olan".</span><span class="sxs-lookup"><span data-stu-id="958a5-202">Instead, the *ClaimsPrincipal* and *ClaimsIdentity* types are associated with a set of *Claim* instances, where the individual claims might be "is 18+ years of age" or "is an administrator" to anything else.</span></span> <span data-ttu-id="958a5-203">Kullanıcı mutlaka tanımlanan kurmadı olduğundan, çalışma zamanı kullanamazsınız *ClaimsIdentity.Name* özelliği bu kullanıcı için benzersiz bir tanımlayıcı olarak.</span><span class="sxs-lookup"><span data-stu-id="958a5-203">Since the user hasn't necessarily been identified, the runtime cannot use the *ClaimsIdentity.Name* property as a unique identifier for this particular user.</span></span> <span data-ttu-id="958a5-204">Takım gerçek örneklerde görüldüğü nerede *ClaimsIdentity.Name* döndürür *null*kolay (Görüntüle) adı döndürür veya aksi takdirde benzersiz bir tanımlayıcı olarak kullanmak için uygun olmayan bir dize döndürür kullanıcı için.</span><span class="sxs-lookup"><span data-stu-id="958a5-204">The team has seen real-world examples where *ClaimsIdentity.Name* returns *null*, returns a friendly (display) name, or otherwise returns a string that isn't appropriate for use as a unique identifier for the user.</span></span>

<span data-ttu-id="958a5-205">Talep tabanlı kimlik doğrulaması kullanan dağıtımlar çoğunu kullanarak [Azure erişim denetimi hizmeti](https://msdn.microsoft.com/library/windowsazure/gg429786.aspx) (ACS) özellikle.</span><span class="sxs-lookup"><span data-stu-id="958a5-205">Many of deployments which use claims-based authentication are using [Azure Access Control Service](https://msdn.microsoft.com/library/windowsazure/gg429786.aspx) (ACS) in particular.</span></span> <span data-ttu-id="958a5-206">ACS yapılandırmak Geliştirici tek tek verir *kimlik sağlayıcıları* (Microsoft Account sağlayıcısı, ADFS gibi Openıd sağlayıcılarının ister Yahoo!, vb.), ve kimlik sağlayıcılarını döndüren *tanımlayıcılarıadı*.</span><span class="sxs-lookup"><span data-stu-id="958a5-206">ACS allows the developer to configure individual *identity providers* (such as ADFS, the Microsoft Account provider, OpenID providers like Yahoo!, etc.), and the identity providers return *name identifiers*.</span></span> <span data-ttu-id="958a5-207">Bir özel kişisel tanımlayıcı (PPID gibi) anonim veya bu adı tanımlayıcılar bir e-posta adresi gibi kişisel bilgilerin (PII) içerebilir.</span><span class="sxs-lookup"><span data-stu-id="958a5-207">These name identifiers may contain Personally Identifiable Information (PII) like an email address, or they could be anonymized like a Private Personal Identifier (PPID).</span></span> <span data-ttu-id="958a5-208">ASP.NET Web yığını çalışma zamanı kullanıcı adı yerine yer alan tanımlama grubu oluştururken kullanabileceğiniz şekilde aynen site gözatması sırada ne olursa olsun, (Kimlik sağlayıcısı, ad tanımlayıcısı) tanımlama grubu yeterince belirli bir kullanıcı için bir uygun İzleme belirteci görevi görür ve Anti-XSRF alan belirteçleri doğrulanıyor.</span><span class="sxs-lookup"><span data-stu-id="958a5-208">Regardless, the tuple (identity provider, name identifier) sufficiently serves as an appropriate tracking token for a particular user while she is browsing the site, so the ASP.NET Web Stack Runtime can use the tuple in place of the username when generating and validating anti-XSRF field tokens.</span></span> <span data-ttu-id="958a5-209">Kimlik sağlayıcısı ve ad tanımlayıcısı için belirli URI'ler şunlardır:</span><span class="sxs-lookup"><span data-stu-id="958a5-209">The particular URIs for the identity provider and the name identifier are :</span></span>

- `http://schemas.microsoft.com/accesscontrolservice/2010/07/claims/identityprovider`
- `http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier`

<span data-ttu-id="958a5-210">(Bu bkz [ACS belge sayfası](https://msdn.microsoft.com/library/windowsazure/gg185971.aspx) daha fazla bilgi için.)</span><span class="sxs-lookup"><span data-stu-id="958a5-210">(see this [ACS doc page](https://msdn.microsoft.com/library/windowsazure/gg185971.aspx) for more info.)</span></span>

<span data-ttu-id="958a5-211">Oluşturulurken veya bir belirteci doğrulamak, ASP.NET Web yığını çalışma zamanı çalışma zamanında türleri bağlamayı deneyin:</span><span class="sxs-lookup"><span data-stu-id="958a5-211">When generating or validating a token, the ASP.NET Web Stack Runtime will at runtime try binding to the types:</span></span>

- <span data-ttu-id="958a5-212">`Microsoft.IdentityModel.Claims.IClaimsIdentity, Microsoft.IdentityModel, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35` (WIF SDK için.)</span><span class="sxs-lookup"><span data-stu-id="958a5-212">`Microsoft.IdentityModel.Claims.IClaimsIdentity, Microsoft.IdentityModel, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35` (For the WIF SDK.)</span></span>
- <span data-ttu-id="958a5-213">`System.Security.Claims.ClaimsIdentity` (İçin .NET 4.5).</span><span class="sxs-lookup"><span data-stu-id="958a5-213">`System.Security.Claims.ClaimsIdentity` (For .NET 4.5).</span></span>

<span data-ttu-id="958a5-214">Bu tür varsa ve geçerli kullanıcının *IIIIdentity* uygular veya alt sınıfların bunlardan birini türleri, anti-XSRF tesis kullanır (Kimlik sağlayıcısı, ad tanımlayıcısı) tanımlama grubu oluştururken kullanıcı adı yerine ve belirteçleri doğrulanıyor.</span><span class="sxs-lookup"><span data-stu-id="958a5-214">If these types exist, and if the current user's *IIIIdentity* implements or subclasses one of these types, the anti-XSRF facility will use the (identity provider, name identifier) tuple in place of the username when generating and validating the tokens.</span></span> <span data-ttu-id="958a5-215">Böyle bir tanımlama grubu mevcut değilse, istek geliştiriciye kullanımda belirli talep tabanlı kimlik doğrulama mekanizması anlamak için anti-XSRF sisteminin nasıl yapılandırılacağına açıklayan bir hata ile başarısız olur.</span><span class="sxs-lookup"><span data-stu-id="958a5-215">If no such tuple is present, the request will fail with an error describing to the developer how to configure the anti-XSRF system to understand the particular claims-based authentication mechanism in use.</span></span> <span data-ttu-id="958a5-216">Bkz: **[yapılandırma ve genişletilebilirlik](#_Configuration_and_extensibility)** daha fazla bilgi için bölüm.</span><span class="sxs-lookup"><span data-stu-id="958a5-216">See the **[Configuration and extensibility](#_Configuration_and_extensibility)** section for more information.</span></span>

### <a name="oauth--openid-authentication"></a><span data-ttu-id="958a5-217">OAuth / Openıd kimlik doğrulama</span><span class="sxs-lookup"><span data-stu-id="958a5-217">OAuth / OpenID authentication</span></span>

<span data-ttu-id="958a5-218">Son olarak, anti-XSRF tesis, OAuth veya Openıd kimlik doğrulama kullanan uygulamalar için özel desteğe sahiptir.</span><span class="sxs-lookup"><span data-stu-id="958a5-218">Finally, the anti-XSRF facility has special support for applications which use OAuth or OpenID authentication.</span></span> <span data-ttu-id="958a5-219">Bu Destek Tanı dayalıdır: varsa geçerli *IIdentity.Name* kullanıcıadı karşılaştırmaları bitti sonra http:// veya https://, ile başlayan varsayılan Ordinalıgnorecase karşılaştırıcı yerine bir sıra karşılaştırıcı.</span><span class="sxs-lookup"><span data-stu-id="958a5-219">This support is heuristic-based: if the current *IIdentity.Name* begins with http:// or https://, then username comparisons will be done using an Ordinal comparer rather than the default OrdinalIgnoreCase comparer.</span></span>

<a id="_Configuration_and_extensibility"></a>

## <a name="configuration-and-extensibility"></a><span data-ttu-id="958a5-220">Yapılandırma ve genişletilebilirlik</span><span class="sxs-lookup"><span data-stu-id="958a5-220">Configuration and extensibility</span></span>

<span data-ttu-id="958a5-221">Bazen, geliştiricilerin anti-XSRF oluşturma ve doğrulama davranışları üzerinde daha sıkı denetim isteyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="958a5-221">Occasionally, developers may want tighter control over the anti-XSRF generation and validation behaviors.</span></span> <span data-ttu-id="958a5-222">Örneğin, belki de yanıta HTTP tanımlama bilgilerini otomatik olarak ekleme MVC ve Web sayfaları Yardımcıları varsayılan istenmeyen bir davranıştır ve geliştirici belirteçleri başka bir yerde kalıcı hale getirmek isteyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="958a5-222">For example, perhaps the MVC and Web Pages helpers' default behavior of automatically adding HTTP cookies to the response is undesirable, and the developer may wish to persist the tokens elsewhere.</span></span> <span data-ttu-id="958a5-223">Bu konuda yardımcı olmak üzere iki API'leri mevcuttur:</span><span class="sxs-lookup"><span data-stu-id="958a5-223">There exist two APIs to assist with this:</span></span>

`AntiForgery.GetTokens(string oldCookieToken, out string newCookieToken, out string formToken);`  
`AntiForgery.Validate(string cookieToken, string formToken);`

<span data-ttu-id="958a5-224">*GetTokens* olarak yöntemi alır (boş olabilir) bir varolan XSRF istek doğrulama Oturum belirteci giriş ve üretir olarak çıkış yeni XSRF istek doğrulama Oturum belirteci ve alan belirteci.</span><span class="sxs-lookup"><span data-stu-id="958a5-224">The *GetTokens* method takes as input an existing XSRF request verification session token (which may be null) and produces as output a new XSRF request verification session token and field token.</span></span> <span data-ttu-id="958a5-225">Hiçbir decoration yalnızca donuk dizelerle belirteçleridir; *formToken* değeri örneği için değil Sarmalanan içinde bir &lt;giriş&gt; etiketi.</span><span class="sxs-lookup"><span data-stu-id="958a5-225">The tokens are simply opaque strings with no decoration; the *formToken* value will for instance not be wrapped in an &lt;input&gt; tag.</span></span> <span data-ttu-id="958a5-226">*NewCookieToken* değeri null; bu meydana gelirse, sonra *oldCookieToken* değeri hala geçerli ve yeni bir yanıt tanımlama bilgisi olarak ayarlanması.</span><span class="sxs-lookup"><span data-stu-id="958a5-226">The *newCookieToken* value may be null; if this occurs, then the *oldCookieToken* value is still valid and no new response cookie need be set.</span></span> <span data-ttu-id="958a5-227">Çağıranın *GetTokens* tüm gerekli yanıt tanımlama bilgilerini kalıcı yapma veya gerekli tüm biçimlendirme; oluşturmak için sorumlu *GetTokens* yöntemin kendisi değil yanıt olarak bir yan etkisi alter.</span><span class="sxs-lookup"><span data-stu-id="958a5-227">The caller of *GetTokens* is responsible for persisting any necessary response cookies or generating any necessary markup; the *GetTokens* method itself will not alter the response as a side effect.</span></span> <span data-ttu-id="958a5-228">*Doğrulama* yöntemi gelen oturum alır ve alan belirteçler ve bunları daha önce bahsedilen doğrulama mantığını çalıştırır.</span><span class="sxs-lookup"><span data-stu-id="958a5-228">The *Validate* method takes the incoming session and field tokens and runs the aforementioned validation logic over them.</span></span>

### <a name="antiforgeryconfig"></a><span data-ttu-id="958a5-229">AntiForgeryConfig</span><span class="sxs-lookup"><span data-stu-id="958a5-229">AntiForgeryConfig</span></span>

<span data-ttu-id="958a5-230">Geliştirici uygulama anti-XSRF sistemden yapılandırabilirsiniz\_başlatın.</span><span class="sxs-lookup"><span data-stu-id="958a5-230">The developer may configure the anti-XSRF system from Application\_Start.</span></span> <span data-ttu-id="958a5-231">Programsal yapılandırmadır.</span><span class="sxs-lookup"><span data-stu-id="958a5-231">Configuration is programmatic.</span></span> <span data-ttu-id="958a5-232">Statik özellikler *AntiForgeryConfig* türü aşağıda açıklanmıştır.</span><span class="sxs-lookup"><span data-stu-id="958a5-232">The properties of the static *AntiForgeryConfig* type are described below.</span></span> <span data-ttu-id="958a5-233">Talep kullanan çoğu kullanıcılar UniqueClaimTypeIdentifier özelliğini ayarlamak isteyeceksiniz.</span><span class="sxs-lookup"><span data-stu-id="958a5-233">Most users using claims will want to set the UniqueClaimTypeIdentifier property.</span></span>

| <span data-ttu-id="958a5-234">**Özelliği**</span><span class="sxs-lookup"><span data-stu-id="958a5-234">**Property**</span></span> | <span data-ttu-id="958a5-235">**Açıklama**</span><span class="sxs-lookup"><span data-stu-id="958a5-235">**Description**</span></span> |
| --- | --- |
| <span data-ttu-id="958a5-236">**AdditionalDataProvider**</span><span class="sxs-lookup"><span data-stu-id="958a5-236">**AdditionalDataProvider**</span></span> | <span data-ttu-id="958a5-237">Bir [IAntiForgeryAdditionalDataProvider](https://msdn.microsoft.com/library/system.web.helpers.iantiforgeryadditionaldataprovider(v=vs.111).aspx) belirteci oluşturma sırasında ek verileri sağlar ve belirteç doğrulama sırasında ek verileri kullanır.</span><span class="sxs-lookup"><span data-stu-id="958a5-237">An [IAntiForgeryAdditionalDataProvider](https://msdn.microsoft.com/library/system.web.helpers.iantiforgeryadditionaldataprovider(v=vs.111).aspx) that provides additional data during token generation and consumes additional data during token validation.</span></span> <span data-ttu-id="958a5-238">Varsayılan değer *null*.</span><span class="sxs-lookup"><span data-stu-id="958a5-238">The default value is *null*.</span></span> <span data-ttu-id="958a5-239">Daha fazla bilgi için bkz: [IAntiForgeryAdditionalDataProvider](https://msdn.microsoft.com/library/system.web.helpers.iantiforgeryadditionaldataprovider(v=vs.111).aspx) bölümü.</span><span class="sxs-lookup"><span data-stu-id="958a5-239">For more information, see the [IAntiForgeryAdditionalDataProvider](https://msdn.microsoft.com/library/system.web.helpers.iantiforgeryadditionaldataprovider(v=vs.111).aspx) section.</span></span> |
| <span data-ttu-id="958a5-240">**CookieName**</span><span class="sxs-lookup"><span data-stu-id="958a5-240">**CookieName**</span></span> | <span data-ttu-id="958a5-241">Anti-XSRF Oturum belirteci depolamak için kullanılan HTTP tanımlama bilgisinin adını sağlayan bir dize.</span><span class="sxs-lookup"><span data-stu-id="958a5-241">A string that provides the name of the HTTP cookie that is used to store the anti-XSRF session token.</span></span> <span data-ttu-id="958a5-242">Bu değer ayarlanmamışsa, bir ad uygulamanın dağıtılan sanal yola göre otomatik olarak oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="958a5-242">If this value is not set, a name will be automatically generated based on the application's deployed virtual path.</span></span> <span data-ttu-id="958a5-243">Varsayılan değer *null*.</span><span class="sxs-lookup"><span data-stu-id="958a5-243">The default value is *null*.</span></span> |
| <span data-ttu-id="958a5-244">**requireSsl**</span><span class="sxs-lookup"><span data-stu-id="958a5-244">**RequireSsl**</span></span> | <span data-ttu-id="958a5-245">Anti-XSRF belirteçleri SSL korumalı bir kanal üzerinden gönderilmesi gerekip gerekmediğini belirleyen bir Boole değeri.</span><span class="sxs-lookup"><span data-stu-id="958a5-245">A Boolean that dictates whether the anti-XSRF tokens are required to be submitted over an SSL-secured channel.</span></span> <span data-ttu-id="958a5-246">Bu değer ise *doğru*, hiçbir otomatik olarak oluşturulan tanımlama bilgisi "güvenli" bayrağı ayarlanmış sahip olur ve anti-XSRF API'leri SSL gönderilmeyen bir istek ve adlı varsa atar.</span><span class="sxs-lookup"><span data-stu-id="958a5-246">If this value is *true*, any automatically-generated cookies will have the "secure" flag set, and the anti-XSRF APIs will throw if called from within a request that is not submitted via SSL.</span></span> <span data-ttu-id="958a5-247">Varsayılan değer *false*.</span><span class="sxs-lookup"><span data-stu-id="958a5-247">The default value is *false*.</span></span> |
| <span data-ttu-id="958a5-248">**SuppressIdentityHeuristicChecks**</span><span class="sxs-lookup"><span data-stu-id="958a5-248">**SuppressIdentityHeuristicChecks**</span></span> | <span data-ttu-id="958a5-249">Anti-XSRF sistem beyana dayalı kimlikler için desteğini devre dışı bırakmanız gerekir olup olmadığını belirleyen bir Boole değeri.</span><span class="sxs-lookup"><span data-stu-id="958a5-249">A Boolean that dictates whether the anti-XSRF system should deactivate its support for claims-based identities.</span></span> <span data-ttu-id="958a5-250">Bu değer ise *true*, sistem varsayar *IIdentity.Name* kullanıcı başına benzersiz tanımlayıcısı olarak kullanım için uygundur ve özel durum denemez *IClaimsIdentity*veya *ClClaimsIdentity* açıklandığı gibi [WIF / ACS / talep tabanlı kimlik doğrulaması](#_WIF_ACS) bölümü.</span><span class="sxs-lookup"><span data-stu-id="958a5-250">If this value is *true*, the system will assume that *IIdentity.Name* is appropriate for use as a unique per-user identifier and will not try to special-case *IClaimsIdentity* or *ClClaimsIdentity* as described in the [WIF / ACS / claims-based authentication](#_WIF_ACS) section.</span></span> <span data-ttu-id="958a5-251">Varsayılan değer `false` şeklindedir.</span><span class="sxs-lookup"><span data-stu-id="958a5-251">The default value is `false`.</span></span> |
| <span data-ttu-id="958a5-252">**UniqueClaimTypeIdentifier**</span><span class="sxs-lookup"><span data-stu-id="958a5-252">**UniqueClaimTypeIdentifier**</span></span> | <span data-ttu-id="958a5-253">Hangi talep türü belirten bir dize, kullanıcı başına benzersiz tanımlayıcısı olarak kullanım için uygundur.</span><span class="sxs-lookup"><span data-stu-id="958a5-253">A string that indicates which claim type is appropriate for use as a unique per-user identifier.</span></span> <span data-ttu-id="958a5-254">Bu değer kümesi ve geçerli ise *IIdentity* tarafından talep tabanlı, sistem bir talep türü ayıklamak deneyecek belirtildiğinden *UniqueClaimTypeIdentifier*, ve karşılık gelen değer kullanılır alan belirteci oluştururken kullanıcının kullanıcı adı yerine.</span><span class="sxs-lookup"><span data-stu-id="958a5-254">If this value is set and the current *IIdentity* is claims-based, the system will attempt to extract a claim of the type specified by *UniqueClaimTypeIdentifier*, and the corresponding value will be used in place of the user's username when generating the field token.</span></span> <span data-ttu-id="958a5-255">Talep türü bulunamadı, sistem isteği başarısız olur.</span><span class="sxs-lookup"><span data-stu-id="958a5-255">If the claim type is not found, the system will fail the request.</span></span> <span data-ttu-id="958a5-256">Varsayılan değer *null*, belirten sistem kullanması gerektiğini (Kimlik sağlayıcısı, ad tanımlayıcısı) daha önce kullanıcının kullanıcı adı yerine açıklandığı gibi tanımlama grubu.</span><span class="sxs-lookup"><span data-stu-id="958a5-256">The default value is *null*, which indicates that the system should use the (identity provider, name identifier) tuple as previously described in place of the user's username.</span></span> |

<a id="_IAntiForgeryAdditionalDataProvider"></a>

### <a name="iantiforgeryadditionaldataprovider"></a><span data-ttu-id="958a5-257">IAntiForgeryAdditionalDataProvider</span><span class="sxs-lookup"><span data-stu-id="958a5-257">IAntiForgeryAdditionalDataProvider</span></span>

<span data-ttu-id="958a5-258">*[IAntiForgeryAdditionalDataProvider](https://msdn.microsoft.com/library/system.web.helpers.iantiforgeryadditionaldataprovider(v=vs.111).aspx)* türü her belirteci ek veriler gidiş tarafından anti-XSRF sistem davranışını genişletmek geliştiricilere sağlar.</span><span class="sxs-lookup"><span data-stu-id="958a5-258">The *[IAntiForgeryAdditionalDataProvider](https://msdn.microsoft.com/library/system.web.helpers.iantiforgeryadditionaldataprovider(v=vs.111).aspx)* type allows developers to extend the behavior of the anti-XSRF system by round-tripping additional data in each token.</span></span> <span data-ttu-id="958a5-259">*GetAdditionalData* yöntemi her çağrıldığında bir alan belirteci oluşturulur ve dönüş değeri içinde oluşturulan belirteç katıştırılır.</span><span class="sxs-lookup"><span data-stu-id="958a5-259">The *GetAdditionalData* method is called each time a field token is generated, and the return value is embedded within the generated token.</span></span> <span data-ttu-id="958a5-260">Bir uygulayan bir zaman damgası, nonce veya aynen istediği herhangi bir değer bu yönteminden döndürebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="958a5-260">An implementer could return a timestamp, a nonce, or any other value she wishes from this method.</span></span>

<span data-ttu-id="958a5-261">Benzer şekilde, *ValidateAdditionalData* yöntemi her çağrıldığında bir alan belirteci doğrulanır ve belirtecin içinde katıştırılan "ek verileri" dizesi yönteme geçirilen.</span><span class="sxs-lookup"><span data-stu-id="958a5-261">Similarly, the *ValidateAdditionalData* method is called each time a field token is validated, and the "additional data" string that was embedded within the token is passed to the method.</span></span> <span data-ttu-id="958a5-262">(Geçerli saati belirteç oluşturulduğunda depolanan zaman karşı denetleyerek) zaman aşımı doğrulama yordamını uygulamak, yordamın veya diğer denetimi nonce mantığı istenen.</span><span class="sxs-lookup"><span data-stu-id="958a5-262">The validation routine could implement a timeout (by checking the current time against the time that was stored when the token was created), a nonce checking routine, or any other desired logic.</span></span>

## <a name="design-decisions-and-security-considerations"></a><span data-ttu-id="958a5-263">Tasarım kararlarına ve güvenlik konuları</span><span class="sxs-lookup"><span data-stu-id="958a5-263">Design decisions and security considerations</span></span>

<span data-ttu-id="958a5-264">Oturum ve alan belirteçleri bağlantılar güvenlik belirteci teknik olarak yalnızca Anonim / kimliği doğrulanmamış kullanıcıları XSRF saldırılarına karşı korumak çalışırken gereklidir.</span><span class="sxs-lookup"><span data-stu-id="958a5-264">The security token that links the session and field tokens is technically only necessary when trying to protect anonymous / unauthenticated users against XSRF attacks.</span></span> <span data-ttu-id="958a5-265">Kullanıcının kimliği doğrulandığında, kimlik doğrulama belirteci kendisini (büyük olasılıkla bir tanımlama bilgisi biçiminde gönderilen) olarak kullanılabilecek bir Eşitleyici yarısı belirteci çifti.</span><span class="sxs-lookup"><span data-stu-id="958a5-265">When the user is authenticated, the authentication token itself (presumably submitted in the form of a cookie) could be used as one half of a synchronizer token pair.</span></span> <span data-ttu-id="958a5-266">Ancak, kimliği doğrulanmamış kullanıcılar tarafından isabet oturum açma sayfaları korumak için geçerli senaryo vardır ve her zaman oluşturma ve kimliği doğrulanmış kullanıcılar için bile güvenlik belirteci doğrulama tarafından anti-XSRF mantığı daha basit yapıldı.</span><span class="sxs-lookup"><span data-stu-id="958a5-266">However, there are valid scenarios for protecting login pages hit by unauthenticated users, and the anti-XSRF logic was made simpler by always generating and validating the security token, even for authenticated users.</span></span> <span data-ttu-id="958a5-267">Bir alan belirteci herhangi bir zamanda ayarlama veya oturum belirteci ve bu da saldırganın üstesinden gelmek için başka bir hurdle olacaktır tahmin olarak bağlı olarak, bir saldırgan tarafından tehlikeye durumunda, ayrıca, bazı ek koruma sağlar.</span><span class="sxs-lookup"><span data-stu-id="958a5-267">It also does provide some additional protection in the event that a field token is ever compromised by an attacker, as setting or guessing the session token would be another hurdle for the attacker to overcome.</span></span>

<span data-ttu-id="958a5-268">Tek bir etki alanında birden çok uygulama barındırıldığında geliştiriciler dikkatli kullanmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="958a5-268">Developers should use caution when multiple applications are hosted in a single domain.</span></span> <span data-ttu-id="958a5-269">Örneğin, olsa bile *example1.cloudapp.net* ve *example2.cloudapp.net* farklı ana altındaki tüm konaklarda arasında örtük güven ilişkisi yoktur  *\*. cloudapp.net* etki alanı.</span><span class="sxs-lookup"><span data-stu-id="958a5-269">For example, even though *example1.cloudapp.net* and *example2.cloudapp.net* are different hosts, there is an implicit trust relationship between all hosts under the *\*.cloudapp.net* domain.</span></span> <span data-ttu-id="958a5-270">Bu örtük güven ilişkisi [potansiyel olarak güvenilmeyen ana birbirlerinin tanımlama bilgilerini etkileyen olanak tanır](http://stackoverflow.com/questions/9636857/how-can-asp-net-or-asp-net-mvc-be-protected-from-related-domain-cookie-attacks) (AJAX istekleri yöneten kaynak aynı ilkeleri mutlaka HTTP tanımlama bilgileri için geçerli değildir).</span><span class="sxs-lookup"><span data-stu-id="958a5-270">This implicit trust relationship [allows potentially untrusted hosts to affect each other's cookies](http://stackoverflow.com/questions/9636857/how-can-asp-net-or-asp-net-mvc-be-protected-from-related-domain-cookie-attacks) (the same-origin policies that govern AJAX requests do not necessarily apply to HTTP cookies).</span></span> <span data-ttu-id="958a5-271">Kötü amaçlı bir alt etki alanı oturum belirteci üzerine mümkün olsa bile, kullanıcı için geçerli bir alan belirteci oluşturamıyor gerçekleşmesi için kullanıcı adı alanı belirteci katıştırılır, ASP.NET Web yığını çalışma zamanı bazı azaltma sağlar.</span><span class="sxs-lookup"><span data-stu-id="958a5-271">The ASP.NET Web Stack Runtime provides some mitigation in that the username is embedded into the field token, so even if a malicious subdomain is able to overwrite a session token it will be unable to generate a valid field token for the user.</span></span> <span data-ttu-id="958a5-272">Ancak, bu tür bir ortamda barındırıldığında yerleşik anti-XSRF yordamlar hala oturumu ele geçirme veya oturum açma XSRF karşı korumaya olamaz.</span><span class="sxs-lookup"><span data-stu-id="958a5-272">However, when hosted in such an environment the built-in anti-XSRF routines still cannot defend against session hijacking or login XSRF.</span></span>

<span data-ttu-id="958a5-273">Anti-XSRF yordamları şu anda savunması değil [clickjacking öğesini](https://www.owasp.org/index.php/Clickjacking).</span><span class="sxs-lookup"><span data-stu-id="958a5-273">The anti-XSRF routines currently do not defend against [clickjacking](https://www.owasp.org/index.php/Clickjacking).</span></span> <span data-ttu-id="958a5-274">Kendilerini clickjacking öğesini karşı korumak istediğiniz uygulamaları kolayca bunu yapabilir bir X-Frame-Options göndererek: her yanıtı ile SAMEORIGIN üstbilgisi.</span><span class="sxs-lookup"><span data-stu-id="958a5-274">Applications that wish to defend themselves against clickjacking may easily do so by sending an X-Frame-Options: SAMEORIGIN header with each response.</span></span> <span data-ttu-id="958a5-275">Bu üst tüm yeni tarayıcılar tarafından desteklenir.</span><span class="sxs-lookup"><span data-stu-id="958a5-275">This header is supported by all recent browsers.</span></span> <span data-ttu-id="958a5-276">Daha fazla bilgi için bkz: [IE blog](https://blogs.msdn.com/b/ieinternals/archive/2010/03/30/combating-clickjacking-with-x-frame-options.aspx), [SDL blog](https://blogs.msdn.com/b/sdl/archive/2009/02/05/clickjacking-defense-in-ie8.aspx), ve [OWASP](https://www.owasp.org/index.php/Clickjacking).</span><span class="sxs-lookup"><span data-stu-id="958a5-276">For more information, see the [IE blog](https://blogs.msdn.com/b/ieinternals/archive/2010/03/30/combating-clickjacking-with-x-frame-options.aspx), the [SDL blog](https://blogs.msdn.com/b/sdl/archive/2009/02/05/clickjacking-defense-in-ie8.aspx), and [OWASP](https://www.owasp.org/index.php/Clickjacking).</span></span> <span data-ttu-id="958a5-277">ASP.NET Web yığını çalışma zamanı bazı gelecekteki sürüm yapma MVC olabilir ve uygulamaları otomatik olarak bu saldırıya karşı korunmaya Web sayfaları anti-XSRF Yardımcıları bu başlığı otomatik olarak ayarlayın.</span><span class="sxs-lookup"><span data-stu-id="958a5-277">The ASP.NET Web Stack Runtime may in some future release make the MVC and Web Pages anti-XSRF helpers automatically set this header so that applications are automatically protected against this attack.</span></span>

<span data-ttu-id="958a5-278">Web geliştiricileri kendi site XSS saldırılara açık olmadığından emin olmak devam etmelidir.</span><span class="sxs-lookup"><span data-stu-id="958a5-278">Web developers should continue to ensure that their site is not vulnerable to XSS attacks.</span></span> <span data-ttu-id="958a5-279">XSS saldırılarını çok güçlü ve başarılı yararlanma XSRF saldırılarına karşı ASP.NET Web yığını çalışma zamanı savunma da Böl.</span><span class="sxs-lookup"><span data-stu-id="958a5-279">XSS attacks are very powerful, and a successful exploit would also break the ASP.NET Web Stack Runtime defenses against XSRF attacks.</span></span>

## <a name="acknowledgment"></a><span data-ttu-id="958a5-280">Bildirim</span><span class="sxs-lookup"><span data-stu-id="958a5-280">Acknowledgment</span></span>

<span data-ttu-id="958a5-281">[@LeviBroderick](https://twitter.com/LeviBroderick), kimin yazdığı ASP.NET güvenlik kodu çoğunu bu bilgileri toplu.</span><span class="sxs-lookup"><span data-stu-id="958a5-281">[@LeviBroderick](https://twitter.com/LeviBroderick), who wrote much of the ASP.NET security code the bulk of this information.</span></span>
