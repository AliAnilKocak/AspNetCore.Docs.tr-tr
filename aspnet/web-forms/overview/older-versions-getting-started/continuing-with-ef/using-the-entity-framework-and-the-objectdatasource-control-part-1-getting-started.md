---
uid: web-forms/overview/older-versions-getting-started/continuing-with-ef/using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started
title: "Entity Framework 4.0 ve ObjectDataSource denetimi kullanarak, bölüm 1: Başlarken | Microsoft Docs"
author: tdykstra
description: "Bu öğretici seri ile çalışmaya başlama Entity Framework öğretici serisi tarafından oluşturulan Contoso University web uygulaması üzerinde oluşturur. Yo varsa..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 01/26/2011
ms.topic: article
ms.assetid: 244278c1-fec8-4255-8a8a-13bde491c4f5
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/continuing-with-ef/using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started
msc.type: authoredcontent
ms.openlocfilehash: 83fe815af9030aee10a5204718b00c79925e9126
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 01/24/2018
---
<a name="using-the-entity-framework-40-and-the-objectdatasource-control-part-1-getting-started"></a><span data-ttu-id="f5eb1-104">Entity Framework 4.0 ve ObjectDataSource denetimi kullanarak, bölüm 1: Başlarken</span><span class="sxs-lookup"><span data-stu-id="f5eb1-104">Using the Entity Framework 4.0 and the ObjectDataSource Control, Part 1: Getting Started</span></span>
====================
<span data-ttu-id="f5eb1-105">by [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="f5eb1-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="f5eb1-106">Bu öğretici seri tarafından oluşturulan Contoso University web uygulaması üzerinde derlemeler [Entity Framework 4.0 ile çalışmaya başlama](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) öğretici serisi.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-106">This tutorial series builds on the Contoso University web application that is created by the [Getting Started with the Entity Framework 4.0](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorial series.</span></span> <span data-ttu-id="f5eb1-107">Önceki öğreticileri tamamlanmadı, Bu öğretici için bir başlangıç noktası olarak yapabilecekleriniz [uygulamayı karşıdan](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) oluşturduğunuz.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-107">If you didn't complete the earlier tutorials, as a starting point for this tutorial you can [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) that you would have created.</span></span> <span data-ttu-id="f5eb1-108">Ayrıca [uygulamayı karşıdan](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) tam öğretici seri tarafından oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-108">You can also [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) that is created by the complete tutorial series.</span></span>
> 
> <span data-ttu-id="f5eb1-109">Contoso University örnek web uygulaması Entity Framework 4.0 ve Visual Studio 2010 kullanarak ASP.NET Web Forms uygulamalarının nasıl oluşturulacağını gösterir.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-109">The Contoso University sample web application demonstrates how to create ASP.NET Web Forms applications using the Entity Framework 4.0 and Visual Studio 2010.</span></span> <span data-ttu-id="f5eb1-110">Örnek uygulama kurgusal bir Contoso üniversite için bir Web sitesidir.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-110">The sample application is a website for a fictional Contoso University.</span></span> <span data-ttu-id="f5eb1-111">Öğrenci giriş, indirmelere oluşturma ve Eğitmen atamaları gibi işlevselliği içerir.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-111">It includes functionality such as student admission, course creation, and instructor assignments.</span></span>
> 
> <span data-ttu-id="f5eb1-112">Öğretici örnekler C# dilinde gösterir.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-112">The tutorial shows examples in C#.</span></span> <span data-ttu-id="f5eb1-113">[İndirilebilir örnek](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) hem C# ve Visual Basic kodu içerir.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-113">The [downloadable sample](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) contains code in both C# and Visual Basic.</span></span>
> 
> ## <a name="database-first"></a><span data-ttu-id="f5eb1-114">İlk veritabanı</span><span class="sxs-lookup"><span data-stu-id="f5eb1-114">Database First</span></span>
> 
> <span data-ttu-id="f5eb1-115">Entity Framework verilerle çalışma üç yolu vardır: *veritabanı ilk*, *Model First*, ve *Code First*.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-115">There are three ways you can work with data in the Entity Framework: *Database First*, *Model First*, and *Code First*.</span></span> <span data-ttu-id="f5eb1-116">Bu öğretici ilk veritabanı için ' dir.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-116">This tutorial is for Database First.</span></span> <span data-ttu-id="f5eb1-117">Senaryonuz için en uygun olanı seçmeniz konusunda bu iş akışları ve Kılavuzu arasındaki farklar hakkında bilgi için bkz: [Entity Framework geliştirme iş akışları](https://msdn.microsoft.com/library/ms178359.aspx#dbfmfcf).</span><span class="sxs-lookup"><span data-stu-id="f5eb1-117">For information about the differences between these workflows and guidance on how to choose the best one for your scenario, see [Entity Framework Development Workflows](https://msdn.microsoft.com/library/ms178359.aspx#dbfmfcf).</span></span>
> 
> ## <a name="web-forms"></a><span data-ttu-id="f5eb1-118">Web Forms</span><span class="sxs-lookup"><span data-stu-id="f5eb1-118">Web Forms</span></span>
> 
> <span data-ttu-id="f5eb1-119">Başlarken serisinin gibi Bu öğretici seri ASP.NET Web Forms modeli kullanır ve ASP.NET Web Forms Visual Studio ile çalışmaya nasıl bildiğiniz varsayar.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-119">Like the Getting Started series, this tutorial series uses the ASP.NET Web Forms model and assumes you know how to work with ASP.NET Web Forms in Visual Studio.</span></span> <span data-ttu-id="f5eb1-120">Görmüyorsanız [ASP.NET 4.5 Web formları ile çalışmaya başlama](../../getting-started/getting-started-with-aspnet-45-web-forms/introduction-and-overview.md).</span><span class="sxs-lookup"><span data-stu-id="f5eb1-120">If you don't, see [Getting Started with ASP.NET 4.5 Web Forms](../../getting-started/getting-started-with-aspnet-45-web-forms/introduction-and-overview.md).</span></span> <span data-ttu-id="f5eb1-121">ASP.NET MVC çerçevesi ile çalışmayı tercih ederseniz bkz [ASP.NET MVC kullanarak Entity Framework ile çalışmaya başlama](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="f5eb1-121">If you prefer to work with the ASP.NET MVC framework, see [Getting Started with the Entity Framework using ASP.NET MVC](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span></span>
> 
> ## <a name="software-versions"></a><span data-ttu-id="f5eb1-122">Yazılım sürümleri</span><span class="sxs-lookup"><span data-stu-id="f5eb1-122">Software versions</span></span>
> 
> | <span data-ttu-id="f5eb1-123">**Öğreticide gösterilen**</span><span class="sxs-lookup"><span data-stu-id="f5eb1-123">**Shown in the tutorial**</span></span> | <span data-ttu-id="f5eb1-124">**İle de çalışır**</span><span class="sxs-lookup"><span data-stu-id="f5eb1-124">**Also works with**</span></span> |
> | --- | --- |
> | <span data-ttu-id="f5eb1-125">Windows 7</span><span class="sxs-lookup"><span data-stu-id="f5eb1-125">Windows 7</span></span> | <span data-ttu-id="f5eb1-126">Windows 8</span><span class="sxs-lookup"><span data-stu-id="f5eb1-126">Windows 8</span></span> |
> | <span data-ttu-id="f5eb1-127">Visual Studio 2010</span><span class="sxs-lookup"><span data-stu-id="f5eb1-127">Visual Studio 2010</span></span> | <span data-ttu-id="f5eb1-128">Web için Visual Studio 2010 Express.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-128">Visual Studio 2010 Express for Web.</span></span> <span data-ttu-id="f5eb1-129">Öğreticinin sonraki sürümlerini Visual Studio test edilmemiştir.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-129">The tutorial has not been tested with later versions of Visual Studio.</span></span> <span data-ttu-id="f5eb1-130">Menü seçimleri, iletişim kutuları ve şablonları birçok farklılıklar vardır.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-130">There are many differences in menu selections, dialog boxes, and templates.</span></span> |
> | <span data-ttu-id="f5eb1-131">.NET 4</span><span class="sxs-lookup"><span data-stu-id="f5eb1-131">.NET 4</span></span> | <span data-ttu-id="f5eb1-132">.NET 4.5, .NET 4 geriye dönük olarak uyumludur, ancak öğreticinin .NET 4.5 ile test edilmemiştir.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-132">.NET 4.5 is backward compatible with .NET 4, but the tutorial has not been tested with .NET 4.5.</span></span> |
> | <span data-ttu-id="f5eb1-133">Entity Framework 4</span><span class="sxs-lookup"><span data-stu-id="f5eb1-133">Entity Framework 4</span></span> | <span data-ttu-id="f5eb1-134">Öğreticinin sonraki sürümlerini Entity Framework test edilmemiştir.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-134">The tutorial has not been tested with later versions of Entity Framework.</span></span> <span data-ttu-id="f5eb1-135">Entity Framework 5 ile başlayarak, varsayılan olarak EF kullanan `DbContext API` EF 4.1 ile sunulmuştur.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-135">Starting with Entity Framework 5, EF uses by default the `DbContext API` that was introduced with EF 4.1.</span></span> <span data-ttu-id="f5eb1-136">EntityDataSource denetimi kullanmak için tasarlanmış `ObjectContext` API.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-136">The EntityDataSource control was designed to use the `ObjectContext` API.</span></span> <span data-ttu-id="f5eb1-137">İle EntityDataSource kullanma hakkında bilgi için Denetim `DbContext` API, bkz: [bu blog gönderisine](https://blogs.msdn.com/b/webdev/archive/2012/09/13/how-to-use-the-entitydatasource-control-with-entity-framework-code-first.aspx).</span><span class="sxs-lookup"><span data-stu-id="f5eb1-137">For information about how to use the EntityDataSource control with the `DbContext` API, see [this blog post](https://blogs.msdn.com/b/webdev/archive/2012/09/13/how-to-use-the-entitydatasource-control-with-entity-framework-code-first.aspx).</span></span> |
> 
> ## <a name="questions"></a><span data-ttu-id="f5eb1-138">Sorular</span><span class="sxs-lookup"><span data-stu-id="f5eb1-138">Questions</span></span>
> 
> <span data-ttu-id="f5eb1-139">Öğretici için doğrudan ilgili olmayan sorularınız varsa, bunları nakledebilirsiniz [ASP.NET Entity Framework Forumu](https://forums.asp.net/1227.aspx), [Entity Framework ve LINQ to Entities Forumu](https://social.msdn.microsoft.com/forums/adodotnetentityframework/threads/), veya [ StackOverflow.com](http://stackoverflow.com/).</span><span class="sxs-lookup"><span data-stu-id="f5eb1-139">If you have questions that are not directly related to the tutorial, you can post them to the [ASP.NET Entity Framework forum](https://forums.asp.net/1227.aspx), the [Entity Framework and LINQ to Entities forum](https://social.msdn.microsoft.com/forums/adodotnetentityframework/threads/), or [StackOverflow.com](http://stackoverflow.com/).</span></span>


<span data-ttu-id="f5eb1-140">`EntityDataSource` Denetimi, bir uygulama çok hızlı bir şekilde oluşturmanızı sağlar, ancak genellikle iş mantığı ve veri erişimi mantığında önemli miktarda tutmanızı gerektirir, *.aspx* sayfaları.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-140">The `EntityDataSource` control enables you to create an application very quickly, but it typically requires you to keep a significant amount of business logic and data-access logic in your *.aspx* pages.</span></span> <span data-ttu-id="f5eb1-141">Uygulamanızı karmaşıklığı büyümeye ve devam eden bakım gerektirecek şekilde düşünüyorsanız, daha fazla geliştirme zamanı Önden oluşturmak için yatırım yapabilir bir *n katmanlı* veya *katmanlı* uygulama yapısı daha rahat olmasıdır.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-141">If you expect your application to grow in complexity and to require ongoing maintenance, you can invest more development time up front in order to create an *n-tier* or *layered* application structure that's more maintainable.</span></span> <span data-ttu-id="f5eb1-142">Bu mimarisi uygulama için sunu katmanı iş mantığı katmanı (BLL) ve veri erişim katmanı'nı (DAL) ayırın.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-142">To implement this architecture, you separate the presentation layer from the business logic layer (BLL) and the data access layer (DAL).</span></span> <span data-ttu-id="f5eb1-143">Bu yapı uygulamak için bir yolu `ObjectDataSource` yerine kontrol `EntityDataSource` denetim.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-143">One way to implement this structure is to use the `ObjectDataSource` control instead of the `EntityDataSource` control.</span></span> <span data-ttu-id="f5eb1-144">Kullandığınızda `ObjectDataSource` denetim, kendi veri erişimi kodunuzu uygulamak ve içinde çağırma *.aspx* birçok aynı olan bir denetimi kullanma sayfaları özellikleri diğer veri kaynağı denetimler.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-144">When you use the `ObjectDataSource` control, you implement your own data-access code and then invoke it in *.aspx* pages using a control that has many of the same features as other data-source controls.</span></span> <span data-ttu-id="f5eb1-145">Bu, veri erişimi için bir Web Forms denetimi kullanmanın avantajları n katmanlı yaklaşımın avantajları birleştirin sağlar.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-145">This lets you combine the advantages of an n-tier approach with the benefits of using a Web Forms control for data access.</span></span>

<span data-ttu-id="f5eb1-146">`ObjectDataSource` Denetimi size daha fazla esneklik diğer yollarla.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-146">The `ObjectDataSource` control gives you more flexibility in other ways as well.</span></span> <span data-ttu-id="f5eb1-147">Kendi veri erişimi kod yazmak için bu görevleri olduğu daha fazlasını okuyun, Ekle, Güncelleştir veya belirli bir varlık türünü silmek kolaydır, `EntityDataSource` denetimi gerçekleştirmek için tasarlanmıştır.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-147">Because you write your own data-access code, it's easier to do more than just read, insert, update, or delete a specific entity type, which are the tasks that the `EntityDataSource` control is designed to perform.</span></span> <span data-ttu-id="f5eb1-148">Örneğin, bir varlık her güncelleştirildiğinde günlüğü gerçekleştirmek, her bir varlık silinmiş veya otomatik onay ve güncelleştirme veri yabancı anahtar değerine sahip bir satır ekleme yaparken gerektiğinde ilgili verileri arşivlemek.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-148">For example, you can perform logging every time an entity is updated, archive data whenever an entity is deleted, or automatically check and update related data as needed when inserting a row with a foreign key value.</span></span>

## <a name="business-logic-and-repository-classes"></a><span data-ttu-id="f5eb1-149">İş mantığı ve depo sınıfları</span><span class="sxs-lookup"><span data-stu-id="f5eb1-149">Business Logic and Repository Classes</span></span>

<span data-ttu-id="f5eb1-150">Bir `ObjectDataSource` denetim works oluşturduğunuz bir sınıfı çağırarak.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-150">An `ObjectDataSource` control works by invoking a class that you create.</span></span> <span data-ttu-id="f5eb1-151">Sınıfı, almak ve veri güncelleştirme yöntemleri içerir ve bu yöntemlere adlarını sağlamanız `ObjectDataSource` denetiminde biçimlendirme.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-151">The class includes methods that retrieve and update data, and you provide the names of those methods to the `ObjectDataSource` control in markup.</span></span> <span data-ttu-id="f5eb1-152">İşleme veya geri gönderme işleme sırasında `ObjectDataSource` belirlediğiniz yöntemleri çağırır.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-152">During rendering or postback processing, the `ObjectDataSource` calls the methods that you've specified.</span></span>

<span data-ttu-id="f5eb1-153">Temel CRUD işlemleri, ile kullanmak için oluşturduğunuz sınıfı yanı sıra `ObjectDataSource` denetim iş mantığını yürütme gerekebilir zaman `ObjectDataSource` okur veya verileri güncelleştirir.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-153">Besides basic CRUD operations, the class that you create to use with the `ObjectDataSource` control might need to execute business logic when the `ObjectDataSource` reads or updates data.</span></span> <span data-ttu-id="f5eb1-154">Örneğin, bir departman güncelleştirdiğinizde, tek bir kişi birden fazla bölüm Yöneticisi olamayacağı için başka bir Departmanlar aynı yönetici sahip olduğunu doğrulayın gerekebilir.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-154">For example, when you update a department, you might need to validate that no other departments have the same administrator because one person cannot be administrator of more than one department.</span></span>

<span data-ttu-id="f5eb1-155">Bazı `ObjectDataSource` belgeleri gibi [ObjectDataSource sınıfına genel bakış](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.aspx), denetimi olarak adlandırılan bir sınıf çağıran bir *iş nesnesi* iş mantığı ve veri erişimi mantığı içerir .</span><span class="sxs-lookup"><span data-stu-id="f5eb1-155">In some `ObjectDataSource` documentation, such as the [ObjectDataSource Class overview](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.aspx), the control calls a class referred to as a *business object* that includes both business logic and data-access logic.</span></span> <span data-ttu-id="f5eb1-156">Bu öğreticide iş mantığı ve veri erişimi mantığı için ayrı sınıfları oluşturur.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-156">In this tutorial you will create separate classes for business logic and for data-access logic.</span></span> <span data-ttu-id="f5eb1-157">Veri erişimi mantığı yalıtır sınıfı olarak adlandırılan bir *depo*.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-157">The class that encapsulates data-access logic is called a *repository*.</span></span> <span data-ttu-id="f5eb1-158">İş mantığı sınıfı hem iş mantığı ve veri erişim yöntemleri içerir, ancak veri erişim görevleri gerçekleştirmek için depo veri erişim yöntemlerini çağırın.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-158">The business logic class includes both business-logic methods and data-access methods, but the data-access methods call the repository to perform data-access tasks.</span></span>

<span data-ttu-id="f5eb1-159">Ayrıca bir Soyutlama Katmanı BLL ve otomatikleştirilmiş birim kolaylaştıran DAL arasında oluşturulur BLL test etme.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-159">You will also create an abstraction layer between your BLL and DAL that facilitates automated unit testing of the BLL.</span></span> <span data-ttu-id="f5eb1-160">Bu Soyutlama Katmanı, bir arabirim oluşturma ve iş mantığı sınıfı depoya örneği olduğunda arabirimi kullanılarak uygulanır.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-160">This abstraction layer is implemented by creating an interface and using the interface when you instantiate the repository in the business-logic class.</span></span> <span data-ttu-id="f5eb1-161">Depo arabirimini uygulayan herhangi bir nesneye bir başvurusu olan iş mantığı sınıfı sağlamak mümkün kılar.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-161">This makes it possible for you to provide the business-logic class with a reference to any object that implements the repository interface.</span></span> <span data-ttu-id="f5eb1-162">Normal işlem için Entity Framework ile çalışan bir depo nesnesi sağlayın.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-162">For normal operation, you provide a repository object that works with the Entity Framework.</span></span> <span data-ttu-id="f5eb1-163">Test etmek için kolayca, koleksiyon olarak tanımlanan sınıf değişkenleri gibi işleyebileceğiniz şekilde depolanan verilerle çalışır bir depo nesnesi sağlayın.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-163">For testing, you provide a repository object that works with data stored in a way that you can easily manipulate, such as class variables defined as collections.</span></span>

<span data-ttu-id="f5eb1-164">Aşağıdaki çizimde bir depo olmadan veri erişimi mantığı içeren bir iş mantığı sınıf ve depo kullanan arasındaki farkı gösterir.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-164">The following illustration shows the difference between a business-logic class that includes data-access logic without a repository and one that uses a repository.</span></span>

<span data-ttu-id="f5eb1-165">[![Image05](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image2.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="f5eb1-165">[![Image05](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image2.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image1.png)</span></span>

<span data-ttu-id="f5eb1-166">Web sayfaları, oluşturarak başlar `ObjectDataSource` denetim, doğrudan bir depo bağlıysa, yalnızca temel veri erişim görevleri gerçekleştirdiğinden.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-166">You will begin by creating web pages in which the `ObjectDataSource` control is bound directly to a repository because it only performs basic data-access tasks.</span></span> <span data-ttu-id="f5eb1-167">Sonraki öğreticide Doğrulama mantığı ile bir iş mantığı sınıf oluşturacak ve bağlama `ObjectDataSource` depo sınıfını yerine o sınıfın denetimine.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-167">In the next tutorial you will create a business logic class with validation logic and bind the `ObjectDataSource` control to that class instead of to the repository class.</span></span> <span data-ttu-id="f5eb1-168">Doğrulama mantığı için birim testleri de oluşturur.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-168">You will also create unit tests for the validation logic.</span></span> <span data-ttu-id="f5eb1-169">Bu serideki üçüncü öğreticideki sıralama ve filtreleme uygulamaya işlevselliği ekleyeceksiniz.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-169">In the third tutorial in this series you will add sorting and filtering functionality to the application.</span></span>

<span data-ttu-id="f5eb1-170">Bu öğreticide oluşturduğunuz sayfaları çalışabilirsiniz `Departments` oluşturduğunuz veri modeli varlık kümesini [Başlarken Öğreticisi serisi](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md).</span><span class="sxs-lookup"><span data-stu-id="f5eb1-170">The pages you create in this tutorial work with the `Departments` entity set of the data model that you created in the [Getting Started tutorial series](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md).</span></span>

<span data-ttu-id="f5eb1-171">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image4.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="f5eb1-171">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image4.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image3.png)</span></span>

<span data-ttu-id="f5eb1-172">[![Image02](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image6.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="f5eb1-172">[![Image02](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image6.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image5.png)</span></span>

## <a name="updating-the-database-and-the-data-model"></a><span data-ttu-id="f5eb1-173">Veritabanı ve veri modelinin güncelleştiriliyor</span><span class="sxs-lookup"><span data-stu-id="f5eb1-173">Updating the Database and the Data Model</span></span>

<span data-ttu-id="f5eb1-174">Bu öğreticide oluşturduğunuz veri modeline karşılık gelen değişiklikleri her ikisi de gerektirir veritabanına iki değişiklik yaparak başlayacak [Web Forms ve Entity Framework ile çalışmaya başlama](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) öğreticileri.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-174">You will begin this tutorial by making two changes to the database, both of which require corresponding changes to the data model that you created in the [Getting Started with the Entity Framework and Web Forms](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorials.</span></span> <span data-ttu-id="f5eb1-175">Bu öğreticiler her birinde, veri modeli ile veritabanı bir veritabanı değişikliğinden sonra el ile eşitlemek için Tasarımcısı'nda değişiklikleri.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-175">In one of those tutorials, you made changes in the designer manually to synchronize the data model with the database after a database change.</span></span> <span data-ttu-id="f5eb1-176">Bu öğreticide tasarımcının kullanacağı **modeli veritabanından Güncelleştir** veri modeli otomatik olarak güncelleştirmek için aracı.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-176">In this tutorial, you will use the designer's **Update Model From Database** tool to update the data model automatically.</span></span>

### <a name="adding-a-relationship-to-the-database"></a><span data-ttu-id="f5eb1-177">Veritabanına ilişki ekleme</span><span class="sxs-lookup"><span data-stu-id="f5eb1-177">Adding a Relationship to the Database</span></span>

<span data-ttu-id="f5eb1-178">Oluşturduğunuz Contoso University web uygulamasını Visual Studio'da açın [Web Forms ve Entity Framework ile çalışmaya başlama](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) öğretici serisi ve ardından açın `SchoolDiagram` veritabanı diyagramı.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-178">In Visual Studio, open the Contoso University web application you created in the [Getting Started with the Entity Framework and Web Forms](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorial series, and then open the `SchoolDiagram` database diagram.</span></span>

<span data-ttu-id="f5eb1-179">Bakarsanız `Department` tablo veritabanında olduğunu görürsünüz bir `Administrator` sütun.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-179">If you look at the `Department` table in the database diagram, you will see that it has an `Administrator` column.</span></span> <span data-ttu-id="f5eb1-180">Bu sütun bir yabancı anahtar olan `Person` tablosu, ancak hiçbir yabancı anahtar ilişkisi veritabanında tanımlanır.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-180">This column is a foreign key to the `Person` table, but no foreign key relationship is defined in the database.</span></span> <span data-ttu-id="f5eb1-181">Bir ilişki oluşturmak ve böylece Entity Framework otomatik olarak bu ilişkiyi işleyebilir veri modeli güncelleştirmek gerekir.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-181">You need to create the relationship and update the data model so that the Entity Framework can automatically handle this relationship.</span></span>

<span data-ttu-id="f5eb1-182">Veritabanı diyagramı sağ `Department` tablo ve seçin **ilişkileri**.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-182">In the database diagram, right-click the `Department` table, and select **Relationships**.</span></span>

<span data-ttu-id="f5eb1-183">[![Image80](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image8.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="f5eb1-183">[![Image80](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image8.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image7.png)</span></span>

<span data-ttu-id="f5eb1-184">İçinde **yabancı anahtar ilişkilerini** kutusunda **Ekle**, ardından için üç nokta düğmesine **tablolar ve sütunlar belirtimi**.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-184">In the **Foreign Key Relationships** box click **Add**, then click the ellipsis for **Tables and Columns Specification**.</span></span>

<span data-ttu-id="f5eb1-185">[![Image81](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image10.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="f5eb1-185">[![Image81](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image10.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image9.png)</span></span>

<span data-ttu-id="f5eb1-186">İçinde **tablolar ve sütunlar** iletişim kutusunda, birincil anahtar tablosu ayarlayabilir ve alanı `Person` ve `PersonID`, yabancı anahtar tablosu ayarlayın ve alanı `Department` ve `Administrator`.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-186">In the **Tables and Columns** dialog box, set the primary key table and field to `Person` and `PersonID`, and set the foreign key table and field to `Department` and `Administrator`.</span></span> <span data-ttu-id="f5eb1-187">(Bunu yaptığınızda, ilişki adı değiştirilecek `FK_Department_Department` için `FK_Department_Person`.)</span><span class="sxs-lookup"><span data-stu-id="f5eb1-187">(When you do this, the relationship name will change from `FK_Department_Department` to `FK_Department_Person`.)</span></span>

<span data-ttu-id="f5eb1-188">[![Image82](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image12.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="f5eb1-188">[![Image82](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image12.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image11.png)</span></span>

<span data-ttu-id="f5eb1-189">Tıklatın **Tamam** içinde **tablolar ve sütunlar** kutusunda, **Kapat** içinde **yabancı anahtar ilişkilerini** kutusunda ve değişiklikleri kaydedin.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-189">Click **OK** in the **Tables and Columns** box, click **Close** in the **Foreign Key Relationships** box, and save the changes.</span></span> <span data-ttu-id="f5eb1-190">Kaydetmek isteyip istemediğiniz sorulursa `Person` ve `Department` tabloları, tıklatın **Evet**.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-190">If you're asked if you want to save the `Person` and `Department` tables, click **Yes**.</span></span>

> [!NOTE]
> <span data-ttu-id="f5eb1-191">Sildiğiniz varsa `Person` kullanılmakta olan verilere karşılık gelen satırları `Administrator` sütun, edemeyecek bu değişikliği kaydetmek.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-191">If you've deleted `Person` rows that correspond to data that's already in the `Administrator` column, you will not be able to save this change.</span></span> <span data-ttu-id="f5eb1-192">Bu durumda, tablo Düzenleyicisi'nde kullanmak **Sunucu Gezgini** emin olmak için `Administrator` değeri her `Department` satır gerçekten var bir kayıt Kimliğini içeren `Person` tablo.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-192">In that case, use the table editor in **Server Explorer** to make sure that the `Administrator` value in every `Department` row contains the ID of a record that actually exists in the `Person` table.</span></span>
> 
> <span data-ttu-id="f5eb1-193">Değişiklikleri kaydettikten sonra bir satırı silmek mümkün olmaz `Person` bu kişi bir bölüm yöneticisi ise tablo.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-193">After you save the change, you will not be able to delete a row from the `Person` table if that person is a department administrator.</span></span> <span data-ttu-id="f5eb1-194">Bir üretim uygulamasında, belirli bir hata iletisi silme işlemini bir veritabanı kısıtlaması engeller ya da bir art arda silme belirtirsiniz sağlar.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-194">In a production application, you would provide a specific error message when a database constraint prevents a deletion, or you would specify a cascading delete.</span></span> <span data-ttu-id="f5eb1-195">Art arda delete belirleme konusunda bir örnek için bkz: [Entity Framework ve ASP.NET – başlatılan Kısım 2 alma](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2.md).</span><span class="sxs-lookup"><span data-stu-id="f5eb1-195">For an example of how to specify a cascading delete, see [The Entity Framework and ASP.NET – Getting Started Part 2](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2.md).</span></span>


### <a name="adding-a-view-to-the-database"></a><span data-ttu-id="f5eb1-196">Veritabanına bir görünümü ekleme</span><span class="sxs-lookup"><span data-stu-id="f5eb1-196">Adding a View to the Database</span></span>

<span data-ttu-id="f5eb1-197">Yeni *Departments.aspx* , oluşturma sayfasında, istediğiniz kullanıcılar departman yöneticilerinin seçebilmeniz için "Soyadı" biçiminde adlara sahip eğitmen, aşağı açılan listesi temin etmek.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-197">In the new *Departments.aspx* page that you will be creating, you want to provide a drop-down list of instructors, with names in "last, first" format so that users can select department administrators.</span></span> <span data-ttu-id="f5eb1-198">Bunu yapmak daha kolay hale getirmek için veritabanında bir görünüm oluşturur.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-198">To make it easier to do that, you will create a view in the database.</span></span> <span data-ttu-id="f5eb1-199">Görünüm yalnızca aşağı açılan listeyi gereken verileri oluşur: (düzgün biçimlendirilmiş) tam adı ve kayıt anahtarı.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-199">The view will consist of just the data needed by the drop-down list: the full name (properly formatted) and the record key.</span></span>

<span data-ttu-id="f5eb1-200">İçinde **Sunucu Gezgini**, genişletin *School.mdf*, sağ tıklatın **görünümleri** klasörü ve select **Yeni Görünüm Ekle**.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-200">In **Server Explorer**, expand *School.mdf*, right-click the **Views** folder, and select **Add New View**.</span></span>

<span data-ttu-id="f5eb1-201">[![Image06](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image14.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="f5eb1-201">[![Image06](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image14.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image13.png)</span></span>

<span data-ttu-id="f5eb1-202">Tıklatın **Kapat** zaman **Tablo Ekle** iletişim kutusu belirir ve aşağıdaki SQL deyimini SQL bölmesine yapıştırın:</span><span class="sxs-lookup"><span data-stu-id="f5eb1-202">Click **Close** when the **Add Table** dialog box appears, and paste the following SQL statement into the SQL pane:</span></span>

[!code-sql[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample1.sql)]

<span data-ttu-id="f5eb1-203">Görünüm olarak kaydedebilirsiniz `vInstructorName`.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-203">Save the view as `vInstructorName`.</span></span>

### <a name="updating-the-data-model"></a><span data-ttu-id="f5eb1-204">Veri modeli güncelleştiriliyor</span><span class="sxs-lookup"><span data-stu-id="f5eb1-204">Updating the Data Model</span></span>

<span data-ttu-id="f5eb1-205">İçinde *DAL* klasörü, açık *SchoolModel.edmx* dosya, tasarım yüzeyine sağ tıklatın ve seçin **güncelleştirme modeli veritabanından**.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-205">In the *DAL* folder, open the *SchoolModel.edmx* file, right-click the design surface, and select **Update Model from Database**.</span></span>

<span data-ttu-id="f5eb1-206">[![Image07](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image16.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="f5eb1-206">[![Image07](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image16.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image15.png)</span></span>

<span data-ttu-id="f5eb1-207">İçinde **veritabanı nesnelerinizi** iletişim kutusunda **Ekle** sekmesinde ve yeni oluşturduğunuz görünümü seçin.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-207">In the **Choose Your Database Objects** dialog box, select the **Add** tab and select the view you just created.</span></span>

<span data-ttu-id="f5eb1-208">[![Image08](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image18.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="f5eb1-208">[![Image08](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image18.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image17.png)</span></span>

<span data-ttu-id="f5eb1-209">**Son**'a tıklayın.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-209">Click **Finish**.</span></span>

<span data-ttu-id="f5eb1-210">Aracı oluşturduğunuz bkz Tasarımcısı'nda bir `vInstructorName` varlık ve arasında yeni bir ilişki `Department` ve `Person` varlıklar.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-210">In the designer, you see that the tool created a `vInstructorName` entity and a new association between the `Department` and `Person` entities.</span></span>

<span data-ttu-id="f5eb1-211">[![Image13](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image20.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="f5eb1-211">[![Image13](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image20.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image19.png)</span></span>

> [!NOTE]
> <span data-ttu-id="f5eb1-212">İçinde **çıkış** ve **hata listesi** windows aracı birincil otomatik olarak oluşturulan bildiren bir uyarı iletisi görebileceği ve yeni anahtar `vInstructorName` görünümü.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-212">In the **Output** and **Error List** windows you might see a warning message informing you that the tool automatically created a primary key for the new `vInstructorName` view.</span></span> <span data-ttu-id="f5eb1-213">Bu beklenen bir davranıştır.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-213">This is expected behavior.</span></span>


<span data-ttu-id="f5eb1-214">Ne zaman, başvuran yeni `vInstructorName` varlık kodda istemediğiniz bir küçük harf "v" ona önek olarak veritabanı kuralı kullanmak.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-214">When you refer to the new `vInstructorName` entity in code, you don't want to use the database convention of prefixing a lower-case "v" to it.</span></span> <span data-ttu-id="f5eb1-215">Bu nedenle, varlık ve varlık kümesi modelde adlandırır.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-215">Therefore, you will rename the entity and entity set in the model.</span></span>

<span data-ttu-id="f5eb1-216">Açık **Model tarayıcı**.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-216">Open the **Model Browser**.</span></span> <span data-ttu-id="f5eb1-217">Gördüğünüz `vInstructorName` bir varlık türü ve bir görünüm listelenir.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-217">You see `vInstructorName` listed as an entity type and a view.</span></span>

<span data-ttu-id="f5eb1-218">[![Image14](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image22.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="f5eb1-218">[![Image14](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image22.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image21.png)</span></span>

<span data-ttu-id="f5eb1-219">Altında **SchoolModel** (değil **SchoolModel.Store**), sağ **vInstructorName** seçip **özellikleri**.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-219">Under **SchoolModel** (not **SchoolModel.Store**), right-click **vInstructorName** and select **Properties**.</span></span> <span data-ttu-id="f5eb1-220">İçinde **özellikleri** penceresinde, değişiklik **adı** özelliğini "InstructorName" ve değişiklik **varlık kümesi adı** "InstructorNames" özelliğine.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-220">In the **Properties** window, change the **Name** property to "InstructorName" and change the **Entity Set Name** property to "InstructorNames".</span></span>

<span data-ttu-id="f5eb1-221">[![Image15](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image24.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="f5eb1-221">[![Image15](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image24.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image23.png)</span></span>

<span data-ttu-id="f5eb1-222">Kaydet ve veri modelinin kapatın ve projeyi yeniden derleyin.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-222">Save and close the data model, and then rebuild the project.</span></span>

## <a name="using-a-repository-class-and-an-objectdatasource-control"></a><span data-ttu-id="f5eb1-223">Bir depo sınıfına ve ObjectDataSource Denetimi kullanma</span><span class="sxs-lookup"><span data-stu-id="f5eb1-223">Using a Repository Class and an ObjectDataSource Control</span></span>

<span data-ttu-id="f5eb1-224">Yeni bir sınıf dosyasını içinde oluşturmak *DAL* klasörü adlandırın *SchoolRepository.cs*ve var olan kodu aşağıdaki kodla değiştirin:</span><span class="sxs-lookup"><span data-stu-id="f5eb1-224">Create a new class file in the *DAL* folder, name it *SchoolRepository.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample2.cs)]

<span data-ttu-id="f5eb1-225">Bu kod tek bir sağlar `GetDepartments` tüm varlıkları döndürür yöntemi `Departments` varlık kümesi.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-225">This code provides a single `GetDepartments` method that returns all of the entities in the `Departments` entity set.</span></span> <span data-ttu-id="f5eb1-226">Erişecek olduğunu bildiğiniz için `Person` gezinti özelliği her satır için döndürülen, belirlediğiniz için bu özelliği kullanarak yükleme istekli `Include` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-226">Because you know that you will be accessing the `Person` navigation property for every row returned, you specify eager loading for that property by using the `Include` method.</span></span> <span data-ttu-id="f5eb1-227">Sınıf ayrıca uygulayan `IDisposable` nesne çıkarıldığından, veritabanı bağlantısını yayımlanan emin olmak için arabirim.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-227">The class also implements the `IDisposable` interface to ensure that the database connection is released when the object is disposed.</span></span>

> [!NOTE]
> <span data-ttu-id="f5eb1-228">Her bir varlık türü için bir depo sınıfına oluşturmak yaygın bir uygulamadır.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-228">A common practice is to create a repository class for each entity type.</span></span> <span data-ttu-id="f5eb1-229">Bu öğreticide, bir depo sınıfına birden çok varlık türleri için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-229">In this tutorial, one repository class for multiple entity types is used.</span></span> <span data-ttu-id="f5eb1-230">Gönderilerde havuz deseni hakkında daha fazla bilgi için bkz: [Entity Framework ekibinin blog](https://blogs.msdn.com/b/adonet/archive/2009/06/16/using-repository-and-unit-of-work-patterns-with-entity-framework-4-0.aspx) ve [Julie Lerman'ın blogu](http://thedatafarm.com/blog/data-access/agile-ef4-repository-part-3-fine-tuning-the-repository/).</span><span class="sxs-lookup"><span data-stu-id="f5eb1-230">For more information about the repository pattern, see the posts in [the Entity Framework team's blog](https://blogs.msdn.com/b/adonet/archive/2009/06/16/using-repository-and-unit-of-work-patterns-with-entity-framework-4-0.aspx) and [Julie Lerman's blog](http://thedatafarm.com/blog/data-access/agile-ef4-repository-part-3-fine-tuning-the-repository/).</span></span>


<span data-ttu-id="f5eb1-231">`GetDepartments` Yöntemi döndürür bir `IEnumerable` nesne yerine bir `IQueryable` bile deposu nesne kullanıldıktan sonra döndürülen koleksiyon kullanılabilir olduğundan emin olmak için nesne.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-231">The `GetDepartments` method returns an `IEnumerable` object rather than an `IQueryable` object in order to ensure that the returned collection is usable even after the repository object itself is disposed.</span></span> <span data-ttu-id="f5eb1-232">Bir `IQueryable` nesne erişilmeden ancak havuz nesne denetim çalışır verileri işlemek için zaman atıldı her veritabanı erişimi neden olabilir.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-232">An `IQueryable` object can cause database access whenever it's accessed, but the repository object might be disposed by the time a databound control attempts to render the data.</span></span> <span data-ttu-id="f5eb1-233">Başka bir koleksiyon türü gibi döndürebilirsiniz bir `IList` yerine Nesne bir `IEnumerable` nesnesi.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-233">You could return another collection type, such as an `IList` object instead of an `IEnumerable` object.</span></span> <span data-ttu-id="f5eb1-234">Ancak, döndüren bir `IEnumerable` nesne sağlar tipik salt okunur listede işleme görevlerini gibi gerçekleştirebilirsiniz `foreach` döngüler ve LINQ sorgularını ancak için ekleyemez veya bu değişiklikleri olacaktır kapsıyor koleksiyonunda öğeleri kaldırma veritabanına kalıcı.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-234">However, returning an `IEnumerable` object ensures that you can perform typical read-only list processing tasks such as `foreach` loops and LINQ queries, but you cannot add to or remove items in the collection, which might imply that such changes would be persisted to the database.</span></span>

<span data-ttu-id="f5eb1-235">Oluşturma bir *Departments.aspx* kullanan sayfasını *Site.Master* ana sayfa ve aşağıdaki biçimlendirmede ekleyin `Content` adlı Denetim `Content2`:</span><span class="sxs-lookup"><span data-stu-id="f5eb1-235">Create a *Departments.aspx* page that uses the *Site.Master* master page, and add the following markup in the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample3.aspx)]

<span data-ttu-id="f5eb1-236">Bu biçimlendirme oluşturur bir `ObjectDataSource` az önce oluşturduğunuz depo sınıfını kullanan denetim ve `GridView` verileri görüntülemek için denetim.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-236">This markup creates an `ObjectDataSource` control that uses the repository class you just created, and a `GridView` control to display the data.</span></span> <span data-ttu-id="f5eb1-237">`GridView` Denetim belirtir **Düzenle** ve **silmek** komutları, ancak henüz destekleyecek kodu eklenen henüz.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-237">The `GridView` control specifies **Edit** and **Delete** commands, but you haven't added code to support them yet.</span></span>

<span data-ttu-id="f5eb1-238">Birden fazla sütun kullan `DynamicField` , otomatik veri biçimlendirmeyi ve doğrulama işlevselliğinden yararlanabilmeniz denetler.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-238">Several columns use `DynamicField` controls so that you can take advantage of automatic data formatting and validation functionality.</span></span> <span data-ttu-id="f5eb1-239">Bunlar çalışmaya çağrı gerekecek `EnableDynamicData` yönteminde `Page_Init` olay işleyicisi.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-239">For these to work, you will have to call the `EnableDynamicData` method in the `Page_Init` event handler.</span></span> <span data-ttu-id="f5eb1-240">(`DynamicControl` içinde denetimleri kullanılmaz `Administrator` Gezinti özellikleriyle çalışmanıza yoktur çünkü alan.)</span><span class="sxs-lookup"><span data-stu-id="f5eb1-240">(`DynamicControl` controls are not used in the `Administrator` field because they don't work with navigation properties.)</span></span>

<span data-ttu-id="f5eb1-241">`Vertical-Align="Top"` Öznitelikleri olacak önemli daha sonra iç içe bir sahip bir sütunu eklediğinizde `GridView` denetimi kılavuza.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-241">The `Vertical-Align="Top"` attributes will become important later when you add a column that has a nested `GridView` control to the grid.</span></span>

<span data-ttu-id="f5eb1-242">Açık *Departments.aspx.cs* dosya ve aşağıdakileri ekleyin `using` deyimi:</span><span class="sxs-lookup"><span data-stu-id="f5eb1-242">Open the *Departments.aspx.cs* file and add the following `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample4.cs)]

<span data-ttu-id="f5eb1-243">Sayfanın aşağıdaki işleyicisi ekleme `Init` olay:</span><span class="sxs-lookup"><span data-stu-id="f5eb1-243">Then add the following handler for the page's `Init` event:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample5.cs)]

<span data-ttu-id="f5eb1-244">İçinde *DAL* klasörünü adlı yeni bir sınıf dosyası oluşturma *Department.cs* ve var olan kodu aşağıdaki kodla değiştirin:</span><span class="sxs-lookup"><span data-stu-id="f5eb1-244">In the *DAL* folder, create a new class file named *Department.cs* and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample6.cs)]

<span data-ttu-id="f5eb1-245">Bu kod meta verileri veri modeline ekler.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-245">This code adds metadata to the data model.</span></span> <span data-ttu-id="f5eb1-246">Gerektiğini belirtir `Budget` özelliği `Department` varlığı gerçekten temsil eden para birimi veri türüne olmasına rağmen `Decimal`, ve değeri 0 ile $1,000,000.00 arasında olması gerektiğini belirtir.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-246">It specifies that the `Budget` property of the `Department` entity actually represents currency although its data type is `Decimal`, and it specifies that the value must be between 0 and $1,000,000.00.</span></span> <span data-ttu-id="f5eb1-247">Ayrıca, belirtir `StartDate` özelliği bir tarih biçimini aa/gg/yyyy olarak biçimlendirilmelidir.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-247">It also specifies that the `StartDate` property should be formatted as a date in the format mm/dd/yyyy.</span></span>

<span data-ttu-id="f5eb1-248">Çalıştırma *Departments.aspx* sayfası.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-248">Run the *Departments.aspx* page.</span></span>

<span data-ttu-id="f5eb1-249">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image26.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="f5eb1-249">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image26.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image25.png)</span></span>

<span data-ttu-id="f5eb1-250">Bir biçim dizesi belirtmedi rağmen dikkat *Departments.aspx* için sayfası biçimlendirmesini **bütçe** veya **başlangıç tarihi** sütunları, varsayılan para birimi ve tarih Bunlar için biçimlendirme uygulanmış `DynamicField` denetimleri, içinde sağlanan meta verileri kullanarak *Department.cs* dosya.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-250">Notice that although you did not specify a format string in the *Departments.aspx* page markup for the **Budget** or **Start Date** columns, default currency and date formatting has been applied to them by the `DynamicField` controls, using the metadata that you supplied in the *Department.cs* file.</span></span>

## <a name="adding-insert-and-delete-functionality"></a><span data-ttu-id="f5eb1-251">Ekleme INSERT ve Delete işlevi</span><span class="sxs-lookup"><span data-stu-id="f5eb1-251">Adding Insert and Delete Functionality</span></span>

<span data-ttu-id="f5eb1-252">Açık *SchoolRepository.cs*, oluşturmak için aşağıdaki kodu ekleyin bir `Insert` yöntemi ve `Delete` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-252">Open *SchoolRepository.cs*, add the following code in order to create an `Insert` method and a `Delete` method.</span></span> <span data-ttu-id="f5eb1-253">Kod ayrıca adlı bir yöntem içerir `GenerateDepartmentID` sonraki kullanılabilir kayıt anahtarı değeri tarafından kullanılmak üzere hesaplar `Insert` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-253">The code also includes a method named `GenerateDepartmentID` that calculates the next available record key value for use by the `Insert` method.</span></span> <span data-ttu-id="f5eb1-254">Veritabanı bu için otomatik olarak hesaplamak için yapılandırılmadığı için bu gereklidir `Department` tablo.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-254">This is required because the database is not configured to calculate this automatically for the `Department` table.</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample7.cs)]

### <a name="the-attach-method"></a><span data-ttu-id="f5eb1-255">Attach yöntemi</span><span class="sxs-lookup"><span data-stu-id="f5eb1-255">The Attach Method</span></span>

<span data-ttu-id="f5eb1-256">`DeleteDepartment` Yöntem çağrılarını `Attach` korunur bağlantı varlığı bellekte ve veritabanı arasındaki nesne bağlamın nesne durum Yöneticisi'nde yeniden oluşturmak için yöntem satır onu temsil eder.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-256">The `DeleteDepartment` method calls the `Attach` method in order to re-establish the link that's maintained in the object context's object state manager between the entity in memory and the database row it represents.</span></span> <span data-ttu-id="f5eb1-257">Bu yöntem çağrılarını önce gelmelidir `SaveChanges` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-257">This must occur before the method calls the `SaveChanges` method.</span></span>

<span data-ttu-id="f5eb1-258">Terim *nesne bağlamı* türetilen Entity Framework sınıfına başvuruyor `ObjectContext` varlık kümeleri ve varlıkları erişmek için kullandığınız sınıfı.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-258">The term *object context* refers to the Entity Framework class that derives from the `ObjectContext` class that you use to access your entity sets and entities.</span></span> <span data-ttu-id="f5eb1-259">Bu proje için kodda adlı sınıfı `SchoolEntities`, ve bir örneği her zaman adlı `context`.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-259">In the code for this project, the class is named `SchoolEntities`, and an instance of it is always named `context`.</span></span> <span data-ttu-id="f5eb1-260">Nesne bağlamın *nesne durumu Yöneticisi* türeyen bir sınıf `ObjectStateManager` sınıfı.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-260">The object context's *object state manager* is a class that derives from the `ObjectStateManager` class.</span></span> <span data-ttu-id="f5eb1-261">Nesne kişi varlık nesneleri depolamak için ve her biri karşılık gelen bir tablo satırının veya veritabanındaki satırları eşit olup olmadığını izlemek için Nesne Durum Yöneticisi'ni kullanır.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-261">The object contact uses the object state manager to store entity objects and to keep track of whether each one is in sync with its corresponding table row or rows in the database.</span></span>

<span data-ttu-id="f5eb1-262">Bir varlık okurken nesne bağlamı nesnesi durum Yöneticisi'nde saklar ve o nesnenin gösterimi veritabanı ile eşit olup olmadığını izler.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-262">When you read an entity, the object context stores it in the object state manager and keeps track of whether that representation of the object is in sync with the database.</span></span> <span data-ttu-id="f5eb1-263">Örneğin, bir özellik değeri değiştirirseniz, değiştirdiğiniz özelliği artık veritabanı ile eşit olduğunu belirtmek için bir bayrak ayarlanır.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-263">For example, if you change a property value, a flag is set to indicate that the property you changed is no longer in sync with the database.</span></span> <span data-ttu-id="f5eb1-264">Çağırdığınızda sonra `SaveChanges` yöntemi, nesne bağlamına veritabanında nesne durumu Yöneticisi tam olarak ne varlık geçerli durumunu ve veritabanının durumu arasında farklı bildiği için yapmanız gerekenler bilir.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-264">Then when you call the `SaveChanges` method, the object context knows what to do in the database because the object state manager knows exactly what's different between the current state of the entity and the state of the database.</span></span>

<span data-ttu-id="f5eb1-265">Ancak, bir sayfa oluşturulduğunda, nesne durumu Yöneticisi'nde, her şeyi birlikte bir varlık okur nesne bağlamı örneği atıldı olmadığından bu işlem bir web uygulamasında genellikle çalışmaz.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-265">However, this process typically does not work in a web application, because the object context instance that reads an entity, along with everything in its object state manager, is disposed after a page is rendered.</span></span> <span data-ttu-id="f5eb1-266">Değişiklikleri uygulamanız gerekir nesne bağlamı geri gönderme işlenmek üzere örneği yeni bir örneğidir.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-266">The object context instance that must apply changes is a new one that's instantiated for postback processing.</span></span> <span data-ttu-id="f5eb1-267">Durumunda `DeleteDepartment` yöntemi, `ObjectDataSource` denetim yeniden oluşturur varlığın özgün sürümü sizin için değerleri görünümde durum, ancak bu yeniden oluşturulan `Department` varlık nesnesi durum Yöneticisi'nde mevcut değil.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-267">In the case of the `DeleteDepartment` method, the `ObjectDataSource` control re-creates the original version of the entity for you from values in view state, but this re-created `Department` entity does not exist in the object state manager.</span></span> <span data-ttu-id="f5eb1-268">Aradığınız varsa `DeleteObject` yöntemi bu yeniden oluşturulan varlığı çağrısı başarısız nesne bağlamı varlık veritabanı ile eşit olup olmadığını bilmediğinden olurdu.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-268">If you called the `DeleteObject` method on this re-created entity, the call would fail because the object context does not know whether the entity is in sync with the database.</span></span> <span data-ttu-id="f5eb1-269">Ancak, çağırma `Attach` yöntemi yeniden kurar yeniden oluşturulan varlığı ve değerleri arasında aynı izleme varlık bir nesne bağlamına önceki örnekte okurken başlangıçta otomatik olarak yapılıyordu veritabanında.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-269">However, calling the `Attach` method re-establishes the same tracking between the re-created entity and the values in the database that was originally done automatically when the entity was read in an earlier instance of the object context.</span></span>

<span data-ttu-id="f5eb1-270">Ne zaman nesne durumu Yöneticisi varlıklarda izlemek için nesne bağlamı istemediğiniz ve bayrakları, bunu önlemek için ayarlayabileceğiniz zamanları vardır.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-270">There are times when you don't want the object context to track entities in the object state manager, and you can set flags to prevent it from doing that.</span></span> <span data-ttu-id="f5eb1-271">Bu örnekler, bu serideki sonraki öğreticileri gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-271">Examples of this are shown in later tutorials in this series.</span></span>

### <a name="the-savechanges-method"></a><span data-ttu-id="f5eb1-272">SaveChanges yöntemi</span><span class="sxs-lookup"><span data-stu-id="f5eb1-272">The SaveChanges Method</span></span>

<span data-ttu-id="f5eb1-273">Bu basit havuz sınıf temel CRUD işlemleri gerçekleştirmek nasıl ilkeleri gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-273">This simple repository class illustrates basic principles of how to perform CRUD operations.</span></span> <span data-ttu-id="f5eb1-274">Bu örnekte, `SaveChanges` yöntemi her güncelleştirmeden hemen sonra çağrılır.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-274">In this example, the `SaveChanges` method is called immediately after each update.</span></span> <span data-ttu-id="f5eb1-275">Bir üretim uygulamasında çağrı isteyebilirsiniz `SaveChanges` veritabanı güncelleştirildiğinde üzerinde daha fazla denetim sağlamak için ayrı bir yöntem yönteminden.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-275">In a production application you might want to call the `SaveChanges` method from a separate method to give you more control over when the database is updated.</span></span> <span data-ttu-id="f5eb1-276">(Sonraki öğretici sonunda ilgili güncelleştirmeler Eşgüdümleme bir yaklaşım olan iş düzeni birim ele incelemeyi bağlantısını bulabilirsiniz.) Ayrıca örnek dikkat `DeleteDepartment` yöntemi eşzamanlılık çakışmalarını işleme için kodu içermez; bunun için kodu, bu serideki sonraki öğretici olarak eklenir.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-276">(At the end of the next tutorial you will find a link to a white paper that discusses the unit of work pattern which is one approach to coordinating related updates.) Notice also that in the example, the `DeleteDepartment` method does not include code for handling concurrency conflicts; code to do that will be added in a later tutorial in this series.</span></span>

### <a name="retrieving-instructor-names-to-select-when-inserting"></a><span data-ttu-id="f5eb1-277">Eklerken seçmek için Eğitmen adları alınıyor</span><span class="sxs-lookup"><span data-stu-id="f5eb1-277">Retrieving Instructor Names to Select When Inserting</span></span>

<span data-ttu-id="f5eb1-278">Yeni bölümler oluştururken bir açılan listedeki Eğitmen listesinden bir yönetici seçin olması gerekir.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-278">Users must be able to select an administrator from a list of instructors in a drop-down list when creating new departments.</span></span> <span data-ttu-id="f5eb1-279">Bu nedenle, aşağıdaki kodu ekleyin *SchoolRepository.cs* daha önce oluşturduğunuz görünümünü kullanarak Eğitmen listesini almak için bir yöntem oluşturmak için:</span><span class="sxs-lookup"><span data-stu-id="f5eb1-279">Therefore, add the following code to *SchoolRepository.cs* to create a method to retrieve the list of instructors using the view that you created earlier:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample8.cs)]

### <a name="creating-a-page-for-inserting-departments"></a><span data-ttu-id="f5eb1-280">Departmanlar eklemek için bir sayfa oluşturma</span><span class="sxs-lookup"><span data-stu-id="f5eb1-280">Creating a Page for Inserting Departments</span></span>

<span data-ttu-id="f5eb1-281">Oluşturma bir *DepartmentsAdd.aspx* kullanan sayfasını *Site.Master* sayfasında ve aşağıdaki biçimlendirmede eklemek `Content` adlı Denetim `Content2`:</span><span class="sxs-lookup"><span data-stu-id="f5eb1-281">Create a *DepartmentsAdd.aspx* page that uses the *Site.Master* page, and add the following markup in the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample9.aspx)]

<span data-ttu-id="f5eb1-282">Bu biçimlendirme iki oluşturur `ObjectDataSource` denetimleri, yeni eklemek için bir tane `Department` varlıkları ve Eğitmen adları almak için bir tane `DropDownList` departmanı Yöneticiler seçmek için kullanılan denetim.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-282">This markup creates two `ObjectDataSource` controls, one for inserting new `Department` entities and one for retrieving instructor names for the `DropDownList` control that's used for selecting department administrators.</span></span> <span data-ttu-id="f5eb1-283">Biçimlendirme oluşturur bir `DetailsView` yeni bölümler ve onu girme belirtir ve denetim için bir işleyici denetimi `ItemInserting` olay ayarlayabileceğiniz böylece `Administrator` yabancı anahtar değeri.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-283">The markup creates a `DetailsView` control for entering new departments, and it specifies a handler for the control's `ItemInserting` event so that you can set the `Administrator` foreign key value.</span></span> <span data-ttu-id="f5eb1-284">Sonunda olan bir `ValidationSummary` hata iletileri görüntülemek için denetimi.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-284">At the end is a `ValidationSummary` control to display error messages.</span></span>

<span data-ttu-id="f5eb1-285">Açık *DepartmentsAdd.aspx.cs* ve aşağıdakileri ekleyin `using` deyimi:</span><span class="sxs-lookup"><span data-stu-id="f5eb1-285">Open *DepartmentsAdd.aspx.cs* and add the following `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample10.cs)]

<span data-ttu-id="f5eb1-286">Aşağıdaki sınıf değişkeni ve yöntemleri ekleyin:</span><span class="sxs-lookup"><span data-stu-id="f5eb1-286">Add the following class variable and methods:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample11.cs)]

<span data-ttu-id="f5eb1-287">`Page_Init` Yöntemi dinamik veri işlevselliği sağlar.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-287">The `Page_Init` method enables Dynamic Data functionality.</span></span> <span data-ttu-id="f5eb1-288">İşleyicisi `DropDownList` denetimin `Init` olayı kaydeder denetim ve işleyicisi için bir başvuru `DetailsView` denetimin `Inserting` olayını almak için bu başvuru kullanır `PersonID` değeri seçili Eğitmen ve güncelleştirme `Administrator` yabancı anahtar özelliği `Department` varlık.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-288">The handler for the `DropDownList` control's `Init` event saves a reference to the control, and the handler for the `DetailsView` control's `Inserting` event uses that reference to get the `PersonID` value of the selected instructor and update the `Administrator` foreign key property of the `Department` entity.</span></span>

<span data-ttu-id="f5eb1-289">Sayfayı çalıştırın, yeni bir bölüm için bilgileri ekleyin ve ardından **Ekle** bağlantı.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-289">Run the page, add information for a new department, and then click the **Insert** link.</span></span>

<span data-ttu-id="f5eb1-290">[![Image04](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image28.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="f5eb1-290">[![Image04](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image28.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image27.png)</span></span>

<span data-ttu-id="f5eb1-291">Değerleri için başka bir yeni bölüm girin.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-291">Enter values for another new department.</span></span> <span data-ttu-id="f5eb1-292">İçinde 1,000,000.00'den büyük bir sayı girin **bütçe** alan ve sonraki alana sekmesi.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-292">Enter a number greater than 1,000,000.00 in the **Budget** field and tab to the next field.</span></span> <span data-ttu-id="f5eb1-293">Bir yıldız işareti alanında görüntülenir ve fare işaretçisini üzerine tutarsanız, bu alan için meta verilerde girdiğiniz hata iletisi görebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-293">An asterisk appears in the field, and if you hold the mouse pointer over it, you can see the error message that you entered in the metadata for that field.</span></span>

<span data-ttu-id="f5eb1-294">[![Image03](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image30.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="f5eb1-294">[![Image03](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image30.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image29.png)</span></span>

<span data-ttu-id="f5eb1-295">Tıklatın **Ekle**, ve tarafından görüntülenen hata iletisini görmek `ValidationSummary` sayfanın sonundaki denetim.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-295">Click **Insert**, and you see the error message displayed by the `ValidationSummary` control at the bottom of the page.</span></span>

<span data-ttu-id="f5eb1-296">[![Image12](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image32.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="f5eb1-296">[![Image12](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image32.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image31.png)</span></span>

<span data-ttu-id="f5eb1-297">Ardından, tarayıcıyı kapatıp açın *Departments.aspx* sayfası.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-297">Next, close the browser and open the *Departments.aspx* page.</span></span> <span data-ttu-id="f5eb1-298">Silme yeteneği eklemek *Departments.aspx* ekleyerek sayfa bir `DeleteMethod` özniteliğini `ObjectDataSource` denetimi ve `DataKeyNames` özniteliğini `GridView` denetim.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-298">Add delete capability to the *Departments.aspx* page by adding a `DeleteMethod` attribute to the `ObjectDataSource` control, and a `DataKeyNames` attribute to the `GridView` control.</span></span> <span data-ttu-id="f5eb1-299">Bu denetimler için açılış etiketler şimdi aşağıdaki örnekte benzeyecektir:</span><span class="sxs-lookup"><span data-stu-id="f5eb1-299">The opening tags for these controls will now resemble the following example:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample12.aspx)]

<span data-ttu-id="f5eb1-300">Sayfayı çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-300">Run the page.</span></span>

<span data-ttu-id="f5eb1-301">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image34.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="f5eb1-301">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image34.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image33.png)</span></span>

<span data-ttu-id="f5eb1-302">Çalıştırdığınızda eklediğiniz bölüm silme *DepartmentsAdd.aspx* sayfası.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-302">Delete the department you added when you ran the *DepartmentsAdd.aspx* page.</span></span>

## <a name="adding-update-functionality"></a><span data-ttu-id="f5eb1-303">Güncelleştirme işlevsellik ekleme</span><span class="sxs-lookup"><span data-stu-id="f5eb1-303">Adding Update Functionality</span></span>

<span data-ttu-id="f5eb1-304">Açık *SchoolRepository.cs* ve aşağıdakileri ekleyin `Update` yöntemi:</span><span class="sxs-lookup"><span data-stu-id="f5eb1-304">Open *SchoolRepository.cs* and add the following `Update` method:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample13.cs)]

<span data-ttu-id="f5eb1-305">Tıkladığınızda **güncelleştirme** içinde *Departments.aspx* sayfasında, `ObjectDataSource` denetimi oluşturur iki `Department` geçirilecek varlıklar `UpdateDepartment` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-305">When you click **Update** in the *Departments.aspx* page, the `ObjectDataSource` control creates two `Department` entities to pass to the `UpdateDepartment` method.</span></span> <span data-ttu-id="f5eb1-306">Görünüm durumuna depolanan özgün değerler içeriyor ve diğer içindeki girilen yeni değerleri içeren `GridView` denetim.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-306">One contains the original values that have been stored in view state, and the other contains the new values that were entered in the `GridView` control.</span></span> <span data-ttu-id="f5eb1-307">Kodda `UpdateDepartment` yöntemi geçişleri `Department` özgün değerlere sahip varlık `Attach` varlık arasındaki veritabanında nedir izleme oluşturmak için yöntem.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-307">The code in the `UpdateDepartment` method passes the `Department` entity that has the original values to the `Attach` method in order to establish the tracking between the entity and what's in the database.</span></span> <span data-ttu-id="f5eb1-308">Kod geçirmeden sonra `Department` yeni değerleri olan varlık `ApplyCurrentValues` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-308">Then the code passes the `Department` entity that has the new values to the `ApplyCurrentValues` method.</span></span> <span data-ttu-id="f5eb1-309">Nesne bağlamı eski ve yeni değerlerini karşılaştırır.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-309">The object context compares the old and new values.</span></span> <span data-ttu-id="f5eb1-310">Eski değerden yeni bir değer farklıysa, nesne bağlamına özellik değerini değiştirir.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-310">If a new value is different from an old value, the object context changes the property value.</span></span> <span data-ttu-id="f5eb1-311">`SaveChanges` Yöntemi ardından yalnızca değiştirilen sütun veritabanındaki güncelleştirir.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-311">The `SaveChanges` method then updates only the changed columns in the database.</span></span> <span data-ttu-id="f5eb1-312">(Güncelleştirme işlevi bu varlık için bir saklı yordam eşleştirilmiş, ancak tüm satır, bağımsız olarak sütunları değiştirilen güncelleştirilmesi.)</span><span class="sxs-lookup"><span data-stu-id="f5eb1-312">(However, if the update function for this entity were mapped to a stored procedure, the entire row would be updated regardless of which columns were changed.)</span></span>

<span data-ttu-id="f5eb1-313">Açık *Departments.aspx* dosya ve aşağıdaki öznitelikleri eklemek `DepartmentsObjectDataSource` denetimi:</span><span class="sxs-lookup"><span data-stu-id="f5eb1-313">Open the *Departments.aspx* file and add the following attributes to the `DepartmentsObjectDataSource` control:</span></span>

- `UpdateMethod="UpdateDepartment"`
- `ConflictDetection="CompareAllValues"`   
 <span data-ttu-id="f5eb1-314">Böylece yeni değerleri karşılaştırılabilir olması için bu nedenler eski değerleri görünümde durumu depolanan `Update` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-314">This causes old values to be stored in view state so that they can be compared with the new values in the `Update` method.</span></span>
- `OldValuesParameterFormatString="orig{0}"`   
 <span data-ttu-id="f5eb1-315">Bu özgün değer parametresi adı denetimi bildirir `origDepartment` .</span><span class="sxs-lookup"><span data-stu-id="f5eb1-315">This informs the control that the name of the original values parameter is `origDepartment` .</span></span>

<span data-ttu-id="f5eb1-316">Açılış etiketinde için biçimlendirme `ObjectDataSource` denetim şimdi aşağıdaki örnekte benzer:</span><span class="sxs-lookup"><span data-stu-id="f5eb1-316">The markup for the opening tag of the `ObjectDataSource` control now resembles the following example:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample14.aspx)]

<span data-ttu-id="f5eb1-317">Ekleme bir `OnRowUpdating="DepartmentsGridView_RowUpdating"` özniteliğini `GridView` denetim.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-317">Add an `OnRowUpdating="DepartmentsGridView_RowUpdating"` attribute to the `GridView` control.</span></span> <span data-ttu-id="f5eb1-318">Bunu ayarlamak için kullanacağınız `Administrator` kullanıcının seçtiği bir açılır liste satır temel özellik değeri.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-318">You will use this to set the `Administrator` property value based on the row the user selects in a drop-down list.</span></span> <span data-ttu-id="f5eb1-319">`GridView` Etiketi şimdi açma, aşağıdaki örnekte benzer:</span><span class="sxs-lookup"><span data-stu-id="f5eb1-319">The `GridView` opening tag now resembles the following example:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample15.aspx)]

<span data-ttu-id="f5eb1-320">Ekleme bir `EditItemTemplate` için Denetim `Administrator` sütuna `GridView` hemen sonra Denetim `ItemTemplate` denetimi bu sütun için:</span><span class="sxs-lookup"><span data-stu-id="f5eb1-320">Add an `EditItemTemplate` control for the `Administrator` column to the `GridView` control, immediately after the `ItemTemplate` control for that column:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample16.aspx)]

<span data-ttu-id="f5eb1-321">Bu `EditItemTemplate` denetim benzer `InsertItemTemplate` denetim *DepartmentsAdd.aspx* sayfası.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-321">This `EditItemTemplate` control is similar to the `InsertItemTemplate` control in the *DepartmentsAdd.aspx* page.</span></span> <span data-ttu-id="f5eb1-322">Denetimin ilk değeri kullanılarak ayarlanan farktır `SelectedValue` özniteliği.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-322">The difference is that the initial value of the control is set using the `SelectedValue` attribute.</span></span>

<span data-ttu-id="f5eb1-323">Önce `GridView` denetlemek, ekleme bir `ValidationSummary` denetlemek de yaptığınız gibi *DepartmentsAdd.aspx* sayfası.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-323">Before the `GridView` control, add a `ValidationSummary` control as you did in the *DepartmentsAdd.aspx* page.</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample17.aspx)]

<span data-ttu-id="f5eb1-324">Açık *Departments.aspx.cs* ve kısmi sınıf bildiriminden hemen sonra başvurmak için özel bir alan oluşturmak için aşağıdaki kodu ekleyin `DropDownList` denetimi:</span><span class="sxs-lookup"><span data-stu-id="f5eb1-324">Open *Departments.aspx.cs* and immediately after the partial-class declaration, add the following code to create a private field to reference the `DropDownList` control:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample18.cs)]

<span data-ttu-id="f5eb1-325">İşleyicileri eklemek `DropDownList` denetimin `Init` olay ve `GridView` denetimin `RowUpdating` olay:</span><span class="sxs-lookup"><span data-stu-id="f5eb1-325">Then add handlers for the `DropDownList` control's `Init` event and the `GridView` control's `RowUpdating` event:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample19.cs)]

<span data-ttu-id="f5eb1-326">İşleyicisi `Init` olayı kaydeder başvuru `DropDownList` sınıf alanı denetiminde.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-326">The handler for the `Init` event saves a reference to the `DropDownList` control in the class field.</span></span> <span data-ttu-id="f5eb1-327">İşleyicisi `RowUpdating` olay başvurusu kullanıcının girdiği değer almak ve uygulamak için kullandığı `Administrator` özelliği `Department` varlık.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-327">The handler for the `RowUpdating` event uses the reference to get the value the user entered and apply it to the `Administrator` property of the `Department` entity.</span></span>

<span data-ttu-id="f5eb1-328">Kullanım *DepartmentsAdd.aspx* yeni bir bölüm eklemek için sayfa, ardından Çalıştır *Departments.aspx* sayfasında ve tıklayın **Düzenle** eklediğiniz satırda.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-328">Use the *DepartmentsAdd.aspx* page to add a new department, then run the *Departments.aspx* page and click **Edit** on the row that you added.</span></span>

> [!NOTE]
> <span data-ttu-id="f5eb1-329">Eklemediğiniz satırları düzenlemeniz mümkün olmaz (diğer bir deyişle, olduğunu zaten veritabanında), veritabanındaki; geçersiz veriler nedeniyle veritabanı ile oluşturulmuş satırların Öğrenciler yöneticilerdir.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-329">You will not be able to edit rows that you did not add (that is, that were already in the database), because of invalid data in the database; the administrators for the rows that were created with the database are students.</span></span> <span data-ttu-id="f5eb1-330">Bunlardan birini düzenlemeye çalışırsanız, benzer bir hata raporları bir hata sayfası alırsınız`'InstructorsDropDownList' has a SelectedValue which is invalid because it does not exist in the list of items.`</span><span class="sxs-lookup"><span data-stu-id="f5eb1-330">If you try to edit one of them, you will get an error page that reports an error like `'InstructorsDropDownList' has a SelectedValue which is invalid because it does not exist in the list of items.`</span></span>


<span data-ttu-id="f5eb1-331">[![Image10](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image36.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="f5eb1-331">[![Image10](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image36.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image35.png)</span></span>

<span data-ttu-id="f5eb1-332">Geçersiz bir girerseniz **bütçe** tutar ve ardından **güncelleştirme**, aynı yıldız ve içinde gördüğünüz hata iletisini görmek *Departments.aspx* sayfası.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-332">If you enter an invalid **Budget** amount and then click **Update**, you see the same asterisk and error message that you saw in the *Departments.aspx* page.</span></span>

<span data-ttu-id="f5eb1-333">Bir alanın değerini değiştirin veya farklı bir yönetici seçin ve tıklatın **güncelleştirme**.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-333">Change a field value or select a different administrator and click **Update**.</span></span> <span data-ttu-id="f5eb1-334">Değişiklik görüntülenir.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-334">The change is displayed.</span></span>

<span data-ttu-id="f5eb1-335">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image38.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="f5eb1-335">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image38.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image37.png)</span></span>

<span data-ttu-id="f5eb1-336">Bu kullanmaya giriş tamamlar `ObjectDataSource` denetimi için temel CRUD (Oluştur, oku, Güncelleştir, Sil) Entity Framework işlemleriyle.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-336">This completes the introduction to using the `ObjectDataSource` control for basic CRUD (create, read, update, delete) operations with the Entity Framework.</span></span> <span data-ttu-id="f5eb1-337">Basit bir n katmanlı uygulama oluşturduğunuza, ancak iş mantığı katmanı otomatik birim testi karmaşıklaştırır veri erişim katmanı için hala sıkı şekilde bağlı.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-337">You've built a simple n-tier application, but the business-logic layer is still tightly coupled to the data-access layer, which complicates automated unit testing.</span></span> <span data-ttu-id="f5eb1-338">Aşağıdaki öğreticide birim testi kolaylaştırmak için havuz deseni uygulamak nasıl görürsünüz.</span><span class="sxs-lookup"><span data-stu-id="f5eb1-338">In the following tutorial you'll see how to implement the repository pattern to facilitate unit testing.</span></span>

>[!div class="step-by-step"]
[<span data-ttu-id="f5eb1-339">Next</span><span class="sxs-lookup"><span data-stu-id="f5eb1-339">Next</span></span>](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests.md)
